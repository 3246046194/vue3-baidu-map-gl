import"../app.02a5cc20.js";import{c as Oo,a as hi,g as Po}from"./commonjsHelpers.042e6b4d.js";import"./framework.ded5427d.js";import"./theme.09684e00.js";var G={STATUS_FREE:"free",STATUS_DRAWING:"drawing",STATUS_EDITER:"editer",STATUS_MOVE:"move"},B={INIT:"operate-init",COMPLETE:"operate-ok",CANCEL:"operate-cancel",CHANGE:"operate-change",CLICK:"mouse-click",RIGHTCLICK:"right-click",MOVE:"mouse-move"},vi={AREA_END:"measure-area-end",LENGTH_END:"measure-length-end"},V={DRAW_ON_MAP:"draw-on-map",EDIT_ON_MAP:"edit-on-map",SELECT_ON_MAP:"select-on-map",MOVE_ON_MAP:"move-on-map",DRAW_NO_MAP:"draw-no-map",SELECT_NO_MAP:"select-no-map",DRAW_ON_MAP_CANCEL:"draw-on-map-cancel",EDIT_ON_MAP_CANCEL:"edit-on-map-cancel",SELECT_ON_MAP_CANCEL:"select-on-map-cancel",MOVE_ON_MAP_CANCEL:"move-on-map-cancel"},T={DRAWING_POINT:"point",DRAWING_MARKER:"marker",DRAWING_POLYLINE:"polyline",DRAWING_POLYGON:"polygon",DRAWING_CIRCLE:"circle",DRAWING_RECTANGLE:"rectangle"},pi=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6Q
    AAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4z
    w7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e3
    5dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkc
    ia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrN
    bQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBS
    gAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN
    +/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC`,Eo=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6Q
    AAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9f
    fvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi
    367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rh
    IFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6d
    dQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/
    BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05
    pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQl
    SwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnO
    OZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrB
    Tf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==`,_o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAABcdJREFUeAHtm0FoHFUYx7+ZbDfJJiZUqcEgBU3BqtGKRdGLHsSTSGxL8agUT230YtGTDQl6EKt4CD1JqPQkastSPImIvVSUQINRK1jrQVNSRRGz3WST3fH/f5k3THY3mmzejLub74Mv8/bNzJv3fnwz773v+yKiogSUgBJQAkpACSgBJaAElIASUAJKQAkoASWgBJSAElACSkAJKIH2J+A1OsQgCIZw7wh0P3Qwpr0oN7MsoHNzMZ1GOe953pVGOr0pgIB2Kx4yCj0AHW7kgU18zyz6dg46CZjXN9rPDQEEOFrVy9DjUGNhhaIEX8+WvEuXy/LbnxX5468AWpHF0kYf/f9c190psrPPl5v7Pdm105cH9nbIQ8PZoKdbLAta6Eno2wDJ8r+KvWndiwDvIE6egg7wooszy/LJhZJ8e6UslQprWl98X+TeoQ556rGsPLpvhx3QPApHAfGsrah3XBcgwPHcCegY1Pv+pxU5nV+Sy1fL9dppm7q9d3TI8yOdcvedGY4pgI5DJwCS5RqpCxDwunHl+9DDlUCCqbOL3vkvmvzdrBna1iqefjwrRw52Bb5nXu0P0dpzgFisbrUGYGh5H+DCw4ViELw5dcOb+aG9ra4aiv29764OefVIDt9Hj5wI8dlqS8TbXyN8bQ28V94pbFt4pELDIQMaEplAyWaNrAEYThhjfG1peb/Mt8kssWbIm/tBBmRBJrhzLGQUNRIBxAkuTzjbevzmbdfXNiITK5AFmZAN9FTIylwRAcQvrvMGONtutwnDkPiPP2RCNmQEJSsjBiCIcofBRbJZqpgzjv88cn8GC1azNHDW8qEns7L7trgNOGu6bkNcxoVyPGQm9ukv4kQvF8lJrfN6cx5mtG6nEG/p9+X10VxqEMmGjMgKOsqCBfgMf3CHkZQsw/p3ZNxCLOPL3n9TuhBjjOgPEB+mSK/KMPe23J4lJdPfLcvfhcApxM++XJZyOV2IZERWZEZ2tEC6pOSrb0peknvbhRsir00WnEL8ea4ib50upgqRjMiKzCAjBEh/nlxKYbdx9deKc4gXZ1ZShxhb4u0nQDpD5Xe4pNKQdoBI910ogxFA+vPSklaHGGMVBxhRTYVjK0Ok4zgUA9CYnvE32OqUjoSIfaZ5ml3i3D7Al6Jx4TfRLni5xJk4lpPObOPt1bszxipgb6/xIrq50xa40eG87Ioem/+8JFt1YAzu8uXAE6vEuE6cOrcoS46XtzFW10iNESoTI4hGkkKB8CaO9cie3R3maR99uiRnzkdbpYZ6QHhvvJTDWHwhvHfPFOXCtNm/NtTeejcxnhLKXASQAZa0pJXhkVGMlQHIuKjQ+5qGtDo8MmIkL5Rpml2ePx6+LxswOpWktAM8MmIYNOSU9+HjZ0R+FoPzGNpLSjJo2vU3r6/XS+WbF2dCRmRFZmRnbY4ReRMXjV/ssvzgPRmnEwb7xshZ0hNGNQPGjkMxzCzASVQuMKjMuGgS0tezOnO5mG1t/xAtS3S2tc+xR7IJA+/MWCCzVX8gTJG5IExnMEFlHl0L41ou4bF/SS5V6o2fAfdQTobMonwQgW+LXtYfoQPvfbzoPC6SgTd/xfGSLIssjJJxENtxJXfk5+KFQ2bRP4+n7AFAWmHkkZaw4ijqAkbkXS9rXMNj59OCRxZkQjZQ5ssYeOyD/QayTIhMpBlnOgMj8lvdl5pGW/wPGZBFmOIxHjKKRhXtSWwNXmXWaWoHIGwktaMGIEECInaqmlzUUHIRAVJCSzyB4hhU09s2k95GgFYAUhMsLYw6x7qvcPV1gMglTk2KL6NTDEYxntIqKb5d2Ehw92JTfPmdox8g3J5x6JxhuSZ2k+LLFq0AJFNAmMXAQPywrW+T4yzGkUySeT1AgDmEesaUGRZlZM8qrbWZhRZGJ7LVLf2bQzMPVPumBJSAElACSkAJKAEloASUgBJQAkpACSgBJaAElIASUAJKQAkoAVcE/gG4Wba8Vno8+QAAAABJRU5ErkJggg==",yi=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.gif",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(82,174),imageOffset:new BMapGL.Size(0,14)}),di=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.png",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(37,442),imageOffset:new BMapGL.Size(25,312)}),So=new BMapGL.Icon("//maponline0.bdimg.com/sty/map_icons2x/MapRes/shenghui_1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),ko=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),kt=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit2.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),Ge={borderRadius:"2px",background:"#FFFBCC",border:"1px solid #E1E1E1",color:"#703A04",fontSize:"12px",letterSpacing:"0",padding:"5px"},Lo={operate:null,isOpen:!1,isOnMap:!0,isSeries:!0,skipEditing:!1,isSelectDraw:!1,enableCalculate:!1,enableSnap:!0,snapDistance:10,drawCursor:"crosshair",baseOpts:{icon:So,node:ko,nodeT:kt,fillColor:"#1990FF",fillOpacity:.2,strokeColor:"#877efb",strokeWeight:3,strokeOpacity:1,enableDragging:!0},labelOptions:Ge,matchOverlay:{type:"Circle",radius:2,icon:kt,strokeColor:"#fff",strokeStyle:"solid",strokeWeight:2},centerIcon:new BMapGL.Icon(Eo,new BMapGL.Size(20,20)),circleMoveIcon:new BMapGL.Icon(_o,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),moveIcon:new BMapGL.Icon(pi,new BMapGL.Size(10,10))},Mo={tips:"测距",unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",skipEditing:!0,enableCalculate:!0,turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:.8,fillOpacity:.2},labelOptions:Ge},Ro={unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:1},labelOptions:Ge},gi={icon:kt,nodeT:null,node:null,fillColor:"#fff",fillOpacity:.1,strokeColor:"#00f",strokeWeight:2,strokeOpacity:.6,strokeStyle:"dashed"},Ao={strokeColor:"#fff",strokeStyle:"solid",strokeWeight:"2"},xo=["marker","polyline","polygon","circle","rectangle"];function or(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Bo(t,e,n){return e&&or(t.prototype,e),n&&or(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Io(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function To(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lt(t,e)}function Lt(t,e){return Lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Lt(t,e)}function No(t){var e=Do();return function(){var i=ze(t),r;if(e){var o=ze(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Go(this,r)}}function Go(t,e){if(e&&(de(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mi(t)}function mi(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Do(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ze(t)}function de(t){return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}var L={grid:"$BAIDU$",guid:function(){return window[L.grid]||(window[L.grid]={}),window[L.grid]._counter=window[L.grid]._counter||1,window[L.grid]._instances=window[L.grid]._instances||{},"TANGRAM__"+(window[L.grid]._counter++).toString(36)},isString:function(e){return Object.prototype.toString.call(e)==="[object String]"},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},isArray:function(e){return Array.isArray?Array.isArray(e):Object.prototype.toString.call(e)==="[object Array]"},isObject:function(e){return Object.prototype.toString.call(e)==="[object Object]"},copyOptionsToNew:function(e,n,i){for(var r in n)if(e.hasOwnProperty(r)){if(!n[r]||n[r]instanceof Array||n[r]instanceof BMapGL.Icon||n[r]instanceof BMapGL.Symbol||n[r].ignore){i[r]=n[r];continue}if(n[r]!==null&&de(n[r])==="object"&&Object.keys(n[r]).length===0)continue;n[r]!==null&&de(n[r])==="object"&&Object.keys(n[r]).length>0?(i[r]={},this.copyOptionsToNew(e[r],n[r],i[r])):i[r]=n[r]}},copyNotExitOptions:function(e,n){var i=this,r=function(u){if(e.hasOwnProperty(u))["baseOpts","labelOptions","matchOverlay"].findIndex(function(l){return u===l})!==-1&&i.copyNotExitOptions(e[u],n[u]);else{if(!n[u]||n[u]instanceof Array||n[u]instanceof BMapGL.Icon||n[u]instanceof BMapGL.Symbol||n[u].ignore)return e[u]=n[u],"continue";n[u]!==null&&de(n[u])==="object"?(e[u]={},i.copyNotExitOptions(e[u],n[u])):e[u]=n[u]}};for(var o in n)var a=r(o)},copyOptions:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var r in n)if(e&&e.hasOwnProperty(r)){if(n[r]instanceof Array||n[r]instanceof BMapGL.Icon||n[r]instanceof BMapGL.Symbol||this.shotObject(n[r],i)){e[r]=n[r];continue}n[r]!==null&&de(n[r])==="object"?this.copyOptions(e[r],n[r],i):e[r]=n[r]}},shotObject:function(e,n){var i=!1;return n.forEach(function(r){if(e instanceof r)return i=!0,!0}),i},deepCopy:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;i?r++:(i={},r=1);for(var a in e)e[a]instanceof Array||e[a]instanceof BMapGL.Icon||e[a]instanceof BMapGL.Symbol||this.shotObject(e[a],o)?i[a]=e[a]:r<=n&&L.isObject(e[a])&&Object.keys(e[a]).length>0?(i[a]={},this.deepCopy(e[a],n,i[a],r,o)):i[a]=e[a]},getTarget:function(e){var n=window.event||e;return n.target||n.srcElement},getEvent:function(e){return window.event||e},preventDefault:function(e){var n=L.getEvent(e);n.preventDefault?n.preventDefault():n.returnValue=!1},stopBubble:function(e){var n=L.getEvent(e);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0},on:function(e,n,i,r){n=n.replace(/^on/i,""),e=L.getdom(e);var o=i,a=n;return n=n.toLowerCase(),e.addEventListener?e.addEventListener(a,o,!1):e.attachEvent&&e.attachEvent("on"+a,o),e},un:function(e,n,i,r){e=L.getdom(e);for(var o=r.length,a=!i,s,u,l;o--;)s=r[o],s[1]===n&&s[0]===e&&(a||s[2]===i)&&(u=s[4],l=s[3],e.removeEventListener?e.removeEventListener(u,l,!1):e.detachEvent&&e.detachEvent("on"+u,l),r.splice(o,1));return e},getdom:function(e){return L.isString(e)?document.getElementById(e):e},addClass:function(e,n){e=L.getdom(e);for(var i=n.split(/\s+/),r=e.className,o=" "+r+" ",a=i.length,s=0;s<a;s++)o.indexOf(" "+i[s]+" ")<0&&(r+=(r?" ":"")+i[s]);return e.className=r,e},mc2ll:function(e,n){var i=n.mercatorToLnglat(e.lng,e.lat);return new BMapGL.Point(i[0],i[1])},ll2mc:function(e,n){var i=n.lnglatToMercator(e.lng,e.lat);return new BMapGL.Point(i[0],i[1])},getPointByDistance:function(e,n,i){var r=e.lng,o=e.lat,a=n/6378800,s=Math.PI/180*o,u=Math.PI/180*r,l,c,f;switch(i){case"North":case"north":case"N":case"n":l=0,c=e.lng;break;case"West":case"west":case"W":case"w":l=90,f=e.lat;break;case"South":case"south":case"S":case"s":l=180,c=e.lng;break;case"East":case"east":case"E":case"e":l=270,f=e.lat;break;default:l=~~i;break}var p=Math.PI/180*l,d=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(p)),P=Math.atan2(Math.sin(p)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(d)),g=(u-P+Math.PI)%(2*Math.PI)-Math.PI,E=new BMapGL.Point(c||g*(180/Math.PI),f||d*(180/Math.PI));return E.lng=parseFloat(E.lng.toFixed(6)),E.lat=parseFloat(E.lat.toFixed(6)),E},throttle:function(e,n,i){if(typeof e!="function")return new Function;var r=null,o=null;return function(a){var s=a,u=+new Date;!o&&(o=u),i&&u-o>i?(e(s),o=u):(clearTimeout(r),r=setTimeout(function(){e(s),o=null},n))}}},Wn=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=function(s){To(l,s);var u=No(l);function l(){var c;Io(this,l);for(var f=arguments.length,p=new Array(f),d=0;d<f;d++)p[d]=arguments[d];return c=u.call.apply(u,[this].concat(p)),i.forEach(function(P){a(mi(c),new P)}),c}return Bo(l)}(e),a=function(u,l){Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l)).forEach(function(c){c.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(u,c,Object.getOwnPropertyDescriptor(l,c))})};return i.forEach(function(s){a(o.prototype,s.prototype),a(o,s)}),o};function We(t){return We=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},We(t)}function ar(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bi(t,e,n){return e&&ar(t.prototype,e),n&&ar(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function wi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var I=bi(function t(e,n){wi(this,t),this.type=e,this.returnValue=!0,this.target=n||null,this.currentTarget=null}),q=function(){function t(){wi(this,t),this._listeners={}}return bi(t,[{key:"addEventListener",value:function(n,i,r){if(L.isFunction(i)){!this._listeners&&(this._listeners={});var o=this._listeners,a;if(typeof r=="string"&&r){if(/[^\w\-]/.test(r))throw"nonstandard key:"+r;i.hashCode=r,a=r}n.indexOf("on")!==0&&(n="on"+n),We(o[n])!=="object"&&(o[n]={}),a=a||L.guid(),i.hashCode=a,o[n][a]=i}}},{key:"removeEventListener",value:function(n,i){if(L.isFunction(i))i=i.hashCode;else if(!L.isString(i))return;!this._listeners&&(this._listeners={}),n.indexOf("on")!==0&&(n="on"+n);var r=this._listeners;r[n]&&r[n][i]&&delete r[n][i]}},{key:"dispatchEvent",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};!this._listeners&&(this._listeners={}),L.isString(n)&&(n=new I(n));for(var r in i)n[r]=i[r];var o=this._listeners,a=n.type;if(a.indexOf("on")!==0&&(a="on"+a),L.isFunction(this[a])&&this[a].apply(this,arguments),We(o[a])==="object")for(var s in o[a])o[a][s].apply(this,arguments);return n.returnValue}},{key:"dispose",value:function(){for(var n in this._listeners)for(var i in this._listeners[n])delete this._listeners[n][i]}},{key:"defineProperty",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;r===void 0?(r=this,o=1):o++;for(var a in n)r&&r.hasOwnProperty(a)&&(n[a]instanceof Array||n[a]instanceof BMapGL.Icon||n[a]instanceof BMapGL.Symbol?r[a]=n[a]:o<i&&L.isObject(n[a])&&Object.keys(n[a]).length>0?this.defineProperty(n[a],i,r[a],o):r[a]=n[a])}},{key:"setSnapPointType",value:function(n){var i,r;((i=n.matchOverlay)===null||i===void 0?void 0:i.type)==="Marker"?this.matchOverlay=new BMapGL.Marker(new BMapGL.Point(116.395,39.935),n.matchOverlay):((r=n.matchOverlay)===null||r===void 0?void 0:r.type)==="Circle"?(n.matchOverlay.radius&&(this.matchOverlayRadius=n.matchOverlay.radius),this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,n.matchOverlay)):this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,Ao)}},{key:"setSceneStatus",value:function(n){this.scene.currentStatus=n}}]),t}();function Mt(t){return Mt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mt(t)}function $o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Co(t,e,n){return e&&sr(t.prototype,e),n&&sr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function jo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rt(t,e)}function Rt(t,e){return Rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Rt(t,e)}function Fo(t){var e=Yo();return function(){var i=Ye(t),r;if(e){var o=Ye(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return zo(this,r)}}function zo(t,e){if(e&&(Mt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wo(t)}function Wo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ye(t){return Ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ye(t)}var Oi=function(t){jo(n,t);var e=Fo(n);function n(i){var r;return $o(this,n),r=e.call(this),r.delayLimit=100,r.minLimit=200,r.overlayData=[],r.click=void 0,r.mousemove=void 0,r.rightclick=void 0,r.map=i,r.open(),r}return Co(n,[{key:"open",value:function(){this.openClick(),this.openMouse(),this.openRightClick()}},{key:"linkOverlayData",value:function(r){this.overlayData=r}},{key:"clickAction",value:function(r){this.dispatchEvent(new I(B.CLICK,r))}},{key:"rightclickAction",value:function(r){this.dispatchEvent(new I(B.RIGHTCLICK,r))}},{key:"mouseAction",value:function(r){r&&this.dispatchEvent(new I(B.MOVE,r))}},{key:"openClick",value:function(){this.click||this.map.addEventListener("click",this.click=this.clickAction.bind(this))}},{key:"openRightClick",value:function(){this.rightclick||this.map.addEventListener("rightclick",this.rightclick=this.rightclickAction.bind(this))}},{key:"openMouse",value:function(){this.mousemove||(this.mousemove=L.throttle(this.mouseAction.bind(this),this.delayLimit,this.minLimit).bind(this),this.map.addEventListener("mousemove",this.mousemove))}},{key:"close",value:function(){this.closeClick(),this.closeMouse()}},{key:"closeClick",value:function(){this.click&&(this.map.removeEventListener("click",this.click),this.click=null)}},{key:"closeMouse",value:function(){this.mousemove&&(this.map.removeEventListener("mousemove",this.mousemove),this.mousemove=null)}},{key:"intersectOverlays",value:function(r){for(var o=[],a=0;a<this.overlayData.length;a++){var s=this.overlayData[a],u=void 0;if(s.toString()==="Marker"){u=s._getInPnBox(r.pixel),u&&o.push(s);continue}s.toString()!=="Polyline"?u=s._getInPnpoly(r.point):u=s._getProximity(r.point);var l=u.dist;l>=0&&l<s._config.mouseOverTolerance&&o.push(s)}return o.length>0?o:null}}]),n}(q),C=63710088e-1,Yn={centimeters:C*100,centimetres:C*100,degrees:C/111325,feet:C*3.28084,inches:C*39.37,kilometers:C/1e3,kilometres:C/1e3,meters:C,metres:C,miles:C/1609.344,millimeters:C*1e3,millimetres:C*1e3,nauticalmiles:C/1852,radians:1,yards:C*1.0936},Xo={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/C,yards:1.0936133},At={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function U(t,e,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function Jo(t,e,n){switch(t){case"Point":return N(e).geometry;case"LineString":return D(e).geometry;case"Polygon":return ge(e).geometry;case"MultiPoint":return Pi(e).geometry;case"MultiLineString":return dt(e).geometry;case"MultiPolygon":return De(e).geometry;default:throw new Error(t+" is invalid")}}function N(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xe(t[0])||!Xe(t[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:t};return U(i,e,n)}function Uo(t,e,n){return n===void 0&&(n={}),H(t.map(function(i){return N(i,e)}),n)}function ge(t,e,n){n===void 0&&(n={});for(var i=0,r=t;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return U(s,e,n)}function qo(t,e,n){return n===void 0&&(n={}),H(t.map(function(i){return ge(i,e)}),n)}function D(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:t};return U(i,e,n)}function Ho(t,e,n){return n===void 0&&(n={}),H(t.map(function(i){return D(i,e)}),n)}function H(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function dt(t,e,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:t};return U(i,e,n)}function Pi(t,e,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:t};return U(i,e,n)}function De(t,e,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:t};return U(i,e,n)}function Qo(t,e,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:t};return U(i,e,n)}function Vo(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function Xn(t,e){e===void 0&&(e="kilometers");var n=Yn[e];if(!n)throw new Error(e+" units is invalid");return t*n}function gt(t,e){e===void 0&&(e="kilometers");var n=Yn[e];if(!n)throw new Error(e+" units is invalid");return t/n}function Ei(t,e){return Ee(gt(t,e))}function Ko(t){var e=t%360;return e<0&&(e+=360),e}function Ee(t){var e=t%(2*Math.PI);return e*180/Math.PI}function F(t){var e=t%360;return e*Math.PI/180}function mt(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return Xn(gt(t,e),n)}function Zo(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=At[e];if(!i)throw new Error("invalid original units");var r=At[n];if(!r)throw new Error("invalid final units");return t/i*r}function Xe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function $e(t){return!!t&&t.constructor===Object}function ea(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Xe(e))throw new Error("bbox must only contain numbers")})}function ta(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const na=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:At,bearingToAzimuth:Ko,convertArea:Zo,convertLength:mt,degreesToRadians:F,earthRadius:C,factors:Yn,feature:U,featureCollection:H,geometry:Jo,geometryCollection:Qo,isNumber:Xe,isObject:$e,lengthToDegrees:Ei,lengthToRadians:gt,lineString:D,lineStrings:Ho,multiLineString:dt,multiPoint:Pi,multiPolygon:De,point:N,points:Uo,polygon:ge,polygons:qo,radiansToDegrees:Ee,radiansToLength:Xn,round:Vo,unitsFactors:Xo,validateBBox:ea,validateId:ta},Symbol.toStringTag,{value:"Module"}));function le(t,e,n){if(t!==null)for(var i,r,o,a,s,u,l,c=0,f=0,p,d=t.type,P=d==="FeatureCollection",g=d==="Feature",E=P?t.features.length:1,k=0;k<E;k++){l=P?t.features[k].geometry:g?t.geometry:t,p=l?l.type==="GeometryCollection":!1,s=p?l.geometries.length:1;for(var h=0;h<s;h++){var v=0,y=0;if(a=p?l.geometries[h]:l,a!==null){u=a.coordinates;var b=a.type;switch(c=n&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(u,f,k,v,y)===!1)return!1;f++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(e(u[i],f,k,v,y)===!1)return!1;f++,b==="MultiPoint"&&v++}b==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(r=0;r<u[i].length-c;r++){if(e(u[i][r],f,k,v,y)===!1)return!1;f++}b==="MultiLineString"&&v++,b==="Polygon"&&y++}b==="Polygon"&&v++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(y=0,r=0;r<u[i].length;r++){for(o=0;o<u[i][r].length-c;o++){if(e(u[i][r][o],f,k,v,y)===!1)return!1;f++}y++}v++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(le(a.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ra(t,e,n,i){var r=n;return le(t,function(o,a,s,u,l){a===0&&n===void 0?r=o:r=e(r,o,a,s,u,l)},i),r}function _i(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function ia(t,e,n){var i=n;return _i(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function _e(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function Si(t,e,n){var i=n;return _e(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function oa(t){var e=[];return le(t,function(n){e.push(n)}),e}function Jn(t,e){var n,i,r,o,a,s,u,l,c,f,p=0,d=t.type==="FeatureCollection",P=t.type==="Feature",g=d?t.features.length:1;for(n=0;n<g;n++){for(s=d?t.features[n].geometry:P?t.geometry:t,l=d?t.features[n].properties:P?t.properties:{},c=d?t.features[n].bbox:P?t.bbox:void 0,f=d?t.features[n].id:P?t.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,r=0;r<a;r++){if(o=u?s.geometries[r]:s,o===null){if(e(null,p,l,c,f)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,l,c,f)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],p,l,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function ki(t,e,n){var i=n;return Jn(t,function(r,o,a,s,u){o===0&&n===void 0?i=r:i=e(i,r,o,a,s,u)}),i}function ae(t,e){Jn(t,function(n,i,r,o,a){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(U(n,r,{bbox:o,id:a}),i,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var l=0;l<n.coordinates.length;l++){var c=n.coordinates[l],f={type:u,coordinates:c};if(e(U(f,r),i,l)===!1)return!1}})}function aa(t,e,n){var i=n;return ae(t,function(r,o,a){o===0&&a===0&&n===void 0?i=r:i=e(i,r,o,a)}),i}function Un(t,e){ae(t,function(n,i,r){var o=0;if(n.geometry){var a=n.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,u=0,l=0,c=0;if(le(n,function(f,p,d,P,g){if(s===void 0||i>u||P>l||g>c){s=f,u=i,l=P,c=g,o=0;return}var E=D([s,f],n.properties);if(e(E,i,r,g,o)===!1)return!1;o++,s=f})===!1)return!1}}})}function Li(t,e,n){var i=n,r=!1;return Un(t,function(o,a,s,u,l){r===!1&&n===void 0?i=o:i=e(i,o,a,s,u,l),r=!0}),i}function Mi(t,e){if(!t)throw new Error("geojson is required");ae(t,function(n,i,r){if(n.geometry!==null){var o=n.geometry.type,a=n.geometry.coordinates;switch(o){case"LineString":if(e(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(e(D(a[s],n.properties),i,r,s)===!1)return!1;break}}})}function sa(t,e,n){var i=n;return Mi(t,function(r,o,a,s){o===0&&n===void 0?i=r:i=e(i,r,o,a,s)}),i}function ua(t,e){if(e=e||{},!$e(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.segmentIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),D([u[o],u[o+1]],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),D([u[r][o],u[r][o+1]],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),D([u[i][o],u[i][o+1]],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o-1),D([u[i][r][o],u[i][r][o+1]],a,e)}throw new Error("geojson is invalid")}function la(t,e){if(e=e||{},!$e(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.coordIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return N(u,a,e);case"MultiPoint":return i<0&&(i=u.length+i),N(u[i],a,e);case"LineString":return o<0&&(o=u.length+o),N(u[o],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),N(u[r][o],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),N(u[i][o],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o),N(u[i][r][o],a,e)}throw new Error("geojson is invalid")}const ca=Object.freeze(Object.defineProperty({__proto__:null,coordAll:oa,coordEach:le,coordReduce:ra,featureEach:_e,featureReduce:Si,findPoint:la,findSegment:ua,flattenEach:ae,flattenReduce:aa,geomEach:Jn,geomReduce:ki,lineEach:Mi,lineReduce:sa,propEach:_i,propReduce:ia,segmentEach:Un,segmentReduce:Li},Symbol.toStringTag,{value:"Module"}));function pe(t){var e=[1/0,1/0,-1/0,-1/0];return le(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}pe.default=pe;function z(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Q(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ur(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function Z(t){return t.type==="Feature"?t.geometry:t}function xt(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}var Ri={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(Oo,function(){function n(h,v,y,b,S){(function _(M,R,x,m,O){for(;m>x;){if(m-x>600){var w=m-x+1,A=R-x+1,Y=Math.log(w),J=.5*Math.exp(2*Y/3),te=.5*Math.sqrt(Y*J*(w-J)/w)*(A-w/2<0?-1:1),ce=Math.max(x,Math.floor(R-A*J/w+te)),wo=Math.min(m,Math.floor(R+(w-A)*J/w+te));_(M,R,ce,wo,O)}var je=M[R],Le=x,ne=m;for(i(M,x,R),O(M[m],je)>0&&i(M,x,m);Le<ne;){for(i(M,Le,ne),Le++,ne--;O(M[Le],je)<0;)Le++;for(;O(M[ne],je)>0;)ne--}O(M[x],je)===0?i(M,x,ne):i(M,++ne,m),ne<=R&&(x=ne+1),R<=ne&&(m=ne-1)}})(h,v,y||0,b||h.length-1,S||r)}function i(h,v,y){var b=h[v];h[v]=h[y],h[y]=b}function r(h,v){return h<v?-1:h>v?1:0}var o=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(h,v,y){if(!y)return v.indexOf(h);for(var b=0;b<v.length;b++)if(y(h,v[b]))return b;return-1}function s(h,v){u(h,0,h.children.length,v,h)}function u(h,v,y,b,S){S||(S=E(null)),S.minX=1/0,S.minY=1/0,S.maxX=-1/0,S.maxY=-1/0;for(var _=v;_<y;_++){var M=h.children[_];l(S,h.leaf?b(M):M)}return S}function l(h,v){return h.minX=Math.min(h.minX,v.minX),h.minY=Math.min(h.minY,v.minY),h.maxX=Math.max(h.maxX,v.maxX),h.maxY=Math.max(h.maxY,v.maxY),h}function c(h,v){return h.minX-v.minX}function f(h,v){return h.minY-v.minY}function p(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function d(h){return h.maxX-h.minX+(h.maxY-h.minY)}function P(h,v){return h.minX<=v.minX&&h.minY<=v.minY&&v.maxX<=h.maxX&&v.maxY<=h.maxY}function g(h,v){return v.minX<=h.maxX&&v.minY<=h.maxY&&v.maxX>=h.minX&&v.maxY>=h.minY}function E(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(h,v,y,b,S){for(var _=[v,y];_.length;)if(!((y=_.pop())-(v=_.pop())<=b)){var M=v+Math.ceil((y-v)/b/2)*b;n(h,M,v,y,S),_.push(v,M,M,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(h){var v=this.data,y=[];if(!g(h,v))return y;for(var b=this.toBBox,S=[];v;){for(var _=0;_<v.children.length;_++){var M=v.children[_],R=v.leaf?b(M):M;g(h,R)&&(v.leaf?y.push(M):P(h,R)?this._all(M,y):S.push(M))}v=S.pop()}return y},o.prototype.collides=function(h){var v=this.data;if(!g(h,v))return!1;for(var y=[];v;){for(var b=0;b<v.children.length;b++){var S=v.children[b],_=v.leaf?this.toBBox(S):S;if(g(h,_)){if(v.leaf||P(h,_))return!0;y.push(S)}}v=y.pop()}return!1},o.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var v=0;v<h.length;v++)this.insert(h[v]);return this}var y=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var b=this.data;this.data=y,y=b}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},o.prototype.clear=function(){return this.data=E([]),this},o.prototype.remove=function(h,v){if(!h)return this;for(var y,b,S,_=this.data,M=this.toBBox(h),R=[],x=[];_||R.length;){if(_||(_=R.pop(),b=R[R.length-1],y=x.pop(),S=!0),_.leaf){var m=a(h,_.children,v);if(m!==-1)return _.children.splice(m,1),R.push(_),this._condense(R),this}S||_.leaf||!P(_,M)?b?(y++,_=b.children[y],S=!1):_=null:(R.push(_),x.push(y),y=0,b=_,_=_.children[0])}return this},o.prototype.toBBox=function(h){return h},o.prototype.compareMinX=function(h,v){return h.minX-v.minX},o.prototype.compareMinY=function(h,v){return h.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(h){return this.data=h,this},o.prototype._all=function(h,v){for(var y=[];h;)h.leaf?v.push.apply(v,h.children):y.push.apply(y,h.children),h=y.pop();return v},o.prototype._build=function(h,v,y,b){var S,_=y-v+1,M=this._maxEntries;if(_<=M)return s(S=E(h.slice(v,y+1)),this.toBBox),S;b||(b=Math.ceil(Math.log(_)/Math.log(M)),M=Math.ceil(_/Math.pow(M,b-1))),(S=E([])).leaf=!1,S.height=b;var R=Math.ceil(_/M),x=R*Math.ceil(Math.sqrt(M));k(h,v,y,x,this.compareMinX);for(var m=v;m<=y;m+=x){var O=Math.min(m+x-1,y);k(h,m,O,R,this.compareMinY);for(var w=m;w<=O;w+=R){var A=Math.min(w+R-1,O);S.children.push(this._build(h,w,A,b-1))}}return s(S,this.toBBox),S},o.prototype._chooseSubtree=function(h,v,y,b){for(;b.push(v),!v.leaf&&b.length-1!==y;){for(var S=1/0,_=1/0,M=void 0,R=0;R<v.children.length;R++){var x=v.children[R],m=p(x),O=(w=h,A=x,(Math.max(A.maxX,w.maxX)-Math.min(A.minX,w.minX))*(Math.max(A.maxY,w.maxY)-Math.min(A.minY,w.minY))-m);O<_?(_=O,S=m<S?m:S,M=x):O===_&&m<S&&(S=m,M=x)}v=M||v.children[0]}var w,A;return v},o.prototype._insert=function(h,v,y){var b=y?h:this.toBBox(h),S=[],_=this._chooseSubtree(b,this.data,v,S);for(_.children.push(h),l(_,b);v>=0&&S[v].children.length>this._maxEntries;)this._split(S,v),v--;this._adjustParentBBoxes(b,S,v)},o.prototype._split=function(h,v){var y=h[v],b=y.children.length,S=this._minEntries;this._chooseSplitAxis(y,S,b);var _=this._chooseSplitIndex(y,S,b),M=E(y.children.splice(_,y.children.length-_));M.height=y.height,M.leaf=y.leaf,s(y,this.toBBox),s(M,this.toBBox),v?h[v-1].children.push(M):this._splitRoot(y,M)},o.prototype._splitRoot=function(h,v){this.data=E([h,v]),this.data.height=h.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(h,v,y){for(var b,S,_,M,R,x,m,O=1/0,w=1/0,A=v;A<=y-v;A++){var Y=u(h,0,A,this.toBBox),J=u(h,A,y,this.toBBox),te=(S=Y,_=J,M=void 0,R=void 0,x=void 0,m=void 0,M=Math.max(S.minX,_.minX),R=Math.max(S.minY,_.minY),x=Math.min(S.maxX,_.maxX),m=Math.min(S.maxY,_.maxY),Math.max(0,x-M)*Math.max(0,m-R)),ce=p(Y)+p(J);te<O?(O=te,b=A,w=ce<w?ce:w):te===O&&ce<w&&(w=ce,b=A)}return b||y-v},o.prototype._chooseSplitAxis=function(h,v,y){var b=h.leaf?this.compareMinX:c,S=h.leaf?this.compareMinY:f;this._allDistMargin(h,v,y,b)<this._allDistMargin(h,v,y,S)&&h.children.sort(b)},o.prototype._allDistMargin=function(h,v,y,b){h.children.sort(b);for(var S=this.toBBox,_=u(h,0,v,S),M=u(h,y-v,y,S),R=d(_)+d(M),x=v;x<y-v;x++){var m=h.children[x];l(_,h.leaf?S(m):m),R+=d(_)}for(var O=y-v-1;O>=v;O--){var w=h.children[O];l(M,h.leaf?S(w):w),R+=d(M)}return R},o.prototype._adjustParentBBoxes=function(h,v,y){for(var b=y;b>=0;b--)l(v[b],h)},o.prototype._condense=function(h){for(var v=h.length-1,y=void 0;v>=0;v--)h[v].children.length===0?v>0?(y=h[v-1].children).splice(y.indexOf(h[v]),1):this.clear():s(h[v],this.toBBox)},o})})(Ri);var fa=Ri.exports;function se(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=z(t),r=Z(e),o=r.type,a=e.bbox,s=r.coordinates;if(a&&ha(i,a)===!1)return!1;o==="Polygon"&&(s=[s]);for(var u=!1,l=0;l<s.length&&!u;l++)if(lr(i,s[l][0],n.ignoreBoundary)){for(var c=!1,f=1;f<s[l].length&&!c;)lr(i,s[l][f],!n.ignoreBoundary)&&(c=!0),f++;c||(u=!0)}return u}function lr(t,e,n){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var r=0,o=e.length-1;r<e.length;o=r++){var a=e[r][0],s=e[r][1],u=e[o][0],l=e[o][1],c=t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)===0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0;if(c)return!n;var f=s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a;f&&(i=!i)}return i}function ha(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function K(t,e,n){n===void 0&&(n={});var i=z(t),r=z(e),o=F(r[1]-i[1]),a=F(r[0]-i[0]),s=F(i[1]),u=F(r[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return Xn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function Ai(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return xi(t);case"FeatureCollection":return va(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return qn(t);default:throw new Error("unknown GeoJSON type")}}function xi(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=Bi(t.properties),e.geometry=qn(t.geometry),e}function Bi(t){var e={};return t&&Object.keys(t).forEach(function(n){var i=t[n];typeof i=="object"?i===null?e[n]=null:Array.isArray(i)?e[n]=i.map(function(r){return r}):e[n]=Bi(i):e[n]=i}),e}function va(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(n){return xi(n)}),e}function qn(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(n){return qn(n)}),e):(e.coordinates=Ii(t.coordinates),e)}function Ii(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(n){return Ii(n)})}function pa(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=K(t.slice(0,2),[i,n]),a=K(t.slice(0,2),[e,r]);if(o>=a){var s=(n+r)/2;return[e,s-(i-e)/2,i,s+(i-e)/2]}else{var u=(e+i)/2;return[u-(r-n)/2,n,u+(r-n)/2,r]}}function Bt(t,e,n,i){i===void 0&&(i={});var r=z(t),o=F(r[0]),a=F(r[1]),s=F(n),u=gt(e,i.units),l=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s)),c=o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(l)),f=Ee(c),p=Ee(l);return N([f,p],i.properties)}function Hn(t,e,n){if(n===void 0&&(n={}),n.final===!0)return ya(t,e);var i=z(t),r=z(e),o=F(i[0]),a=F(r[0]),s=F(i[1]),u=F(r[1]),l=Math.sin(a-o)*Math.cos(u),c=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return Ee(Math.atan2(l,c))}function ya(t,e){var n=Hn(e,t);return n=(n+180)%360,n}function da(t,e){var n=K(t,e),i=Hn(t,e),r=Bt(t,n/2,i);return r}function ga(t,e){e===void 0&&(e={});var n=0,i=0,r=0;return le(t,function(o){n+=o[0],i+=o[1],r++},!0),N([n/r,i/r],e.properties)}function It(t){if(!t)throw new Error("geojson is required");var e=[];return ae(t,function(n){ma(n,e)}),H(e)}function ma(t,e){var n=[],i=t.geometry;if(i!==null){switch(i.type){case"Polygon":n=Q(i);break;case"LineString":n=[Q(i)]}n.forEach(function(r){var o=ba(r,t.properties);o.forEach(function(a){a.id=e.length,e.push(a)})})}}function ba(t,e){var n=[];return t.reduce(function(i,r){var o=D([i,r],e);return o.bbox=wa(i,r),n.push(o),r}),n}function wa(t,e){var n=t[0],i=t[1],r=e[0],o=e[1],a=n<r?n:r,s=i<o?i:o,u=n>r?n:r,l=i>o?i:o;return[a,s,u,l]}var Qn={exports:{}},Ti={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=63710088e-1,t.factors={centimeters:t.earthRadius*100,centimetres:t.earthRadius*100,degrees:t.earthRadius/111325,feet:t.earthRadius*3.28084,inches:t.earthRadius*39.37,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:t.earthRadius*1e3,millimetres:t.earthRadius*1e3,nauticalmiles:t.earthRadius/1852,radians:1,yards:t.earthRadius*1.0936},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(m,O,w){w===void 0&&(w={});var A={type:"Feature"};return(w.id===0||w.id)&&(A.id=w.id),w.bbox&&(A.bbox=w.bbox),A.properties=O||{},A.geometry=m,A}t.feature=e;function n(m,O,w){switch(m){case"Point":return i(O).geometry;case"LineString":return s(O).geometry;case"Polygon":return o(O).geometry;case"MultiPoint":return f(O).geometry;case"MultiLineString":return c(O).geometry;case"MultiPolygon":return p(O).geometry;default:throw new Error(m+" is invalid")}}t.geometry=n;function i(m,O,w){if(w===void 0&&(w={}),!m)throw new Error("coordinates is required");if(!Array.isArray(m))throw new Error("coordinates must be an Array");if(m.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_(m[0])||!_(m[1]))throw new Error("coordinates must contain numbers");var A={type:"Point",coordinates:m};return e(A,O,w)}t.point=i;function r(m,O,w){return w===void 0&&(w={}),l(m.map(function(A){return i(A,O)}),w)}t.points=r;function o(m,O,w){w===void 0&&(w={});for(var A=0,Y=m;A<Y.length;A++){var J=Y[A];if(J.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var te=0;te<J[J.length-1].length;te++)if(J[J.length-1][te]!==J[0][te])throw new Error("First and last Position are not equivalent.")}var ce={type:"Polygon",coordinates:m};return e(ce,O,w)}t.polygon=o;function a(m,O,w){return w===void 0&&(w={}),l(m.map(function(A){return o(A,O)}),w)}t.polygons=a;function s(m,O,w){if(w===void 0&&(w={}),m.length<2)throw new Error("coordinates must be an array of two or more positions");var A={type:"LineString",coordinates:m};return e(A,O,w)}t.lineString=s;function u(m,O,w){return w===void 0&&(w={}),l(m.map(function(A){return s(A,O)}),w)}t.lineStrings=u;function l(m,O){O===void 0&&(O={});var w={type:"FeatureCollection"};return O.id&&(w.id=O.id),O.bbox&&(w.bbox=O.bbox),w.features=m,w}t.featureCollection=l;function c(m,O,w){w===void 0&&(w={});var A={type:"MultiLineString",coordinates:m};return e(A,O,w)}t.multiLineString=c;function f(m,O,w){w===void 0&&(w={});var A={type:"MultiPoint",coordinates:m};return e(A,O,w)}t.multiPoint=f;function p(m,O,w){w===void 0&&(w={});var A={type:"MultiPolygon",coordinates:m};return e(A,O,w)}t.multiPolygon=p;function d(m,O,w){w===void 0&&(w={});var A={type:"GeometryCollection",geometries:m};return e(A,O,w)}t.geometryCollection=d;function P(m,O){if(O===void 0&&(O=0),O&&!(O>=0))throw new Error("precision must be a positive number");var w=Math.pow(10,O||0);return Math.round(m*w)/w}t.round=P;function g(m,O){O===void 0&&(O="kilometers");var w=t.factors[O];if(!w)throw new Error(O+" units is invalid");return m*w}t.radiansToLength=g;function E(m,O){O===void 0&&(O="kilometers");var w=t.factors[O];if(!w)throw new Error(O+" units is invalid");return m/w}t.lengthToRadians=E;function k(m,O){return v(E(m,O))}t.lengthToDegrees=k;function h(m){var O=m%360;return O<0&&(O+=360),O}t.bearingToAzimuth=h;function v(m){var O=m%(2*Math.PI);return O*180/Math.PI}t.radiansToDegrees=v;function y(m){var O=m%360;return O*Math.PI/180}t.degreesToRadians=y;function b(m,O,w){if(O===void 0&&(O="kilometers"),w===void 0&&(w="kilometers"),!(m>=0))throw new Error("length must be a positive number");return g(E(m,O),w)}t.convertLength=b;function S(m,O,w){if(O===void 0&&(O="meters"),w===void 0&&(w="kilometers"),!(m>=0))throw new Error("area must be a positive number");var A=t.areaFactors[O];if(!A)throw new Error("invalid original units");var Y=t.areaFactors[w];if(!Y)throw new Error("invalid final units");return m/A*Y}t.convertArea=S;function _(m){return!isNaN(m)&&m!==null&&!Array.isArray(m)}t.isNumber=_;function M(m){return!!m&&m.constructor===Object}t.isObject=M;function R(m){if(!m)throw new Error("bbox is required");if(!Array.isArray(m))throw new Error("bbox must be an Array");if(m.length!==4&&m.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");m.forEach(function(O){if(!_(O))throw new Error("bbox must only contain numbers")})}t.validateBBox=R;function x(m){if(!m)throw new Error("id is required");if(["string","number"].indexOf(typeof m)===-1)throw new Error("id must be a number or a string")}t.validateId=x})(Ti);var $={};const Oa=hi(na);Object.defineProperty($,"__esModule",{value:!0});var W=Oa;function Ce(t,e,n){if(t!==null)for(var i,r,o,a,s,u,l,c=0,f=0,p,d=t.type,P=d==="FeatureCollection",g=d==="Feature",E=P?t.features.length:1,k=0;k<E;k++){l=P?t.features[k].geometry:g?t.geometry:t,p=l?l.type==="GeometryCollection":!1,s=p?l.geometries.length:1;for(var h=0;h<s;h++){var v=0,y=0;if(a=p?l.geometries[h]:l,a!==null){u=a.coordinates;var b=a.type;switch(c=n&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(e(u,f,k,v,y)===!1)return!1;f++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(e(u[i],f,k,v,y)===!1)return!1;f++,b==="MultiPoint"&&v++}b==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(r=0;r<u[i].length-c;r++){if(e(u[i][r],f,k,v,y)===!1)return!1;f++}b==="MultiLineString"&&v++,b==="Polygon"&&y++}b==="Polygon"&&v++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(y=0,r=0;r<u[i].length;r++){for(o=0;o<u[i][r].length-c;o++){if(e(u[i][r][o],f,k,v,y)===!1)return!1;f++}y++}v++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(Ce(a.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pa(t,e,n,i){var r=n;return Ce(t,function(o,a,s,u,l){a===0&&n===void 0?r=o:r=e(r,o,a,s,u,l)},i),r}function Ni(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function Ea(t,e,n){var i=n;return Ni(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function Gi(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function _a(t,e,n){var i=n;return Gi(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function Sa(t){var e=[];return Ce(t,function(n){e.push(n)}),e}function Vn(t,e){var n,i,r,o,a,s,u,l,c,f,p=0,d=t.type==="FeatureCollection",P=t.type==="Feature",g=d?t.features.length:1;for(n=0;n<g;n++){for(s=d?t.features[n].geometry:P?t.geometry:t,l=d?t.features[n].properties:P?t.properties:{},c=d?t.features[n].bbox:P?t.bbox:void 0,f=d?t.features[n].id:P?t.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,r=0;r<a;r++){if(o=u?s.geometries[r]:s,o===null){if(e(null,p,l,c,f)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,l,c,f)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],p,l,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function ka(t,e,n){var i=n;return Vn(t,function(r,o,a,s,u){o===0&&n===void 0?i=r:i=e(i,r,o,a,s,u)}),i}function bt(t,e){Vn(t,function(n,i,r,o,a){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(W.feature(n,r,{bbox:o,id:a}),i,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var l=0;l<n.coordinates.length;l++){var c=n.coordinates[l],f={type:u,coordinates:c};if(e(W.feature(f,r),i,l)===!1)return!1}})}function La(t,e,n){var i=n;return bt(t,function(r,o,a){o===0&&a===0&&n===void 0?i=r:i=e(i,r,o,a)}),i}function Di(t,e){bt(t,function(n,i,r){var o=0;if(n.geometry){var a=n.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,u=0,l=0,c=0;if(Ce(n,function(f,p,d,P,g){if(s===void 0||i>u||P>l||g>c){s=f,u=i,l=P,c=g,o=0;return}var E=W.lineString([s,f],n.properties);if(e(E,i,r,g,o)===!1)return!1;o++,s=f})===!1)return!1}}})}function Ma(t,e,n){var i=n,r=!1;return Di(t,function(o,a,s,u,l){r===!1&&n===void 0?i=o:i=e(i,o,a,s,u,l),r=!0}),i}function $i(t,e){if(!t)throw new Error("geojson is required");bt(t,function(n,i,r){if(n.geometry!==null){var o=n.geometry.type,a=n.geometry.coordinates;switch(o){case"LineString":if(e(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(e(W.lineString(a[s],n.properties),i,r,s)===!1)return!1;break}}})}function Ra(t,e,n){var i=n;return $i(t,function(r,o,a,s){o===0&&n===void 0?i=r:i=e(i,r,o,a,s)}),i}function Aa(t,e){if(e=e||{},!W.isObject(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.segmentIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),W.lineString([u[o],u[o+1]],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),W.lineString([u[r][o],u[r][o+1]],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),W.lineString([u[i][o],u[i][o+1]],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o-1),W.lineString([u[i][r][o],u[i][r][o+1]],a,e)}throw new Error("geojson is invalid")}function xa(t,e){if(e=e||{},!W.isObject(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.coordIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return W.point(u,a,e);case"MultiPoint":return i<0&&(i=u.length+i),W.point(u[i],a,e);case"LineString":return o<0&&(o=u.length+o),W.point(u[o],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),W.point(u[r][o],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),W.point(u[i][o],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o),W.point(u[i][r][o],a,e)}throw new Error("geojson is invalid")}$.coordAll=Sa;$.coordEach=Ce;$.coordReduce=Pa;$.featureEach=Gi;$.featureReduce=_a;$.findPoint=xa;$.findSegment=Aa;$.flattenEach=bt;$.flattenReduce=La;$.geomEach=Vn;$.geomReduce=ka;$.lineEach=$i;$.lineReduce=Ra;$.propEach=Ni;$.propReduce=Ea;$.segmentEach=Di;$.segmentReduce=Ma;var Kn={};const Ba=hi(ca);Object.defineProperty(Kn,"__esModule",{value:!0});var Ia=Ba;function Tt(t){var e=[1/0,1/0,-1/0,-1/0];return Ia.coordEach(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}Tt.default=Tt;Kn.default=Tt;var ie=fa,Ci=Ti,ji=$,Pe=Kn.default,Ta=ji.featureEach;ji.coordEach;Ci.polygon;var cr=Ci.featureCollection;function Fi(t){var e=new ie(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Pe(n),ie.prototype.insert.call(this,n)},e.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Pe(r),i.push(r)}):Ta(n,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Pe(r),i.push(r)}),ie.prototype.load.call(this,i)},e.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Pe(n),ie.prototype.remove.call(this,n,i)},e.clear=function(){return ie.prototype.clear.call(this)},e.search=function(n){var i=ie.prototype.search.call(this,this.toBBox(n));return cr(i)},e.collides=function(n){return ie.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=ie.prototype.all.call(this);return cr(n)},e.toJSON=function(){return ie.prototype.toJSON.call(this)},e.fromJSON=function(n){return ie.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Pe(n);else if(n.type==="FeatureCollection")i=Pe(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}Qn.exports=Fi;Qn.exports.default=Fi;var Na=Qn.exports;const Zn=Po(Na);function ke(t,e){var n={},i=[];if(t.type==="LineString"&&(t=U(t)),e.type==="LineString"&&(e=U(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var r=fr(t,e);return r&&i.push(r),H(i)}var o=Zn();return o.load(It(e)),_e(It(t),function(a){_e(o.search(a),function(s){var u=fr(a,s);if(u){var l=Q(u).join(",");n[l]||(n[l]=!0,i.push(u))}})}),H(i)}function fr(t,e){var n=Q(t),i=Q(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],u=i[0][0],l=i[0][1],c=i[1][0],f=i[1][1],p=(f-l)*(a-r)-(c-u)*(s-o),d=(c-u)*(o-l)-(f-l)*(r-u),P=(a-r)*(o-l)-(s-o)*(r-u);if(p===0)return null;var g=d/p,E=P/p;if(g>=0&&g<=1&&E>=0&&E<=1){var k=r+g*(a-r),h=o+g*(s-o);return N([k,h])}return null}function zi(t,e,n){n===void 0&&(n={});var i=N([1/0,1/0],{dist:1/0}),r=0;return ae(t,function(o){for(var a=Q(o),s=0;s<a.length-1;s++){var u=N(a[s]);u.properties.dist=K(e,u,n);var l=N(a[s+1]);l.properties.dist=K(e,l,n);var c=K(u,l,n),f=Math.max(u.properties.dist,l.properties.dist),p=Hn(u,l),d=Bt(e,f,p+90,n),P=Bt(e,f,p-90,n),g=ke(D([d.geometry.coordinates,P.geometry.coordinates]),D([u.geometry.coordinates,l.geometry.coordinates])),E=null;g.features.length>0&&(E=g.features[0],E.properties.dist=K(e,E,n),E.properties.location=r+K(u,E,n)),u.properties.dist<i.properties.dist&&(i=u,i.properties.index=s,i.properties.location=r),l.properties.dist<i.properties.dist&&(i=l,i.properties.index=s+1,i.properties.location=r+c),E&&E.properties.dist<i.properties.dist&&(i=E,i.properties.index=s),r+=c}}),i}function Wi(t,e,n){n===void 0&&(n={});var i=z(t),r=z(e);r[0]+=r[0]-i[0]>180?-360:i[0]-r[0]>180?360:0;var o=Ga(i,r),a=mt(o,"meters",n.units);return a}function Ga(t,e,n){n=n===void 0?C:Number(n);var i=n,r=t[1]*Math.PI/180,o=e[1]*Math.PI/180,a=o-r,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),l=Math.abs(u)>1e-11?a/u:Math.cos(r),c=Math.sqrt(a*a+l*l*s*s),f=c*i;return f}function Da(t,e,n){if(n===void 0&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=N(t):t.type==="Point"?t=U(t):ur(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=D(e):e.type==="LineString"?e=U(e):ur(e,"LineString","line");var i=1/0,r=t.geometry.coordinates;return Un(e,function(o){var a=o.geometry.coordinates[0],s=o.geometry.coordinates[1],u=$a(r,a,s,n);u<i&&(i=u)}),mt(i,"degrees",n.units)}function $a(t,e,n,i){var r=[n[0]-e[0],n[1]-e[1]],o=[t[0]-e[0],t[1]-e[1]],a=hr(o,r);if(a<=0)return Pt(t,e,{method:i.method,units:"degrees"});var s=hr(r,r);if(s<=a)return Pt(t,n,{method:i.method,units:"degrees"});var u=a/s,l=[e[0]+u*r[0],e[1]+u*r[1]];return Pt(t,l,{method:i.method,units:"degrees"})}function hr(t,e){return t[0]*e[0]+t[1]*e[1]}function Pt(t,e,n){return n.method==="planar"?Wi(t,e,n):K(t,e,n)}var vr=6378137;function Ca(t){return ki(t,function(e,n){return e+ja(n)},0)}function ja(t){var e=0,n;switch(t.type){case"Polygon":return pr(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)e+=pr(t.coordinates[n]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function pr(t){var e=0;if(t&&t.length>0){e+=Math.abs(yr(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(yr(t[n]))}return e}function yr(t){var e,n,i,r,o,a,s,u=0,l=t.length;if(l>2){for(s=0;s<l;s++)s===l-2?(r=l-2,o=l-1,a=0):s===l-1?(r=l-1,o=0,a=1):(r=s,o=s+1,a=s+2),e=t[r],n=t[o],i=t[a],u+=(Et(i[0])-Et(e[0]))*Math.sin(Et(n[1]));u=u*vr*vr/2}return u}function Et(t){return t*Math.PI/180}function Fa(t,e){return e===void 0&&(e={}),Li(t,function(n,i){var r=i.geometry.coordinates;return n+K(r[0],r[1],e)},0)}function Se(t,e,n){n===void 0&&(n={});for(var i=z(t),r=Q(e),o=0;o<r.length-1;o++){var a=!1;if(n.ignoreEndVertices&&(o===0&&(a="start"),o===r.length-2&&(a="end"),o===0&&o+1===r.length-1&&(a="both")),za(r[o],r[o+1],i,a,typeof n.epsilon>"u"?null:n.epsilon))return!0}return!1}function za(t,e,n,i,r){var o=n[0],a=n[1],s=t[0],u=t[1],l=e[0],c=e[1],f=n[0]-s,p=n[1]-u,d=l-s,P=c-u,g=f*P-p*d;if(r!==null){if(Math.abs(g)>r)return!1}else if(g!==0)return!1;if(i){if(i==="start")return Math.abs(d)>=Math.abs(P)?d>0?s<o&&o<=l:l<=o&&o<s:P>0?u<a&&a<=c:c<=a&&a<u;if(i==="end")return Math.abs(d)>=Math.abs(P)?d>0?s<=o&&o<l:l<o&&o<=s:P>0?u<=a&&a<c:c<a&&a<=u;if(i==="both")return Math.abs(d)>=Math.abs(P)?d>0?s<o&&o<l:l<o&&o<s:P>0?u<a&&a<c:c<a&&a<u}else return Math.abs(d)>=Math.abs(P)?d>0?s<=o&&o<=l:l<=o&&o<=s:P>0?u<=a&&a<=c:c<=a&&a<=u;return!1}function Wa(t,e){e===void 0&&(e={});var n=e.precision,i=e.coordinates,r=e.mutate;if(n=n==null||isNaN(n)?6:n,i=i==null||isNaN(i)?3:i,!t)throw new Error("<geojson> is required");if(typeof n!="number")throw new Error("<precision> must be a number");if(typeof i!="number")throw new Error("<coordinates> must be a number");(r===!1||r===void 0)&&(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return le(t,function(a){Ya(a,o,i)}),t}function Ya(t,e,n){t.length>n&&t.splice(n,t.length);for(var i=0;i<t.length;i++)t[i]=Math.round(t[i]*e)/e;return t}function Xa(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=xt(t),i=xt(e);if(n!=="LineString")throw new Error("line must be LineString");if(i==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(i==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var r=Wa(e,{precision:7});switch(i){case"Point":return Nt(t,r);case"MultiPoint":return dr(t,r);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return dr(t,ke(t,r))}}function dr(t,e){var n=[],i=Zn();return ae(e,function(r){if(n.forEach(function(s,u){s.id=u}),!n.length)n=Nt(t,r).features,n.forEach(function(s){s.bbox||(s.bbox=pa(pe(s)))}),i.load(H(n));else{var o=i.search(r);if(o.features.length){var a=Yi(r,o);n=n.filter(function(s){return s.id!==a.id}),i.remove(a),_e(Nt(a,r),function(s){n.push(s),i.insert(s)})}}}),H(n)}function Nt(t,e){var n=[],i=Q(t)[0],r=Q(t)[t.geometry.coordinates.length-1];if(_t(i,z(e))||_t(r,z(e)))return H([t]);var o=Zn(),a=It(t);o.load(a);var s=o.search(e);if(!s.features.length)return H([t]);var u=Yi(e,s),l=[i],c=Si(a,function(f,p,d){var P=Q(p)[1],g=z(e);return d===u.id?(f.push(g),n.push(D(f)),_t(g,P)?[g]:[g,P]):(f.push(P),f)},l);return c.length>1&&n.push(D(c)),H(n)}function Yi(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var n,i=1/0;return _e(e,function(r){var o=zi(r,t),a=o.properties.dist;a<i&&(n=r,i=a)}),n}function _t(t,e){return t[0]===e[0]&&t[1]===e[1]}function Gt(t,e){e===void 0&&(e={});var n=Z(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return Ja(n,e);case"MultiPolygon":return Ua(n,e);default:throw new Error("invalid poly")}}function Ja(t,e){e===void 0&&(e={});var n=Z(t),i=n.coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Xi(i,r)}function Ua(t,e){e===void 0&&(e={});var n=Z(t),i=n.coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{},o=[];return i.forEach(function(a){o.push(Xi(a,r))}),H(o)}function Xi(t,e){return t.length>1?dt(t,e):D(t[0],e)}function qa(t,e){e===void 0&&(e={});var n,i,r,o=e.properties,a=(n=e.autoComplete)!==null&&n!==void 0?n:!0,s=(i=e.orderCoords)!==null&&i!==void 0?i:!0,u=(r=e.mutate)!==null&&r!==void 0?r:!1;switch(u||(t=Ai(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(c){l.push(Q(gr(c,{},a,s)))}),De(l,o);default:return gr(t,o,a,s)}}function gr(t,e,n,i){e=e||(t.type==="Feature"?t.properties:{});var r=Z(t),o=r.coordinates,a=r.type;if(!o.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return n&&(o=mr(o)),ge([o],e);case"MultiLineString":var s=[],u=0;return o.forEach(function(l){if(n&&(l=mr(l)),i){var c=Ha(pe(D(l)));c>u?(s.unshift(l),u=c):s.push(l)}else s.push(l)}),ge(s,e);default:throw new Error("geometry type "+a+" is not supported")}}function mr(t){var e=t[0],n=e[0],i=e[1],r=t[t.length-1],o=r[0],a=r[1];return(n!==o||i!==a)&&t.push(e),t}function Ha(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.abs(e-i)*Math.abs(n-r)}function Qa(t,e,n){n===void 0&&(n={});var i;n.final?i=br(z(e),z(t)):i=br(z(t),z(e));var r=i>180?-(360-i):i;return r}function br(t,e){var n=F(t[1]),i=F(e[1]),r=F(e[0]-t[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),a=Math.atan2(r,o);return(Ee(a)+360)%360}function Va(t,e,n,i){i===void 0&&(i={});var r=e<0,o=mt(Math.abs(e),i.units,"meters");r&&(o=-Math.abs(o));var a=z(t),s=Ka(a,o,n);return s[0]+=s[0]-a[0]>180?-360:a[0]-s[0]>180?360:0,N(s,i.properties)}function Ka(t,e,n,i){i=i===void 0?C:Number(i);var r=e/i,o=t[0]*Math.PI/180,a=F(t[1]),s=F(n),u=r*Math.cos(s),l=a+u;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),f=Math.abs(c)>1e-11?u/c:Math.cos(a),p=r*Math.sin(s)/f,d=o+p;return[(d*180/Math.PI+540)%360-180,l*180/Math.PI]}function Za(t,e,n,i){if(i=i||{},!$e(i))throw new Error("options is invalid");var r=i.units,o=i.zTranslation,a=i.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(o&&typeof o!="number"&&isNaN(o))throw new Error("zTranslation is not a number");if(o=o!==void 0?o:0,e===0&&o===0)return t;if(n==null||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n=n+180),(a===!1||a===void 0)&&(t=Ai(t)),le(t,function(s){var u=Q(Va(s,e,n,{units:r}));s[0]=u[0],s[1]=u[1],o&&s.length===3&&(s[2]+=o)}),t}function Je(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function Dt(t,e){return t[0]*e[1]-e[0]*t[1]}function es(t,e){return[t[0]+e[0],t[1]+e[1]]}function ts(t,e){return[t[0]-e[0],t[1]-e[1]]}function ns(t,e){return[t*e[0],t*e[1]]}function rs(t,e){var n=t[0],i=Je(t),r=e[0],o=Je(e),a=Dt(i,o),s=ts(r,n),u=Dt(s,o),l=u/a,c=es(n,ns(l,i));return c}function is(t,e){var n=Je(t),i=Je(e);return Dt(n,i)===0}function os(t,e){return is(t,e)?!1:rs(t,e)}function wr(t,e,n){if(n=n||{},!$e(n))throw new Error("options is invalid");var i=n.units;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var r=xt(t),o=t.properties;switch(r){case"LineString":return Or(t,e,i);case"MultiLineString":var a=[];return ae(t,function(s){a.push(Or(s,e,i).geometry.coordinates)}),dt(a,o);default:throw new Error("geometry "+r+" is not supported")}}function Or(t,e,n){var i=[],r=Ei(e,n),o=Q(t),a=[];return o.forEach(function(s,u){if(u!==o.length-1){var l=as(s,o[u+1],r);if(i.push(l),u>0){var c=i[u-1],f=os(l,c);f!==!1&&(c[1]=f,l[0]=f),a.push(c[0]),u===o.length-2&&(a.push(l[0]),a.push(l[1]))}o.length===2&&(a.push(l[0]),a.push(l[1]))}}),D(a,t.properties)}function as(t,e,n){var i=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),r=t[0]+n*(e[1]-t[1])/i,o=e[0]+n*(e[1]-t[1])/i,a=t[1]+n*(t[0]-e[0])/i,s=e[1]+n*(t[0]-e[0])/i;return[[r,a],[o,s]]}function er(t,e){var n=!0;return ae(t,function(i){ae(e,function(r){if(n===!1)return!1;n=ss(i.geometry,r.geometry)})}),n}function ss(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!fs(t.coordinates,e.coordinates);case"LineString":return!Pr(e,t);case"Polygon":return!se(t,e)}break;case"LineString":switch(e.type){case"Point":return!Pr(t,e);case"LineString":return!us(t,e);case"Polygon":return!Er(e,t)}break;case"Polygon":switch(e.type){case"Point":return!se(e,t);case"LineString":return!Er(t,e);case"Polygon":return!ls(e,t)}}return!1}function Pr(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(cs(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function us(t,e){var n=ke(t,e);return n.features.length>0}function Er(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var r=i[n];if(se(r,t))return!0}var o=ke(e,Gt(t));return o.features.length>0}function ls(t,e){for(var n=0,i=t.coordinates[0];n<i.length;n++){var r=i[n];if(se(r,e))return!0}for(var o=0,a=e.coordinates[0];o<a.length;o++){var s=a[o];if(se(s,t))return!0}var u=ke(Gt(t),Gt(e));return u.features.length>0}function cs(t,e,n){var i=n[0]-t[0],r=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],s=i*a-r*o;return s!==0?!1:Math.abs(o)>=Math.abs(a)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function fs(t,e){return t[0]===e[0]&&t[1]===e[1]}function hs(t,e){var n=Z(t),i=Z(e),r=n.type,o=i.type,a=n.coordinates,s=i.coordinates;switch(r){case"Point":switch(o){case"Point":return tr(a,s);default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"Point":return vs(n,i);case"MultiPoint":return ps(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return Se(i,n,{ignoreEndVertices:!0});case"LineString":return gs(n,i);case"MultiPoint":return ys(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return se(i,n,{ignoreBoundary:!0});case"LineString":return ms(n,i);case"Polygon":return bs(n,i);case"MultiPoint":return ds(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function vs(t,e){var n,i=!1;for(n=0;n<t.coordinates.length;n++)if(tr(t.coordinates[n],e.coordinates)){i=!0;break}return i}function ps(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){for(var r=i[n],o=!1,a=0,s=t.coordinates;a<s.length;a++){var u=s[a];if(tr(r,u)){o=!0;break}}if(!o)return!1}return!0}function ys(t,e){for(var n=!1,i=0,r=e.coordinates;i<r.length;i++){var o=r[i];if(Se(o,t,{ignoreEndVertices:!0})&&(n=!0),!Se(o,t))return!1}return!!n}function ds(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var r=i[n];if(!se(r,t,{ignoreBoundary:!0}))return!1}return!0}function gs(t,e){for(var n=!1,i=0,r=e.coordinates;i<r.length;i++){var o=r[i];if(Se({type:"Point",coordinates:o},t,{ignoreEndVertices:!0})&&(n=!0),!Se({type:"Point",coordinates:o},t,{ignoreEndVertices:!1}))return!1}return n}function ms(t,e){var n=!1,i=0,r=pe(t),o=pe(e);if(!Ji(r,o))return!1;for(i;i<e.coordinates.length-1;i++){var a=ws(e.coordinates[i],e.coordinates[i+1]);if(se({type:"Point",coordinates:a},t,{ignoreBoundary:!0})){n=!0;break}}return n}function bs(t,e){if(t.type==="Feature"&&t.geometry===null||e.type==="Feature"&&e.geometry===null)return!1;var n=pe(t),i=pe(e);if(!Ji(n,i))return!1;for(var r=Z(e).coordinates,o=0,a=r;o<a.length;o++)for(var s=a[o],u=0,l=s;u<l.length;u++){var c=l[u];if(!se(c,t))return!1}return!0}function Ji(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function tr(t,e){return t[0]===e[0]&&t[1]===e[1]}function ws(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Os(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=l[0]&2?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],r=0}finally{i=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var ye=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function Ps(t,e){return t>e?1:t<e?-1:0}function fe(t,e,n){for(var i=new ye(null,null),r=i,o=i;;){var a=n(t,e.key);if(a<0){if(e.left===null)break;if(n(t,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(a>0){if(e.right===null)break;if(n(t,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}r.right=e,r=e,e=e.right}else break}return r.right=e.left,o.left=e.right,e.left=i.right,e.right=i.left,e}function St(t,e,n,i){var r=new ye(t,e);if(n===null)return r.left=r.right=null,r;n=fe(t,n,i);var o=i(t,n.key);return o<0?(r.left=n.left,r.right=n,n.left=null):o>=0&&(r.right=n.right,r.left=n,n.right=null),r}function _r(t,e,n){var i=null,r=null;if(e){e=fe(t,e,n);var o=n(e.key,t);o===0?(i=e.left,r=e.right):o<0?(r=e.right,e.right=null,i=e):(i=e.left,e.left=null,r=e)}return{left:i,right:r}}function Es(t,e,n){return e===null?t:(t===null||(e=fe(t.key,e,n),e.left=t),e)}function $t(t,e,n,i,r){if(t){i(""+e+(n?"└── ":"├── ")+r(t)+`
`);var o=e+(n?"    ":"│   ");t.left&&$t(t.left,o,!1,i,r),t.right&&$t(t.right,o,!0,i,r)}}var nr=function(){function t(e){e===void 0&&(e=Ps),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=St(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var i=new ye(e,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,o=fe(e,this._root,r),a=r(e,o.key);return a===0?this._root=o:(a<0?(i.left=o.left,i.right=o,o.left=null):a>0&&(i.right=o.right,i.left=o,o.right=null),this._size++,this._root=i),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,i){var r;if(n===null)return null;n=fe(e,n,i);var o=i(e,n.key);return o===0?(n.left===null?r=n.right:(r=fe(e,n.left,i),r.right=n.right),this._size--,r):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=fe(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,i=this._comparator;n;){var r=i(e,n.key);if(r===0)return n;r<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=fe(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,i=this._comparator;n;){var r=i(e,n.key);if(r===0)return!0;r<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var i=this._root,r=[],o=!1;!o;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),e.call(n,i),i=i.right):o=!0;return this},t.prototype.range=function(e,n,i,r){for(var o=[],a=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=a(s.key,n),u>0)break;if(a(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var i=n.key;return e.push(i)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var i=n.data;return e.push(i)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,i=!1,r=0,o=[];!i;)if(n)o.push(n),n=n.left;else if(o.length>0){if(n=o.pop(),r===e)return n;r++,n=n.right}else i=!0;return null},t.prototype.next=function(e){var n=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var r=this._comparator;n;){var o=r(e.key,n.key);if(o===0)break;o<0?(i=n,n=n.left):n=n.right}return i},t.prototype.prev=function(e){var n=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var r=this._comparator;n;){var o=r(e.key,n.key);if(o===0)break;o<0?n=n.left:(i=n,n=n.right)}return i},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return Ss(this._root)},t.prototype.load=function(e,n,i){n===void 0&&(n=[]),i===void 0&&(i=!1);var r=e.length,o=this._comparator;if(i&&Ft(e,n,0,r-1,o),this._root===null)this._root=Ct(e,n,0,r),this._size=r;else{var a=ks(this.toList(),_s(e,n),o);r=this._size+r,this._root=jt({head:a},0,r)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var n=[];return $t(this._root,"",!0,function(i){return n.push(i)},e),n.join("")},t.prototype.update=function(e,n,i){var r=this._comparator,o=_r(e,this._root,r),a=o.left,s=o.right;r(e,n)<0?s=St(n,i,s,r):a=St(n,i,a,r),this._root=Es(a,s,r)},t.prototype.split=function(e){return _r(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e;return Os(this,function(n){switch(n.label){case 0:e=this.minNode(),n.label=1;case 1:return e?[4,e]:[3,3];case 2:return n.sent(),e=this.next(e),[3,1];case 3:return[2]}})},t}();function Ct(t,e,n,i){var r=i-n;if(r>0){var o=n+Math.floor(r/2),a=t[o],s=e[o],u=new ye(a,s);return u.left=Ct(t,e,n,o),u.right=Ct(t,e,o+1,i),u}return null}function _s(t,e){for(var n=new ye(null,null),i=n,r=0;r<t.length;r++)i=i.next=new ye(t[r],e[r]);return i.next=null,n.next}function Ss(t){for(var e=t,n=[],i=!1,r=new ye(null,null),o=r;!i;)e?(n.push(e),e=e.left):n.length>0?(e=o=o.next=n.pop(),e=e.right):i=!0;return o.next=null,r.next}function jt(t,e,n){var i=n-e;if(i>0){var r=e+Math.floor(i/2),o=jt(t,e,r),a=t.head;return a.left=o,t.head=t.head.next,a.right=jt(t,r+1,n),a}return null}function ks(t,e,n){for(var i=new ye(null,null),r=i,o=t,a=e;o!==null&&a!==null;)n(o.key,a.key)<0?(r.next=o,o=o.next):(r.next=a,a=a.next),r=r.next;return o!==null?r.next=o:a!==null&&(r.next=a),i.next}function Ft(t,e,n,i,r){if(!(n>=i)){for(var o=t[n+i>>1],a=n-1,s=i+1;;){do a++;while(r(t[a],o)<0);do s--;while(r(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}Ft(t,e,n,s,r),Ft(t,e,s+1,i,r)}}function ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function X(t,e,n){return e&&Sr(t.prototype,e),n&&Sr(t,n),t}var Me=function(e,n){return e.ll.x<=n.x&&n.x<=e.ur.x&&e.ll.y<=n.y&&n.y<=e.ur.y},zt=function(e,n){if(n.ur.x<e.ll.x||e.ur.x<n.ll.x||n.ur.y<e.ll.y||e.ur.y<n.ll.y)return null;var i=e.ll.x<n.ll.x?n.ll.x:e.ll.x,r=e.ur.x<n.ur.x?e.ur.x:n.ur.x,o=e.ll.y<n.ll.y?n.ll.y:e.ll.y,a=e.ur.y<n.ur.y?e.ur.y:n.ur.y;return{ll:{x:i,y:o},ur:{x:r,y:a}}},he=Number.EPSILON;he===void 0&&(he=Math.pow(2,-52));var Ls=he*he,Wt=function(e,n){if(-he<e&&e<he&&-he<n&&n<he)return 0;var i=e-n;return i*i<Ls*e*n?0:e<n?-1:1},Ms=function(){function t(){ee(this,t),this.reset()}return X(t,[{key:"reset",value:function(){this.xRounder=new kr,this.yRounder=new kr}},{key:"round",value:function(n,i){return{x:this.xRounder.round(n),y:this.yRounder.round(i)}}}]),t}(),kr=function(){function t(){ee(this,t),this.tree=new nr,this.round(0)}return X(t,[{key:"round",value:function(n){var i=this.tree.add(n),r=this.tree.prev(i);if(r!==null&&Wt(i.key,r.key)===0)return this.tree.remove(n),r.key;var o=this.tree.next(i);return o!==null&&Wt(i.key,o.key)===0?(this.tree.remove(n),o.key):n}}]),t}(),Ne=new Ms,Ae=function(e,n){return e.x*n.y-e.y*n.x},Ui=function(e,n){return e.x*n.x+e.y*n.y},Lr=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y},a=Ae(r,o);return Wt(a,0)},Ue=function(e){return Math.sqrt(Ui(e,e))},Rs=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y};return Ae(o,r)/Ue(o)/Ue(r)},As=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y};return Ui(o,r)/Ue(o)/Ue(r)},Mr=function(e,n,i){return n.y===0?null:{x:e.x+n.x/n.y*(i-e.y),y:i}},Rr=function(e,n,i){return n.x===0?null:{x:i,y:e.y+n.y/n.x*(i-e.x)}},xs=function(e,n,i,r){if(n.x===0)return Rr(i,r,e.x);if(r.x===0)return Rr(e,n,i.x);if(n.y===0)return Mr(i,r,e.y);if(r.y===0)return Mr(e,n,i.y);var o=Ae(n,r);if(o==0)return null;var a={x:i.x-e.x,y:i.y-e.y},s=Ae(a,n)/o,u=Ae(a,r)/o,l=e.x+u*n.x,c=i.x+s*r.x,f=e.y+u*n.y,p=i.y+s*r.y,d=(l+c)/2,P=(f+p)/2;return{x:d,y:P}},oe=function(){X(t,null,[{key:"compare",value:function(n,i){var r=t.comparePoints(n.point,i.point);return r!==0?r:(n.point!==i.point&&n.link(i),n.isLeft!==i.isLeft?n.isLeft?1:-1:qe.compare(n.segment,i.segment))}},{key:"comparePoints",value:function(n,i){return n.x<i.x?-1:n.x>i.x?1:n.y<i.y?-1:n.y>i.y?1:0}}]);function t(e,n){ee(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return X(t,[{key:"link",value:function(n){if(n.point===this.point)throw new Error("Tried to link already linked events");for(var i=n.point.events,r=0,o=i.length;r<o;r++){var a=i[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var n=this.point.events.length,i=0;i<n;i++){var r=this.point.events[i];if(r.segment.consumedBy===void 0)for(var o=i+1;o<n;o++){var a=this.point.events[o];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var n=[],i=0,r=this.point.events.length;i<r;i++){var o=this.point.events[i];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&n.push(o)}return n}},{key:"getLeftmostComparator",value:function(n){var i=this,r=new Map,o=function(s){var u=s.otherSE;r.set(s,{sine:Rs(i.point,n.point,u.point),cosine:As(i.point,n.point,u.point)})};return function(a,s){r.has(a)||o(a),r.has(s)||o(s);var u=r.get(a),l=u.sine,c=u.cosine,f=r.get(s),p=f.sine,d=f.cosine;return l>=0&&p>=0?c<d?1:c>d?-1:0:l<0&&p<0?c<d?-1:c>d?1:0:p<l?-1:p>l?1:0}}}]),t}(),Bs=0,qe=function(){X(t,null,[{key:"compare",value:function(n,i){var r=n.leftSE.point.x,o=i.leftSE.point.x,a=n.rightSE.point.x,s=i.rightSE.point.x;if(s<r)return 1;if(a<o)return-1;var u=n.leftSE.point.y,l=i.leftSE.point.y,c=n.rightSE.point.y,f=i.rightSE.point.y;if(r<o){if(l<u&&l<c)return 1;if(l>u&&l>c)return-1;var p=n.comparePoint(i.leftSE.point);if(p<0)return 1;if(p>0)return-1;var d=i.comparePoint(n.rightSE.point);return d!==0?d:-1}if(r>o){if(u<l&&u<f)return-1;if(u>l&&u>f)return 1;var P=i.comparePoint(n.leftSE.point);if(P!==0)return P;var g=n.comparePoint(i.rightSE.point);return g<0?1:g>0?-1:1}if(u<l)return-1;if(u>l)return 1;if(a<s){var E=i.comparePoint(n.rightSE.point);if(E!==0)return E}if(a>s){var k=n.comparePoint(i.rightSE.point);if(k<0)return 1;if(k>0)return-1}if(a!==s){var h=c-u,v=a-r,y=f-l,b=s-o;if(h>v&&y<b)return 1;if(h<v&&y>b)return-1}return a>s?1:a<s||c<f?-1:c>f?1:n.id<i.id?-1:n.id>i.id?1:0}}]);function t(e,n,i,r){ee(this,t),this.id=++Bs,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=i,this.windings=r}return X(t,[{key:"replaceRightSE",value:function(n){this.rightSE=n,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var n=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:n<i?n:i},ur:{x:this.rightSE.point.x,y:n>i?n:i}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(n){return n.x===this.leftSE.point.x&&n.y===this.leftSE.point.y||n.x===this.rightSE.point.x&&n.y===this.rightSE.point.y}},{key:"comparePoint",value:function(n){if(this.isAnEndpoint(n))return 0;var i=this.leftSE.point,r=this.rightSE.point,o=this.vector();if(i.x===r.x)return n.x===i.x?0:n.x<i.x?1:-1;var a=(n.y-i.y)/o.y,s=i.x+a*o.x;if(n.x===s)return 0;var u=(n.x-i.x)/o.x,l=i.y+u*o.y;return n.y===l?0:n.y<l?-1:1}},{key:"getIntersection",value:function(n){var i=this.bbox(),r=n.bbox(),o=zt(i,r);if(o===null)return null;var a=this.leftSE.point,s=this.rightSE.point,u=n.leftSE.point,l=n.rightSE.point,c=Me(i,u)&&this.comparePoint(u)===0,f=Me(r,a)&&n.comparePoint(a)===0,p=Me(i,l)&&this.comparePoint(l)===0,d=Me(r,s)&&n.comparePoint(s)===0;if(f&&c)return d&&!p?s:!d&&p?l:null;if(f)return p&&a.x===l.x&&a.y===l.y?null:a;if(c)return d&&s.x===u.x&&s.y===u.y?null:u;if(d&&p)return null;if(d)return s;if(p)return l;var P=xs(a,this.vector(),u,n.vector());return P===null||!Me(o,P)?null:Ne.round(P.x,P.y)}},{key:"split",value:function(n){var i=[],r=n.events!==void 0,o=new oe(n,!0),a=new oe(n,!1),s=this.rightSE;this.replaceRightSE(a),i.push(a),i.push(o);var u=new t(o,s,this.rings.slice(),this.windings.slice());return oe.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),oe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(o.checkForConsuming(),a.checkForConsuming()),i}},{key:"swapEvents",value:function(){var n=this.rightSE;this.rightSE=this.leftSE,this.leftSE=n,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}},{key:"consume",value:function(n){for(var i=this,r=n;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var o=t.compare(i,r);if(o!==0){if(o>0){var a=i;i=r,r=a}if(i.prev===r){var s=i;i=r,r=s}for(var u=0,l=r.rings.length;u<l;u++){var c=r.rings[u],f=r.windings[u],p=i.rings.indexOf(c);p===-1?(i.rings.push(c),i.windings.push(f)):i.windings[p]+=f}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var n=this.prev.consumedBy||this.prev;this._beforeState=n.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var n=this.beforeState();this._afterState={rings:n.rings.slice(0),windings:n.windings.slice(0),multiPolys:[]};for(var i=this._afterState.rings,r=this._afterState.windings,o=this._afterState.multiPolys,a=0,s=this.rings.length;a<s;a++){var u=this.rings[a],l=this.windings[a],c=i.indexOf(u);c===-1?(i.push(u),r.push(l)):r[c]+=l}for(var f=[],p=[],d=0,P=i.length;d<P;d++)if(r[d]!==0){var g=i[d],E=g.poly;if(p.indexOf(E)===-1)if(g.isExterior)f.push(E);else{p.indexOf(E)===-1&&p.push(E);var k=f.indexOf(g.poly);k!==-1&&f.splice(k,1)}}for(var h=0,v=f.length;h<v;h++){var y=f[h].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var n=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(re.type){case"union":{var r=n.length===0,o=i.length===0;this._isInResult=r!==o;break}case"intersection":{var a,s;n.length<i.length?(a=n.length,s=i.length):(a=i.length,s=n.length),this._isInResult=s===re.numMultiPolys&&a<s;break}case"xor":{var u=Math.abs(n.length-i.length);this._isInResult=u%2===1;break}case"difference":{var l=function(f){return f.length===1&&f[0].isSubject};this._isInResult=l(n)!==l(i);break}default:throw new Error("Unrecognized operation type found ".concat(re.type))}return this._isInResult}}],[{key:"fromRing",value:function(n,i,r){var o,a,s,u=oe.comparePoints(n,i);if(u<0)o=n,a=i,s=1;else if(u>0)o=i,a=n,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(n.x,", ").concat(n.y,"]"));var l=new oe(o,!0),c=new oe(a,!1);return new t(l,c,[r],[s])}}]),t}(),Ar=function(){function t(e,n,i){if(ee(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=Ne.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var o=r,a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Ne.round(e[a][0],e[a][1]);u.x===o.x&&u.y===o.y||(this.segments.push(qe.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(r.x!==o.x||r.y!==o.y)&&this.segments.push(qe.fromRing(o,r,this))}return X(t,[{key:"getSweepEvents",value:function(){for(var n=[],i=0,r=this.segments.length;i<r;i++){var o=this.segments[i];n.push(o.leftSE),n.push(o.rightSE)}return n}}]),t}(),Is=function(){function t(e,n){if(ee(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ar(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,r=e.length;i<r;i++){var o=new Ar(e[i],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return X(t,[{key:"getSweepEvents",value:function(){for(var n=this.exteriorRing.getSweepEvents(),i=0,r=this.interiorRings.length;i<r;i++)for(var o=this.interiorRings[i].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),xr=function(){function t(e,n){if(ee(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,r=e.length;i<r;i++){var o=new Is(e[i],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return X(t,[{key:"getSweepEvents",value:function(){for(var n=[],i=0,r=this.polys.length;i<r;i++)for(var o=this.polys[i].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),Ts=function(){X(t,null,[{key:"factory",value:function(n){for(var i=[],r=0,o=n.length;r<o;r++){var a=n[r];if(!(!a.isInResult()||a.ringOut)){for(var s=null,u=a.leftSE,l=a.rightSE,c=[u],f=u.point,p=[];s=u,u=l,c.push(u),u.point!==f;)for(;;){var d=u.getAvailableLinkedEvents();if(d.length===0){var P=c[0].point,g=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(P.x,",")+" ".concat(P.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(d.length===1){l=d[0].otherSE;break}for(var E=null,k=0,h=p.length;k<h;k++)if(p[k].point===u.point){E=k;break}if(E!==null){var v=p.splice(E)[0],y=c.splice(v.index);y.unshift(y[0].otherSE),i.push(new t(y.reverse()));continue}p.push({index:c.length,point:u.point});var b=u.getLeftmostComparator(s);l=d.sort(b)[0].otherSE;break}i.push(new t(c))}}return i}}]);function t(e){ee(this,t),this.events=e;for(var n=0,i=e.length;n<i;n++)e[n].segment.ringOut=this;this.poly=null}return X(t,[{key:"getGeom",value:function(){for(var n=this.events[0].point,i=[n],r=1,o=this.events.length-1;r<o;r++){var a=this.events[r].point,s=this.events[r+1].point;Lr(a,n,s)!==0&&(i.push(a),n=a)}if(i.length===1)return null;var u=i[0],l=i[1];Lr(u,n,l)===0&&i.shift(),i.push(i[0]);for(var c=this.isExteriorRing()?1:-1,f=this.isExteriorRing()?0:i.length-1,p=this.isExteriorRing()?i.length:-1,d=[],P=f;P!=p;P+=c)d.push([i[P].x,i[P].y]);return d}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var n=this.enclosingRing();this._isExteriorRing=n?!n.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var n=this.events[0],i=1,r=this.events.length;i<r;i++){var o=this.events[i];oe.compare(n,o)>0&&(n=o)}for(var a=n.segment.prevInResult(),s=a?a.prevInResult():null;;){if(!a)return null;if(!s)return a.ringOut;if(s.ringOut!==a.ringOut)return s.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=s.prevInResult(),s=a?a.prevInResult():null}}}]),t}(),Br=function(){function t(e){ee(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return X(t,[{key:"addInterior",value:function(n){this.interiorRings.push(n),n.poly=this}},{key:"getGeom",value:function(){var n=[this.exteriorRing.getGeom()];if(n[0]===null)return null;for(var i=0,r=this.interiorRings.length;i<r;i++){var o=this.interiorRings[i].getGeom();o!==null&&n.push(o)}return n}}]),t}(),Ns=function(){function t(e){ee(this,t),this.rings=e,this.polys=this._composePolys(e)}return X(t,[{key:"getGeom",value:function(){for(var n=[],i=0,r=this.polys.length;i<r;i++){var o=this.polys[i].getGeom();o!==null&&n.push(o)}return n}},{key:"_composePolys",value:function(n){for(var i=[],r=0,o=n.length;r<o;r++){var a=n[r];if(!a.poly)if(a.isExteriorRing())i.push(new Br(a));else{var s=a.enclosingRing();s.poly||i.push(new Br(s)),s.poly.addInterior(a)}}return i}}]),t}(),Gs=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qe.compare;ee(this,t),this.queue=e,this.tree=new nr(n),this.segments=[]}return X(t,[{key:"process",value:function(n){var i=n.segment,r=[];if(n.consumedBy)return n.isLeft?this.queue.remove(n.otherSE):this.tree.remove(i),r;var o=n.isLeft?this.tree.insert(i):this.tree.find(i);if(!o)throw new Error("Unable to find segment #".concat(i.id," ")+"[".concat(i.leftSE.point.x,", ").concat(i.leftSE.point.y,"] -> ")+"[".concat(i.rightSE.point.x,", ").concat(i.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,s=o,u=void 0,l=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(n.isLeft){var c=null;if(u){var f=u.getIntersection(i);if(f!==null&&(i.isAnEndpoint(f)||(c=f),!u.isAnEndpoint(f)))for(var p=this._splitSafely(u,f),d=0,P=p.length;d<P;d++)r.push(p[d])}var g=null;if(l){var E=l.getIntersection(i);if(E!==null&&(i.isAnEndpoint(E)||(g=E),!l.isAnEndpoint(E)))for(var k=this._splitSafely(l,E),h=0,v=k.length;h<v;h++)r.push(k[h])}if(c!==null||g!==null){var y=null;if(c===null)y=g;else if(g===null)y=c;else{var b=oe.comparePoints(c,g);y=b<=0?c:g}this.queue.remove(i.rightSE),r.push(i.rightSE);for(var S=i.split(y),_=0,M=S.length;_<M;_++)r.push(S[_])}r.length>0?(this.tree.remove(i),r.push(n)):(this.segments.push(i),i.prev=u)}else{if(u&&l){var R=u.getIntersection(l);if(R!==null){if(!u.isAnEndpoint(R))for(var x=this._splitSafely(u,R),m=0,O=x.length;m<O;m++)r.push(x[m]);if(!l.isAnEndpoint(R))for(var w=this._splitSafely(l,R),A=0,Y=w.length;A<Y;A++)r.push(w[A])}}this.tree.remove(i)}return r}},{key:"_splitSafely",value:function(n,i){this.tree.remove(n);var r=n.rightSE;this.queue.remove(r);var o=n.split(i);return o.push(r),n.consumedBy===void 0&&this.tree.insert(n),o}}]),t}(),Ir=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ds=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,$s=function(){function t(){ee(this,t)}return X(t,[{key:"run",value:function(n,i,r){re.type=n,Ne.reset();for(var o=[new xr(i,!0)],a=0,s=r.length;a<s;a++)o.push(new xr(r[a],!1));if(re.numMultiPolys=o.length,re.type==="difference")for(var u=o[0],l=1;l<o.length;)zt(o[l].bbox,u.bbox)!==null?l++:o.splice(l,1);if(re.type==="intersection"){for(var c=0,f=o.length;c<f;c++)for(var p=o[c],d=c+1,P=o.length;d<P;d++)if(zt(p.bbox,o[d].bbox)===null)return[]}for(var g=new nr(oe.compare),E=0,k=o.length;E<k;E++)for(var h=o[E].getSweepEvents(),v=0,y=h.length;v<y;v++)if(g.insert(h[v]),g.size>Ir)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var b=new Gs(g),S=g.size,_=g.pop();_;){var M=_.key;if(g.size===S){var R=M.segment;throw new Error("Unable to pop() ".concat(M.isLeft?"left":"right"," SweepEvent ")+"[".concat(M.point.x,", ").concat(M.point.y,"] from segment #").concat(R.id," ")+"[".concat(R.leftSE.point.x,", ").concat(R.leftSE.point.y,"] -> ")+"[".concat(R.rightSE.point.x,", ").concat(R.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Ir)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>Ds)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var x=b.process(M),m=0,O=x.length;m<O;m++){var w=x[m];w.consumedBy===void 0&&g.insert(w)}S=g.size,_=g.pop()}Ne.reset();var A=Ts.factory(b.segments),Y=new Ns(A);return Y.getGeom()}}]),t}(),re=new $s,Cs=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return re.run("union",e,i)},js=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return re.run("intersection",e,i)},Fs=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return re.run("xor",e,i)},zs=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return re.run("difference",e,i)},qi={union:Cs,intersection:js,xor:Fs,difference:zs};function Ws(t,e){var n=Z(t),i=Z(e),r=t.properties||{},o=qi.difference(n.coordinates,i.coordinates);return o.length===0?null:o.length===1?ge(o[0],r):De(o,r)}function Hi(t,e,n){n===void 0&&(n={});var i=Z(t),r=Z(e),o=qi.union(i.coordinates,r.coordinates);return o.length===0?null:o.length===1?ge(o[0],n.properties):De(o,n.properties)}var j={getLineCenter:function(e,n){e instanceof BMapGL.Point&&n instanceof BMapGL.Point&&(e=N([e.lng,e.lat]),n=N([n.lng,n.lat]));var i=da(e,n),r=new BMapGL.Point(i.geometry.coordinates[0],i.geometry.coordinates[1]);return{geoCenter:i,bdCenter:r}},getDistance:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers";e instanceof BMapGL.Point&&n instanceof BMapGL.Point&&(e=N([e.lng,e.lat]),n=N([n.lng,n.lat]));var r={units:i};return K(e,n,r)},getLength:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kilometers";return Fa(e,{units:n})},getPolygonCenter:function(e){var n=ga(e),i=new BMapGL.Point(n.geometry.coordinates[0],n.geometry.coordinates[1]);return{geoCenter:n,bdCenter:i}},getPolygonArea:function(e){return e instanceof BMapGL.Polygon&&(e=e.toGeoJSON()),Ca(e)/1e6},unionPolygon:function(e){for(var n=e[0],i=0,r=e.length;i<r;i++)n=Hi(n,e[i]);return n},isDisjoint:function(e,n){return!er(e,n)},intersect:function(e,n){var i=[];if(n.__proto__ instanceof BMapGL.Overlay)if(n.toGeoJSON)n=n.toGeoJSON();else return i;return e.forEach(function(r){var o=r;if(r.__proto__ instanceof BMapGL.Overlay)if(r.toGeoJSON)o=r.toGeoJSON();else return!0;var a=j.isDisjoint(o,n);a&&i.push(r)}),i},isContains:function(e,n){return hs(e,n)},isPointOnLine:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreEndVertices:!1};return e instanceof BMapGL.Point&&(e=e.toGeoJSON()),n instanceof BMapGL.Polyline&&(n=n.toGeoJSON()),Se(e,n,i)},isPointInPolygon:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreBoundary:!0};return e instanceof BMapGL.Point&&(e=e.toGeoJSON()),n instanceof BMapGL.Polygon&&(n=n.toGeoJSON()),se(e,n,i)},getDistance2Lines:function(e,n){var i=N([e.lng,e.lat]),r=D(n);return Da(i,r)},getNearestPointOnLine:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers",r=N([e.lng,e.lat]),o=[];n.geometry.type==="Polygon"?o=n.geometry.coordinates[0]:n.geometry.type==="LineString"&&(o=n.geometry.coordinates);var a=D(o),s=zi(a,r,i),u=new BMapGL.Point(s.geometry.coordinates[0],s.geometry.coordinates[1]),l=K(r,s);return{geoPoint:r,geoNearestPoint:s,toLineDistance:l,bdNearestPoint:u}}};function Yt(t){return Yt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yt(t)}function Ys(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Xs(t,e,n){return e&&Tr(t.prototype,e),n&&Tr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Js(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xt(t,e)}function Xt(t,e){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Xt(t,e)}function Us(t){var e=Qs();return function(){var i=He(t),r;if(e){var o=He(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return qs(this,r)}}function qs(t,e){if(e&&(Yt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Hs(t)}function Hs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},He(t)}var Vs=function(t){Js(n,t);var e=Us(n);function n(i){var r;return Ys(this,n),r=e.call(this),r.point=void 0,r.overlay=void 0,r.map=i,r}return Xs(n,[{key:"confirmOperate",value:function(){var r=this.overlay.toString();r==="Polyline"||r==="Polygon"?this.overlay.disableEditing():r==="Marker"&&this.overlay.disableDragging(),this.dispatchEvent(new I("ok",this.overlay))}},{key:"cancelOperate",value:function(){this.dispatchEvent(new I("cancel",this.overlay))}},{key:"setPosition",value:function(r,o){this.point=r;var a=this.map,s=a.pointToOverlayPixel(this.point);o?(this.div.classList.remove("operateLeft"),this.div.style.left=s.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=s.x-105+"px"),this.div.style.top=s.y-16+"px"}},{key:"draw",value:function(){var r=this.map,o=r.pointToOverlayPixel(this.point);this.div.style.left=o.x+15+"px",this.div.style.top=o.y-16+"px"}},{key:"calculateOverlay",value:function(){var r={data:0},o=this.overlay.toString();switch(o){case"Polyline":r.data=j.getLength(this.overlay.toGeoJSON())*1e3;break;case"Polygon":r.data=j.getPolygonArea(this.overlay)*1e6;break;case"Circle":var a=this.overlay.getRadius();r.data=Math.PI*a*a;break}return!r.data||r.data<0?r.data=0:r.data=r.data.toFixed(2),r}}]),n}(Wn(BMapGL.Overlay,q));function Jt(t){return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(t)}function Ks(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zs(t,e,n){return e&&Nr(t.prototype,e),n&&Nr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function eu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ut(t,e)}function Ut(t,e){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Ut(t,e)}function tu(t){var e=iu();return function(){var i=Qe(t),r;if(e){var o=Qe(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return nu(this,r)}}function nu(t,e){if(e&&(Jt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ru(t)}function ru(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function iu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Qe(t){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Qe(t)}var Fe=function(t){eu(n,t);var e=tu(n);function n(i,r){var o;return Ks(this,n),o=e.call(this,i),o.limit=void 0,o.element=r,o}return Zs(n,[{key:"setData",value:function(r){for(var o in r)r.hasOwnProperty(o)&&(this[o]=r[o]);this.type=this.overlay.toString(),this.type==="Marker"?(this.overlayTypeText="可以拖动图标改变位置",this.unit=this.type==="Polyline"?"万米":"万平方米"):this.type==="Polyline"?this.overlayTypeText="长度不超过"+(this.limit||1e10)/1e4+"万米！":this.overlayTypeText="面积不超过"+(this.limit||1e10)/1e4+"万平方米！"}},{key:"initialize",value:function(r){var o;if(this.element)o=this.div=this.element,o.className="operateWindow";else{o=this.div=document.createElement("div"),o.className="operateWindow";var a=`<div class="containerbox">
                <span id="confirmOperate"></span>
                <span id="cancelOperate"></span>
                <span id="warnOperate">`.concat(this.overlayTypeText,`</span>
                </div>`);o.innerHTML=a}return r.getPanes().markerPane.appendChild(this.div),this.bind(),this.updateWindow(),o}},{key:"bind",value:function(){var r=this;if(!this.element)document.getElementById("confirmOperate").addEventListener("click",function(o){var a=r.calculateOverlay();r.overlay.geometryCalculate=a,r.confirmOperate()}),document.getElementById("cancelOperate").addEventListener("click",function(o){r.cancelOperate()});else throw console.log("自定义operate必须重写bind方法"),{errMsg:"自定义operate必须重写bind方法"}}},{key:"updateWindow",value:function(){if(this.element)throw console.log("自定义operate必须重写updateWindow方法"),{errMsg:"自定义operate必须重写updateWindow方法"};var r=this.limit||1e7,o=this.calculateOverlay();if(!document.getElementById("confirmOperate"))return;o.data>~~r?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none")}}]),n}(Vs);function qt(t){return qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qt(t)}function ou(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function au(t,e,n){return e&&Gr(t.prototype,e),n&&Gr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function su(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ht(t,e)}function Ht(t,e){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Ht(t,e)}function uu(t){var e=fu();return function(){var i=Ve(t),r;if(e){var o=Ve(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return lu(this,r)}}function lu(t,e){if(e&&(qt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cu(t)}function cu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ve(t){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ve(t)}var Dr=function(t){su(n,t);var e=uu(n);function n(i,r){var o;return ou(this,n),o=e.call(this),o._enableEdgeMove=!1,o.cursor="crosshair",o.container=void 0,o.map=i,r&&(o.cursor=r),o}return au(n,[{key:"initialize",value:function(r){var o=this;this.dispose();var a=r.getSize(),s=this.container=document.createElement("div");return s.style.cssText=`position:absolute;background:transparent;
            cursor:`.concat(this.cursor,";width:").concat(a.width,"px;height:").concat(a.height,"px"),r.addEventListener("resize",function(u){o.adjustSize(u.size)}),r.getPanes().floatPane.appendChild(s),this.bindEvent(),s}},{key:"draw",value:function(){var r=this.map.pixelToPoint(new BMapGL.Pixel(0,0)),o=this.map.pointToOverlayPixel(r);this.container.style.left=o.x+"px",this.container.style.top=o.y+"px"}},{key:"setCursor",value:function(r){this.cursor=r,this.container&&(this.container.style.cursor=r)}},{key:"adjustSize",value:function(r){this.container.style.width=r.width+"px",this.container.style.height=r.height+"px"}},{key:"bindEvent",value:function(){for(var r=this,o=null,a=null,s=function(p){return{x:p.clientX,y:p.clientY}},u=function(p){var d=p.type,P=r.getDrawLatlngPoint(p),g=function(h){p.point=P,r.dispatchEvent(p)};d==="mousedown"&&(o=s(p));var E=s(p);d==="click"?Math.abs(E.x-o.x)<5&&Math.abs(E.y-o.y)<5&&(!a||!(Math.abs(E.x-a.x)<5&&Math.abs(E.y-a.y)<5)?(g(),a=s(p)):a=null):g()},l=["click","mousedown","mousemove","mouseup","dblclick","rightclick"],c=l.length;c--;)L.on(this.container,l[c],u,this._listeners);L.on(this.container,"mousemove",function(f){r._enableEdgeMove&&r.mousemoveAction(f)},this._listeners)}},{key:"mousemoveAction",value:function(r){var o=this;function a(f){var p=f.clientX,d=f.clientY;return f.changedTouches&&(p=f.changedTouches[0].clientX,d=f.changedTouches[0].clientY),new BMapGL.Pixel(p,d)}var s=this.map.pointToPixel(this.getDrawLatlngPoint(r)),u=a(r),l=u.x-s.x,c=u.y-s.y;s=new BMapGL.Pixel(u.x-l,u.y-c),this.draggingMovePixel=s,this.panByX=this.panByY=0,s.x<=20||s.x>=this.map.width-20||s.y<=50||s.y>=this.map.height-10?(s.x<=20?this.panByX=8:s.x>=this.map.width-20&&(this.panByX=-8),s.y<=50?this.panByY=8:s.y>=this.map.height-10&&(this.panByY=-8),this.edgeMoveTimer||(this.edgeMoveTimer=setInterval(function(){o.map.panBy(o.panByX,o.panByY,{noAnimation:!0})},30))):this.edgeMoveTimer&&(clearInterval(this.edgeMoveTimer),this.edgeMoveTimer=null)}},{key:"getDrawLatlngPoint",value:function(r){var o=L.getTarget(r),a=r.offsetX||r.layerX||0,s=r.offsetY||r.layerY||0;for(o.nodeType!==1&&(o=o.parentNode);o&&o!==this.map.getContainer();)o.clientWidth===0&&o.clientHeight===0&&o.offsetParent&&o.offsetParent.nodeName==="TD"||(a+=o.offsetLeft||0,s+=o.offsetTop||0),o=o.offsetParent;var u=new BMapGL.Pixel(a,s),l=this.map.pixelToPoint(u);return l}},{key:"enableEdgeMove",value:function(){this._enableEdgeMove=!0}},{key:"disableEdgeMove",value:function(){clearInterval(this.edgeMoveTimer),this._enableEdgeMove=!1}}]),n}(Wn(BMapGL.Overlay,q));function Qt(t){return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(t)}function hu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vu(t,e,n){return e&&$r(t.prototype,e),n&&$r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function pu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vt(t,e)}function Vt(t,e){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Vt(t,e)}function yu(t){var e=mu();return function(){var i=Ke(t),r;if(e){var o=Ke(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return du(this,r)}}function du(t,e){if(e&&(Qt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gu(t)}function gu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ke(t){return Ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ke(t)}var rr=function(t){pu(n,t);var e=yu(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(hu(this,n),r=e.call(this),r.isOpen=void 0,r.drawType=void 0,r.instances=[],r.selectInstance=[],r.mask=void 0,r.map=void 0,r.operate=void 0,r._currentStatus=G.STATUS_FREE,r._runningAction=null,!(i instanceof BMapGL.Map))throw Error("Scene实例化必须输入map参数");return r.options={},L.deepCopy(Lo,2,r.options,0,[Fe]),L.copyOptions(r.options,o,[Fe]),r.map=i,r.mask=new Dr(i,r.options.drawCursor),r.operate=r.options.operate||new Fe(i),r.options.operate&&(r.options.operate.ignore=!0),r.addMapListener(i),r}return vu(n,[{key:"currentStatus",get:function(){return this._currentStatus},set:function(r){this._currentStatus=r,this.updateMapListenerControl(r)}},{key:"runningAction",get:function(){return this._runningAction},set:function(r){this._runningAction=r}},{key:"addMapListener",value:function(r){var o=this;this.mapSelect=new Oi(r),this.mapSelect.addEventListener(B.CLICK,function(a){o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)}),this.mapSelect.addEventListener(B.RIGHTCLICK,function(a){o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)}),this.mapSelect.addEventListener(B.MOVE,function(a){o._currentStatus!==G.STATUS_DRAWING&&o._currentStatus!==G.STATUS_EDITER&&o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)})}},{key:"updateMapListenerControl",value:function(r){if(this.mapSelect)switch(r){case G.STATUS_FREE:this.mapSelect.open();break;case G.STATUS_EDITER:this.mapSelect.openClick(),this.mapSelect.openMouse();break;case G.STATUS_DRAWING:this.mapSelect.closeClick(),this.mapSelect.openMouse();break;case G.STATUS_MOVE:this.mapSelect.closeClick(),this.mapSelect.openMouse();break;default:this.mapSelect.open();break}}},{key:"open",value:function(){return this.isOpen=!0,this.mask||(this.mask=new Dr(this.map,this.options.drawCursor)),this.map.addOverlay(this.mask),this.setCurrentDrawType(this.drawType),!0}},{key:"close",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isOpen=!1,this.closeRunningAction(),r&&(this.currentStatus=G.STATUS_FREE),this.mask&&this.map.removeOverlay(this.mask)}},{key:"closeRunningAction",value:function(){this.runningAction&&this.runningAction.close instanceof Function&&this.runningAction.close()}},{key:"addOverlay",value:function(r){var o=this.instances.find(function(a){return a===r});o||this.instances.push(r)}},{key:"removeOverlay",value:function(r){var o=this.instances.findIndex(function(a){return a===r});o!==-1&&(this.map.removeOverlay(this.instances[o]),this.instances.splice(o))}},{key:"clearData",value:function(){var r=this;this.instances.forEach(function(o){r.map.removeOverlay(o)}),this.instances.length=0}},{key:"addSelectDrawData",value:function(r){var o=this.selectInstance.find(function(a){return a===r});o||this.selectInstance.push(r)}},{key:"hasOverlay",value:function(r){var o=this.instances.findIndex(function(a){return a===r});return o>-1||(o=this.selectInstance.findIndex(function(a){return a===r}),o>-1)}},{key:"clearSelectDrawData",value:function(){var r=this;this.selectInstance.forEach(function(o){r.map.removeOverlay(o)}),this.selectInstance.length=0}},{key:"setCurrentDrawType",value:function(r){this.drawType=r}},{key:"attachSnapSource",value:function(r){this._attachSnapSource=r}},{key:"setDrawCursor",value:function(r){this.mask&&this.mask.setCursor(r)}}]),n}(q);function Kt(t){return Kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(t)}function Cr(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=bu(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw s}}}}function bu(t,e){if(t){if(typeof t=="string")return jr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jr(t,e)}}function jr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var ve=function(e,n,i,r){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=wu(r.getZoom());i=i*a;var s=Cr(n),u;try{var l=function(){var p=u.value;if(o.find(function(R){return p===R}))return"continue";if(p instanceof BMapGL.Marker){var d=p.getPosition(),P=j.getDistance(e,d,"kilometers")*1e3;return P<i?{v:d}:"continue"}if(p.toGeoJSON){for(var g=p.getPath(),E=[],k=p.toGeoJSON(),h=0;h<g.length-1;h++)E.push(j.getLineCenter(g[h],g[h+1]).bdCenter);var v=Cr(g.concat(E)),y;try{for(v.s();!(y=v.n()).done;){var b=y.value,S=j.getDistance(e,b,"kilometers")*1e3;if(S<i)return{v:b}}}catch(R){v.e(R)}finally{v.f()}var _=j.getNearestPointOnLine(e,k),M=_.toLineDistance*1e3;if(M<i)return{v:_.bdNearestPoint}}};for(s.s();!(u=s.n()).done;){var c=l();if(c!=="continue"&&Kt(c)==="object")return c.v}}catch(f){s.e(f)}finally{s.f()}return null};function wu(t){return Math.pow(2,18-t)}function Zt(t){return Zt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zt(t)}function Ou(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Pu(t,e,n){return e&&Fr(t.prototype,e),n&&Fr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Eu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&en(t,e)}function en(t,e){return en=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},en(t,e)}function _u(t){var e=ku();return function(){var i=Ze(t),r;if(e){var o=Ze(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Qi(this,r)}}function Qi(t,e){if(e&&(Zt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Su(t)}function Su(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ku(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ze(t)}var ue=function(t){Eu(n,t);var e=_u(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ou(this,n),r=e.call(this),r.type=void 0,r.isOpen=void 0,r.isOnMap=!0,r.isSeries=!0,r.skipEditing=!1,r.isSelectDraw=!1,r.enableCalculate=!1,r.enableSnap=!0,r.snapDistance=10,r.enableDragging=!1,r.mouseLnglat=void 0,r.match=null,r.matchOverlay=null,r.matchOverlayRadius=5,!i)return Qi(r);if(!(i instanceof rr))throw Error("DrawBase实例化必须输入scene参数");r.scene=i;var a={};return L.copyOptionsToNew(r.scene.options,o,a),L.copyNotExitOptions(a,r.scene.options),r.defineProperty(a),r.options=a,r.setSnapPointType(r.options),r.setBaseOptions(r.options.baseOpts),r}return Pu(n,[{key:"bindEvent",value:function(){}},{key:"setBaseOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.baseOptions=r}},{key:"setCurrentStatus",value:function(r){this.scene.currentStatus=r}},{key:"skipEdit",value:function(r){r||this.skipEditing?this.scene.operate.confirmOperate():this.scene.mask.hide()}},{key:"emitEventIsonmap",value:function(r){var o=V.DRAW_ON_MAP;this.isSelectDraw&&(o=V.SELECT_ON_MAP);var a=new I(B.COMPLETE,{overlay:r,from:o});this.dispatchEvent(a),this.scene.dispatchEvent(a)}},{key:"emitEventIsnomap",value:function(r){this.scene.currentStatus=G.STATUS_FREE;var o=V.DRAW_NO_MAP;this.isSelectDraw&&(o=V.SELECT_NO_MAP);var a=new I(B.COMPLETE,{overlay:r,from:o});this.dispatchEvent(a),this.scene.dispatchEvent(a)}},{key:"registEvent",value:function(r){var o=this;r.addEventListener(B.INIT,function(a){o.skipEdit()}),r.addEventListener(B.COMPLETE,function(a){o.isSelectDraw?o.scene.addSelectDrawData(a.target.overlay):o.scene.addOverlay(a.target.overlay),a.continue!==!1&&o.isSeries&&(o.isOpen=!0,o.scene.mask.show(),o.bindEvent()),o.dispatchEvent(a),o.editOpe=null}),r.addEventListener(B.CANCEL,function(a){o.isSeries&&(o.isOpen=!0,o.scene.mask.show(),o.bindEvent()),o.dispatchEvent(a),o.editOpe=null})}},{key:"setRunningAction",value:function(r,o){if(r){if(this.isSeries&&this.scene.runningAction===this){o();return}this.scene.closeRunningAction(),this.scene.mask.show(),this.scene.runningAction=this,o(),this.callback&&this.callback()}else this.scene.runningAction=null,this.isOpen=!1,this.scene.mask.hide()}},{key:"closeEdit",value:function(){this.editOpe&&this.editOpe.close()}},{key:"closeAll",value:function(){this.close(),this.closeEdit()}},{key:"open",value:function(r){this.scene&&(this.callback=r,this.scene.drawType=this.type,this.scene.open(),this.isOpen=!0,this.bindEvent())}},{key:"close",value:function(r){r&&r()}},{key:"addLabel",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=new BMapGL.Label(r,{position:o.position,offset:o.offset||new BMapGL.Size(0,0)});return a.setStyle(o.labelOptions),a}},{key:"setRadius",value:function(){var r=this.scene.map.getZoomUnits(),o=this.matchOverlayRadius*r;this.matchOverlay.setRadius(o)}},{key:"addMatchOverlay",value:function(r){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(r),this.scene.map.addEventListener("zoomend",this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(r))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeEventListener("zoomend",this.setRadius.bind(this))}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=ve(r,o,s,u)),!l&&this.scene._attachSnapSource&&(l=ve(r,this.scene._attachSnapSource,s,u)),l||(l=ve(r,a,s,u)),l&&this.addMatchOverlay(l),l}}]),n}(q);function tn(t){return tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(t)}function Lu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Mu(t,e,n){return e&&zr(t.prototype,e),n&&zr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function xe(){return typeof Reflect<"u"&&Reflect.get?xe=Reflect.get.bind():xe=function(e,n,i){var r=Ru(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},xe.apply(this,arguments)}function Ru(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=me(t),t!==null););return t}function Au(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nn(t,e)}function nn(t,e){return nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},nn(t,e)}function xu(t){var e=Tu();return function(){var i=me(t),r;if(e){var o=me(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Bu(this,r)}}function Bu(t,e){if(e&&(tn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iu(t)}function Iu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Tu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function me(t){return me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},me(t)}var Vi=function(t){Au(n,t);var e=xu(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Lu(this,n),r=e.call(this,i,o),r.type=T.DRAWING_MARKER,r.scene.setCurrentDrawType(r.type),r.mouseMoveModel=o.mouseMove||!1,r.isOpen&&r.open(),r}return Mu(n,[{key:"clickAction",value:function(r){var o=this;this.marker&&!this.isOnMap||(this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("click",this.click),this.marker=new BMapGL.Marker(r.point,this.baseOptions),this.scene.map.addOverlay(this.marker),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap?(this.isSeries?(this.scene.mask.show(),this.bindEvent()):this.setCurrentStatus(G.STATUS_FREE),this.scene.addOverlay(this.marker),this.emitEventIsonmap(this.marker),this.enableDragging&&(this.marker.enableDragging(),this.marker.addEventListener("dragstart",this.centerDragstart.bind(this)),this.marker.addEventListener("dragging",this.centerDragging.bind(this)),this.marker.addEventListener("dragend",this.centerDragend.bind(this)))):(setTimeout(function(){o.scene.map.removeOverlay(o.marker),o.marker=null},200),this.emitEventIsnomap(this.marker)))}},{key:"moveAction",value:function(r){var o=new I(B.MOVE,r);this.dispatchEvent(o)}},{key:"centerDragstart",value:function(r){if(this.enableSnap){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}}},{key:"centerDragging",value:function(r){if(this.enableSnap){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}}},{key:"centerDragend",value:function(r){this.emitEventIsonmap(this.marker)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&xe(me(n.prototype),"setRunningAction",this).call(this,!0,function(){r.setCurrentStatus(G.STATUS_DRAWING),r.mouseMoveModel&&r.scene.mask.addEventListener("mousemove",r.mousemove=r.moveAction.bind(r)),r.scene.mask.addEventListener("click",r.click=r.clickAction.bind(r))})}},{key:"close",value:function(r){xe(me(n.prototype),"setRunningAction",this).call(this,!1),this.scene.mask.removeEventListener("click",this.click),this.mouseMoveModel&&this.scene.mask.addEventListener("mousemove",this.mousemove),r&&r()}}]),n}(ue);function rn(t){return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(t)}function Nu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gu(t,e,n){return e&&Wr(t.prototype,e),n&&Wr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Du(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&on(t,e)}function on(t,e){return on=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},on(t,e)}function $u(t){var e=ju();return function(){var i=et(t),r;if(e){var o=et(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Cu(this,r)}}function Cu(t,e){if(e&&(rn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ki(t)}function Ki(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ju(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},et(t)}var wt=function(t){Du(n,t);var e=$u(n);function n(i,r){var o,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Nu(this,n),o=e.call(this),o.overlay=null,o.centerIcon=null,o.moveIcon=null,o.circleMoveIcon=null,!(i instanceof rr))throw Error("EditBase实例化必须输入scene参数");o.scene=i;var s={};return L.copyOptionsToNew(o.scene.options,a,s),L.copyNotExitOptions(s,o.scene.options),o.target=r||Ki(o),o.setOptions(s),o}return Gu(n,[{key:"setOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.defineProperty(r),this.target.__proto__ instanceof ue?this.baseOptions=this.target.baseOptions:this.baseOptions=r.baseOpts}},{key:"saveSouce",value:function(r){this.type===T.DRAWING_CIRCLE?this.source={center:r.getCenterIn().latLng,radius:r.getRadius()}:this.source=r.toGeoJSON()}},{key:"restoreSouce",value:function(r){this.source&&(this.type===T.DRAWING_CIRCLE?(r.setCenter(this.source.center),r.setRadius(this.source.radius)):r.updateByGeoJSON(this.source),this.restoreOpe(r))}},{key:"restoreOpe",value:function(){}},{key:"open",value:function(r,o,a){var s=this;this.scene&&(this.originStyle={icon:r._config.icon,fillColor:r._config.fillColor,fillOpacity:r._config.fillOpacity,strokeColor:r._config.strokeColor,strokeWeight:r._config.strokeWeight,strokeOpacity:r._config.strokeOpacity},this.overlay=r,this.overlay.setOptions(this.baseOptions),this.setRunningAction(!0,function(){s.setSceneStatus(G.STATUS_EDITER),s.edit(r,o),a&&a()}))}},{key:"emitOkEvent",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=V.DRAW_ON_MAP;this.target.__proto__ instanceof ue?this.target.isSelectDraw&&(s=V.SELECT_ON_MAP):s=V.EDIT_ON_MAP;var u=new I(B.COMPLETE,{overlay:r,from:s});u.continue=o,this.dispatchEvent(u),(a||this.type!==T.DRAWING_MARKER)&&this.scene.dispatchEvent(u)}},{key:"close",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;this.overlay&&(this.overlay.setOptions(this.originStyle),this.setRunningAction(!1),this.setSceneStatus(G.STATUS_FREE),this.operateWindow&&(this.removeAttachOverlays(),this.scene.map.removeOverlay(this.operateWindow)),r||this.emitOkEvent(this.overlay,r),(this.type===T.DRAWING_POLYLINE||this.type===T.DRAWING_POLYGON)&&this.overlay.removeEventListener("lineupdate",this.lineUpdate),this.closeOpe(this.overlay),o&&o())}},{key:"setRunningAction",value:function(r,o){r?(this.scene.closeRunningAction(),this.scene.runningAction=this,o()):this.scene.runningAction=null}},{key:"closeOpe",value:function(r){}},{key:"addOperateWindow",value:function(r){var o=this,a=V.DRAW_ON_MAP;this.target.__proto__ instanceof ue?this.target.isSelectDraw&&(a=V.SELECT_ON_MAP):(this.saveSouce(r.overlay),a=V.EDIT_ON_MAP);var s=this.operateWindow=this.scene.operate||new Fe(this.scene.map);return s.setData(r),s.addEventListener("ok",function(u){o.removeAttachOverlays(),o.close(!0),o.emitOkEvent(u.target),s._listeners={}}),s.addEventListener("cancel",function(u){o.removeAttachOverlays(),o.close(!0),o.target.__proto__ instanceof ue?o.scene.map.removeOverlay(r.overlay):o.restoreSouce(r.overlay),a+="-cancel";var l=new I(B.CANCEL,{overlay:u.target,from:a});o.dispatchEvent(l),o.scene.dispatchEvent(l),s._listeners={}}),this.scene.map.addOverlay(s),s}},{key:"removeAttachOverlays",value:function(){for(var r=this.scene.map,o=this.overlays,a=0;a<o.length;a++)if(Array.isArray(o[a]))for(var s in o[a])r.removeOverlay(o[a][s]);else r.removeOverlay(o[a])}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.target.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return l||(l=ve(r,o,s,u)),l||(l=ve(r,a,s,u)),l}}]),n}(q);function an(t){return an=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},an(t)}function Zi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function eo(t,e,n){return e&&Yr(t.prototype,e),n&&Yr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function to(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sn(t,e)}function sn(t,e){return sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},sn(t,e)}function no(t){var e=Wu();return function(){var i=tt(t),r;if(e){var o=tt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Fu(this,r)}}function Fu(t,e){if(e&&(an(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zu(t)}function zu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Wu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tt(t){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},tt(t)}var ro=function(t){to(n,t);var e=no(n);function n(i,r,o){var a;return Zi(this,n),a=e.call(this,i,r,o),a.type=T.DRAWING_POLYLINE,a.scene.setCurrentDrawType(a.type),a}return eo(n,[{key:"edit",value:function(r,o){var a=this;this.overlay=r;var s=!1;this instanceof n&&this.target.__proto__ instanceof ue&&(s=!0);var u={limit:o||null,point:this.getNorthEast(r.getPath()),overlay:r};this.overlays=[];var l=this.addOperateWindow(u);this.lineUpdate=function(c){var f=a.getNorthEast(c.currentTarget.getPath());l.setPosition(f,!0),l.updateWindow();var p=new I(B.CHANGE,c.currentTarget);a.target.dispatchEvent(p)},this.onlinevertexdragging=function(c){var f=c.overlay,p=BMapGL.Projection.convertMC2LL(f.getPoint()),d=null;s?d=a.getSnap(p,a.scene.instances,[a.overlay]):d=a.getSnap(p,a.scene.instances),d&&(c.from.point=BMapGL.Projection.convertLL2MC(d),f.setPoint(c.from.point))},r.enableEditing(),r.addEventListener("lineupdate",this.lineUpdate),r.addEventListener("onlinevertexdragging",this.onlinevertexdragging),this.dispatchEvent(new I(B.INIT))}},{key:"restoreOpe",value:function(r){r.disableEditing()}},{key:"closeOpe",value:function(r){r.disableEditing()}},{key:"getNorthEast",value:function(r){for(var o=0,a=0,s=0;s<r.length;s++)o<r[s].lng&&(o=r[s].lng,a=s);return r[a]}}]),n}(wt),Yu=function(t){to(n,t);var e=no(n);function n(i,r,o){var a;return Zi(this,n),a=e.call(this,i,r,o),a.type=T.DRAWING_POLYGON,a.scene.setCurrentDrawType(a.type),a}return eo(n)}(ro);function un(t){return un=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},un(t)}function io(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function oo(t,e,n){return e&&Xr(t.prototype,e),n&&Xr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Be(){return typeof Reflect<"u"&&Reflect.get?Be=Reflect.get.bind():Be=function(e,n,i){var r=Xu(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Be.apply(this,arguments)}function Xu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=be(t),t!==null););return t}function ao(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ln(t,e)}function ln(t,e){return ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},ln(t,e)}function so(t){var e=qu();return function(){var i=be(t),r;if(e){var o=be(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Ju(this,r)}}function Ju(t,e){if(e&&(un(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Uu(t)}function Uu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function be(t){return be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},be(t)}var Ot=function(t){ao(n,t);var e=so(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return io(this,n),r=e.call(this,i,o),r.type=T.DRAWING_POLYLINE,r.points=[],r.drawPoint=[],r.overlay=null,r.isBinded=!1,r.tipLabel=null,r.measureRes=0,r.scene.setCurrentDrawType(r.type),r.options=o,r.isOpen&&r.open(),r}return oo(n,[{key:"getNorthEast",value:function(r){for(var o=0,a=0,s=0;s<r.length;s++)o<r[s].lng&&(o=r[s].lng,a=s);return r[a]}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.scene.drawType===T.DRAWING_POLYLINE?this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions):this.scene.drawType===T.DRAWING_POLYGON&&(this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions)),this.scene.map.addOverlay(this.overlay)):this.overlay.setPath(this.drawPoint),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"moveAction",value:function(r){var o=r.point;if(this.enableSnap){var a=[];if(this.overlay.points.length>2){var s=this.overlay.getPath().slice(0,this.overlay.points.length-1),u=new this.overlay.constructor(s);a.push(u)}if(this.match=this.getSnap(o,this.scene.instances,a),this.match){this.overlay.setPositionAt(this.drawPoint.length-1,this.match);return}}this.match=null,this.overlay.setPositionAt(this.drawPoint.length-1,r.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"mousemoveAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击确认起点",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"dblclickAction",value:function(r){if(L.preventDefault(r),L.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.limit&&(o=this.scene.drawingType==="polygon"?this.limit.area:this.limit.distance),this.type===T.DRAWING_POLYLINE?this.editOpe=new ro(this.scene,this):this.editOpe=new Yu(this.scene,this);var a=this.editOpe;this.registEvent(a),a.open(this.overlay,o)}else this.scene.map.removeOverlay(this.overlay),this.emitEventIsnomap(this.overlay)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Be(be(n.prototype),"setRunningAction",this).call(this,!0,function(){r.points.length=0,r.drawPoint.length=0,r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.startAction.bind(r))})}},{key:"close",value:function(r){this.isBinded=!1,this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),Be(be(n.prototype),"setRunningAction",this).call(this,!1),r&&r()}}]),n}(ue),ir=function(t){ao(n,t);var e=so(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return io(this,n),r=e.call(this,i,o),r.type=T.DRAWING_POLYGON,r.scene.setCurrentDrawType(r.type),r}return oo(n)}(Ot);function cn(t){return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cn(t)}function Hu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qu(t,e,n){return e&&Jr(t.prototype,e),n&&Jr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fn(t,e)}function fn(t,e){return fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},fn(t,e)}function Ku(t){var e=tl();return function(){var i=nt(t),r;if(e){var o=nt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Zu(this,r)}}function Zu(t,e){if(e&&(cn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return el(t)}function el(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nt(t){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},nt(t)}var uo=function(t){Vu(n,t);var e=Ku(n);function n(i,r,o,a,s){var u;return Hu(this,n),u=e.call(this),u.scene=s,u.type=i,u.point=r,u.number=o,u.overlay=a,u}return Qu(n,[{key:"initialize",value:function(r){this.map=r;var o=this.div=document.createElement("div");o.className="screenshot";var a;return this.type==="circle"?a=`
                <div class="circlShot">
                <span id="screenshotNum">`.concat(this.number,`</span>
                <input id="circleInput" type="text" />
                <span class="unit">米</span>
                </div>
            `):this.type==="rectangle"&&(a=`
                <div class="rectWH">
                <div class="wh">
                    <span id="rectWidth">`.concat(this.number.width,`</span>
                    <input id="rectWidthInput" type="text" />
                </div>
                <span class="multiple">x</span>
                <div class="wh">
                    <span id="rectHeight">`).concat(this.number.height,`</span>
                    <input id="rectHeightInput" type="text" />
                </div>
                <span class="unit">米</span>
                </div>
            `)),o.innerHTML=a,o.addEventListener("mousemove",function(s){L.preventDefault(s),L.stopBubble(s)}),o.addEventListener("dblclick",function(s){L.preventDefault(s),L.stopBubble(s)}),this.map.getPanes().markerPane.appendChild(o),this.bind(),o}},{key:"bind",value:function(){this.setNumber(this.number),this.type==="circle"?this.bindCircleEvent():this.bindRectEvent()}},{key:"bindCircleEvent",value:function(){var r=this,o=document.getElementById("screenshotNum"),a=document.getElementById("circleInput");o.addEventListener("click",function(s){var u=o.innerText;o.style.display="none",a.value=u,a.style.display="inline-block",a.focus()}),a.addEventListener("click",function(s){a.focus()}),a.addEventListener("keydown",function(s){if(s.keyCode===13){var u=a.value;a.style.display="none",o.innerText=u;var l={radius:u,overlay:r.overlay};r.dispatchRadiusChange(l)}}),a.addEventListener("blur",function(s){var u=a.value;a.style.display="none",o.style.display="inline-block",o.innerText=u;var l={radius:u,overlay:r.overlay};r.dispatchRadiusChange(l)})}},{key:"bindRectEvent",value:function(){var r=this,o=document.getElementById("rectWidth"),a=document.getElementById("rectWidthInput"),s=document.getElementById("rectHeight"),u=document.getElementById("rectHeightInput");a.value=o.innerText,u.value=s.innerText,o.addEventListener("click",function(l){var c=o.innerText;o.style.display="none",a.value=c,a.style.display="inline-block",a.focus()}),s.addEventListener("click",function(l){var c=s.innerText;s.style.display="none",u.value=c,u.style.display="inline-block",u.focus()}),a.addEventListener("click",function(l){a.focus()}),u.addEventListener("click",function(l){u.focus()}),a.addEventListener("keydown",function(l){if(l.keyCode===13){var c=a.value,f=u.value;u.style.display="none",u.style.display="none",o.style.display="inline-block",u.style.display="inline-block",o.innerText=c,s.innerText=f;var p={width:c,height:f,overlay:r.overlay};r.dispatchRectWHChange(p)}}),u.addEventListener("keydown",function(l){if(l.keyCode===13){var c=a.value,f=u.value;a.style.display="none",u.style.display="none",o.style.display="inline-block",s.style.display="inline-block",o.innerText=c,s.innerText=f;var p={width:c,height:f,overlay:r.overlay};r.dispatchRectWHChange(p)}})}},{key:"setInfo",value:function(r,o){this.setNumber(o),this.setPosition(r)}},{key:"setNumber",value:function(r){this.type==="circle"?document.getElementById("screenshotNum").textContent=r:(document.getElementById("rectWidth").textContent=r.width,document.getElementById("rectHeight").textContent=r.height)}},{key:"setPosition",value:function(r){this.point=r;var o=this.type,a=this.map.pointToOverlayPixel(this.point);o==="circle"?(this.div.style.left=a.x-30+"px",this.div.style.top=a.y-40+"px"):o==="rectangle"&&(this.div.style.left=a.x+"px",this.div.style.top=a.y-45+"px")}},{key:"draw",value:function(){var r=this.map.pointToOverlayPixel(this.point);this.type==="circle"?(this.div.style.left=r.x-30+"px",this.div.style.top=r.y-40+"px"):this.type==="rectangle"&&(this.div.style.left=r.x+"px",this.div.style.top=r.y-45+"px")}},{key:"dispatchRadiusChange",value:function(r){var o=new I("radiuschange",r);this.dispatchEvent(o)}},{key:"dispatchRectWHChange",value:function(r){var o=new I("rectwhchange",r);this.dispatchEvent(o)}}]),n}(Wn(BMapGL.Overlay,q));function hn(t){return hn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hn(t)}function nl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ur(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function rl(t,e,n){return e&&Ur(t.prototype,e),n&&Ur(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function il(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vn(t,e)}function vn(t,e){return vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},vn(t,e)}function ol(t){var e=ul();return function(){var i=rt(t),r;if(e){var o=rt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return al(this,r)}}function al(t,e){if(e&&(hn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sl(t)}function sl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rt(t){return rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},rt(t)}var ll=function(t){il(n,t);var e=ol(n);function n(i,r,o){var a;return nl(this,n),a=e.call(this,i,r,o),a.type=T.DRAWING_RECTANGLE,a.scene.setCurrentDrawType(a.type),a}return rl(n,[{key:"setIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r,o){var a=this;this.overlay=r;for(var s=this.getBox(r.getPath()),u=s.startPoint,l=s.endPoint,c=[],f=this.getRectAllPoints(u,l),p=[],d=this.scene.map.getDistance(u,f[2]).toFixed(0),P=this.scene.map.getDistance(u,f[6]).toFixed(0),g=new uo("rectangle",f[0],{width:d,height:P},r,this.scene),E=0;E<f.length;E++){var k=new BMapGL.Marker(f[E]);this.target&&this.target.moveIcon?k.setIcon(this.target.moveIcon):k.setIcon(this.moveIcon),k.enableDragging(),c.push(k),this.scene.map.addOverlay(k),p[E]=L.mc2ll(k.point,this.scene.map),k.addEventListener("mousedown",function(y){l=L.mc2ll(y.target.point,a.scene.map)}),k.addEventListener("dragging",function(y){for(var b=y.latLng,S=0;S<p.length;S++)l.lng==p[S].lng&&(f[S].lng=b.lng),l.lat==p[S].lat&&(f[S].lat=b.lat);f=a.getRectAllPoints(f[0],f[4]);for(var _=0;_<c.length;_++)c[_].setPosition(f[_]);d=a.scene.map.getDistance(f[0],f[2]).toFixed(0),P=a.scene.map.getDistance(f[0],f[6]).toFixed(0),g.setInfo(f[0],{width:d,height:P}),v.setPosition(f[3],!0),r.setPath(f)}),k.addEventListener("dragend",function(y){for(var b=0;b<c.length;b++){var S=c[b];p[b]=L.mc2ll(S.point,a.scene.map)}v.updateWindow();var _=new I(B.CHANGE,r);a.target.dispatchEvent(_)})}g.addEventListener("rectwhchange",function(y){var b=y.target.width,S=y.target.height,_=L.getPointByDistance(f[0],b,"east"),M=L.getPointByDistance(f[0],S,"south");f[4].lng=_.lng,f[4].lat=M.lat,f=a.getRectAllPoints(f[0],f[4]);for(var R=0;R<c.length;R++)c[R].setPosition(f[R]);g.setInfo(f[0],{width:b,height:S}),v.setPosition(f[3],!0),r.setPath(f);for(var x=0;x<c.length;x++){var m=c[x];p[x]=L.mc2ll(m.point,a.scene.map)}v.updateWindow();var O=new I(B.CHANGE,r);a.target.dispatchEvent(O)}),this.overlays=[c,g];var h={limit:o,point:f[3],overlay:r},v=this.addOperateWindow(h);this.scene.map.addOverlay(g),this.dispatchEvent(new I(B.INIT)),this.onlinevertexdragging=function(y){console.log(y);var b=y.overlay,S=BMapGL.Projection.convertMC2LL(b.getPoint()),_=null;_=a.getSnap(S,a.scene.instances),_&&(y.from.point=BMapGL.Projection.convertLL2MC(_),b.setPoint(y.from.point))},r.addEventListener("onlinevertexdragging",this.onlinevertexdragging)}},{key:"getBox",value:function(r){var o=1/0,a=-1/0,s=-1/0,u=1/0;return r.forEach(function(l){l.lng<o&&(o=l.lng),l.lat>a&&(a=l.lat),l.lng>s&&(s=l.lng),l.lat<u&&(u=l.lat)}),{startPoint:new BMapGL.Point(o,a),endPoint:new BMapGL.Point(s,u)}}},{key:"getRectAllPoints",value:function(r,o){var a=new BMapGL.Point(r.lng,r.lat),s=new BMapGL.Point(o.lng,r.lat),u=new BMapGL.Point(o.lng,o.lat),l=new BMapGL.Point(r.lng,o.lat),c=new BMapGL.Point((r.lng+o.lng)/2,r.lat),f=new BMapGL.Point(o.lng,(r.lat+o.lat)/2),p=new BMapGL.Point((r.lng+o.lng)/2,o.lat),d=new BMapGL.Point(r.lng,(r.lat+o.lat)/2);return[a,c,s,f,u,p,l,d]}},{key:"getRectanglePoint",value:function(r,o){return[new BMapGL.Point(r.lng,r.lat),new BMapGL.Point(o.lng,r.lat),new BMapGL.Point(o.lng,o.lat),new BMapGL.Point(r.lng,o.lat)]}}]),n}(wt);function pn(t){return pn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pn(t)}function cl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fl(t,e,n){return e&&qr(t.prototype,e),n&&qr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ie(){return typeof Reflect<"u"&&Reflect.get?Ie=Reflect.get.bind():Ie=function(e,n,i){var r=hl(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Ie.apply(this,arguments)}function hl(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=we(t),t!==null););return t}function vl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yn(t,e)}function yn(t,e){return yn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},yn(t,e)}function pl(t){var e=gl();return function(){var i=we(t),r;if(e){var o=we(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return yl(this,r)}}function yl(t,e){if(e&&(pn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dl(t)}function dl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function we(t){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},we(t)}var lo=function(t){vl(n,t);var e=pl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cl(this,n),r=e.call(this,i,o),r.type=T.DRAWING_RECTANGLE,r.polygon=null,r.startPoint=null,r.scene.setCurrentDrawType(r.type),r.moveIcon=new BMapGL.Icon(pi,new BMapGL.Size(10,10)),r.moveIcon.setImageSize(new BMapGL.Size(10,10)),r.isOpen&&r.open(),r}return fl(n,[{key:"getRectAllPoints",value:function(r,o){var a=new BMapGL.Point(r.lng,r.lat),s=new BMapGL.Point(o.lng,r.lat),u=new BMapGL.Point(o.lng,o.lat),l=new BMapGL.Point(r.lng,o.lat),c=new BMapGL.Point((r.lng+o.lng)/2,r.lat),f=new BMapGL.Point(o.lng,(r.lat+o.lat)/2),p=new BMapGL.Point((r.lng+o.lng)/2,o.lat),d=new BMapGL.Point(r.lng,(r.lat+o.lat)/2);return[a,c,s,f,u,p,l,d]}},{key:"getRectanglePoint",value:function(r,o){return[new BMapGL.Point(r.lng,r.lat),new BMapGL.Point(o.lng,r.lat),new BMapGL.Point(o.lng,o.lat),new BMapGL.Point(r.lng,o.lat)]}},{key:"startAction",value:function(r){L.stopBubble(r),L.preventDefault(r);var o=this.startPoint=r.point;this.enableSnap&&this.match&&(o=this.startPoint=this.match);var a=this.endPoint=o;this.polygon=new BMapGL.Polygon(this.getRectanglePoint(o,a),this.baseOptions),this.scene.map.addOverlay(this.polygon),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){this.scene.map.removeOverlay(this.tipLabel);var o=r.point;if(this.enableSnap&&(this.match=this.getSnap(o,this.scene.instances),this.match)){this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match));return}this.match=null,this.polygon.setPath(this.getRectanglePoint(this.startPoint,r.point));var a=this.getRectAllPoints(this.startPoint,r.point),s=this.scene.map.getDistance(this.startPoint,a[2]).toFixed(0),u=this.scene.map.getDistance(this.startPoint,a[6]).toFixed(0);this.tipLabel=new BMapGL.Label("尺寸："+s+"米 x "+u+"米<br>松开结束绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"endAction",value:function(r){if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.enableSnap?(this.match=this.getSnap(r.point,this.scene.instances),this.match&&this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match))):this.polygon.setPath(this.getRectanglePoint(this.startPoint,r.point)),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.options.limit&&(o=this.options.limit.area);var a=this.editOpe=new ll(this.scene,this);this.registEvent(a),a.open(this.polygon,o)}else this.scene.map.removeOverlay(this.polygon),this.emitEventIsnomap(this.polygon)}},{key:"mousemoveAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Ie(we(n.prototype),"setRunningAction",this).call(this,!0,function(){r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.startAction.bind(r))})}},{key:"close",value:function(r){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),Ie(we(n.prototype),"setRunningAction",this).call(this,!1),r&&r()}}]),n}(ue);function dn(t){return dn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dn(t)}function ml(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bl(t,e,n){return e&&Hr(t.prototype,e),n&&Hr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function wl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gn(t,e)}function gn(t,e){return gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},gn(t,e)}function Ol(t){var e=_l();return function(){var i=it(t),r;if(e){var o=it(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Pl(this,r)}}function Pl(t,e){if(e&&(dn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return El(t)}function El(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},it(t)}var Sl=function(t){wl(n,t);var e=Ol(n);function n(i,r,o){var a;return ml(this,n),a=e.call(this,i,r,o),a.type=T.DRAWING_CIRCLE,a.scene.setCurrentDrawType(a.type),a}return bl(n,[{key:"setCenterIcon",value:function(r){this.centerIcon=r}},{key:"setMoveIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r,o){var a=this;this.overlay=r,this.centerPoint=r.getCenterIn().latLng;var s=new BMapGL.Point(r.getBounds().getNorthEast().lng,this.centerPoint.lat),u=this.centerMarker=new BMapGL.Marker(this.centerPoint);u.setIcon(this.centerIcon),u.enableDragging(),u.addEventListener("dragstart",this.centerDragstart.bind(this)),u.addEventListener("dragging",this.centerDragging.bind(this)),u.addEventListener("dragend",this.centerDragend.bind(this)),this.scene.map.addOverlay(u);var l=this.moveMarker=new BMapGL.Marker(s);l.setIcon(this.circleMoveIcon),l.enableDragging();var c=this.polyline=new BMapGL.Polyline([this.centerPoint,s],this.baseOptions||{}),f=new BMapGL.Point((r.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,this.centerPoint.lat),p=this.radiusWindow=new uo("circle",f,Math.ceil(r.getRadius()),r,this.scene);this.overlays=[u,l,c,p];var d={limit:o,point:s,overlay:r},P=this.operateWindow=this.addOperateWindow(d);this.scene.map.addOverlay(l),this.scene.map.addOverlay(c),this.scene.map.addOverlay(p);var g=1;p.addEventListener("radiuschange",function(E){if(!(!E.target.radius||isNaN(E.target.radius))){g=E.target.radius,r.setRadius(g);var k=L.getPointByDistance(a.centerPoint,g,"east"),h=new BMapGL.Point(k.lng,a.centerPoint.lat),v=k.lng>a.centerPoint.lng?(r.getBounds().getNorthEast().lng+a.centerPoint.lng)/2:(r.getBounds().getSouthWest().lng+a.centerPoint.lng)/2,y=new BMapGL.Point(v,a.centerPoint.lat);l.setPosition(h),p.setInfo(y,g),P.setPosition(h,!0),P.updateWindow(),c.setPath([a.centerPoint,h]);var b=new I(B.CHANGE,r);a.target.dispatchEvent(b)}}),l.addEventListener("dragging",function(E){var k=new BMapGL.Point(E.latLng.lng,a.centerPoint.lat),h=E.latLng.lng>a.centerPoint.lng?(r.getBounds().getNorthEast().lng+a.centerPoint.lng)/2:(r.getBounds().getSouthWest().lng+a.centerPoint.lng)/2,v=E.latLng.lng>a.centerPoint.lng,y=new BMapGL.Point(h,a.centerPoint.lat);E.target.setPosition(k),p.setInfo(y,a.scene.map.getDistance(a.centerPoint,E.latLng).toFixed(0)),P.setPosition(k,v),c.setPath([a.centerPoint,k]),g=a.scene.map.getDistance(a.centerPoint,E.latLng).toFixed(0),r.setRadius(a.scene.map.getDistance(a.centerPoint,E.latLng))}),l.addEventListener("dragend",function(E){P.updateWindow();var k=new I(B.CHANGE,r);a.target.dispatchEvent(k)}),this.dispatchEvent(new I(B.INIT))}},{key:"centerDragstart",value:function(r){this.moveMarker.hide(),this.polyline.hide(),this.radiusWindow.hide(),this.operateWindow.hide()}},{key:"centerDragging",value:function(r){this.centerPoint=r.latLng,this.overlay.setCenter(r.latLng)}},{key:"centerDragend",value:function(r){this.centerPoint=r.latLng;var o=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.moveMarker.setPosition(o),this.moveMarker.show();var a=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.polyline.setPath([this.centerPoint,a]),this.polyline.show();var s=(this.overlay.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,u=new BMapGL.Point(s,this.centerPoint.lat);this.radiusWindow.setPosition(u),this.operateWindow.setPosition(a,!0),this.radiusWindow.show(),this.operateWindow.show();var l=new I(B.CHANGE,this.circle);this.target.dispatchEvent(l)}}]),n}(wt);function mn(t){return mn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mn(t)}function kl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ll(t,e,n){return e&&Qr(t.prototype,e),n&&Qr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Te(){return typeof Reflect<"u"&&Reflect.get?Te=Reflect.get.bind():Te=function(e,n,i){var r=Ml(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Te.apply(this,arguments)}function Ml(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=Oe(t),t!==null););return t}function Rl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bn(t,e)}function bn(t,e){return bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},bn(t,e)}function Al(t){var e=Il();return function(){var i=Oe(t),r;if(e){var o=Oe(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return xl(this,r)}}function xl(t,e){if(e&&(mn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Bl(t)}function Bl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Il(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Oe(t){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Oe(t)}var co=function(t){Rl(n,t);var e=Al(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return kl(this,n),r=e.call(this,i,o),r.type=T.DRAWING_CIRCLE,r.circle=null,r.overlays=[],r.centerPoint=null,r.radius=1,r.moveMarker=null,r.polyline=null,r.radiusWindow=null,r.operateWindow=null,r.scene.setCurrentDrawType(r.type),r.isOpen&&r.open(),r}return Ll(n,[{key:"startAction",value:function(r){this.centerPoint=r.point,this.circle=new BMapGL.Circle(this.centerPoint,this.radius,this.baseOptions),this.scene.map.addOverlay(this.circle),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){this.radius=this.scene.map.getDistance(this.centerPoint,r.point).toFixed(0),this.circle.setRadius(this.radius),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("半径："+this.radius+"米<br>松开完成绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"endAction",value:function(r){if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.limit&&(o=this.limit.area);var a=this.editOpe=new Sl(this.scene,this);this.registEvent(a),a.open(this.circle,o)}else this.scene.map.removeOverlay(this.centerMarker),this.scene.map.removeOverlay(this.circle),this.emitEventIsnomap(this.circle)}},{key:"mousedownAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.centerPoint==null&&this.startAction(r)}},{key:"mousemoveAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Te(Oe(n.prototype),"setRunningAction",this).call(this,!0,function(){r.centerPoint=null,r.radius=1,r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.mousedownAction.bind(r))})}},{key:"close",value:function(r){Te(Oe(n.prototype),"setRunningAction",this).call(this,!1),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),r&&r()}}]),n}(ue);function wn(t){return wn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wn(t)}function Tl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Nl(t,e,n){return e&&Vr(t.prototype,e),n&&Vr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&On(t,e)}function On(t,e){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},On(t,e)}function Dl(t){var e=jl();return function(){var i=ot(t),r;if(e){var o=ot(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return $l(this,r)}}function $l(t,e){if(e&&(wn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cl(t)}function Cl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ot(t){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ot(t)}var uf=function(t){Gl(n,t);var e=Dl(n);function n(i,r,o){var a;return Tl(this,n),a=e.call(this,i,r,o),a.type=T.DRAWING_MARKER,a.scene.setCurrentDrawType(a.type),a}return Nl(n,[{key:"setIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r){r.enableDragging(),r.addEventListener("dragstart",this.centerDragstart.bind(this)),r.addEventListener("dragging",this.centerDragging.bind(this)),r.addEventListener("dragend",this.centerDragend.bind(this))}},{key:"centerDragstart",value:function(r){}},{key:"centerDragging",value:function(r){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}},{key:"centerDragend",value:function(r){this.emitOkEvent(this.overlay,!0,!0);var o=new I(B.CHANGE,this.overlay);this.target.dispatchEvent(o)}},{key:"closeOpe",value:function(r){r.disableDragging(),r.removeEventListener("dragstart",this.centerDragstart),r.removeEventListener("dragging",this.centerDragging),r.removeEventListener("dragend",this.centerDragend)}}]),n}(wt);function Pn(t){return Pn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pn(t)}function Fl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zl(t,e,n){return e&&Kr(t.prototype,e),n&&Kr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&En(t,e)}function En(t,e){return En=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},En(t,e)}function Yl(t){var e=Ul();return function(){var i=at(t),r;if(e){var o=at(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Xl(this,r)}}function Xl(t,e){if(e&&(Pn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jl(t)}function Jl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},at(t)}var lf=function(t){Wl(n,t);var e=Yl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Fl(this,n),r=e.call(this),r.scene=i,r.opts=o,r.drawingItems=o.drawingItems||xo,r.defaultAnchor=o.anchor||BMAP_ANCHOR_TOP_LEFT,r.defaultOffset=o.offset||new BMapGL.Size(20,20),r.initialize(r.scene.map),r}return zl(n,[{key:"initialize",value:function(r){this._map=r;var o=this.container=document.createElement("div");o.className="BMap_Drawing";var a=this.panel=document.createElement("div");a.className="BMap_Draw_Panel",o.appendChild(a);var s=this.generalHtml(r);a.appendChild(s);var u=this.tip=document.createElement("div");return u.className="BMapDraw_tip",u.innerHTML='<p class="BMapDraw_tip_title"></p><p class="BMapDraw_tip_text"></p>',this.opts.enableTips&&a.appendChild(u),r.getContainer().appendChild(o),this.bindEvt(),o}},{key:"generalHtml",value:function(r){for(var o=this,a={hander:"拖动地图",marker:"标记点",polyline:"折线",polygon:"多边形",circle:"圆形",rectangle:"矩形"},s=function(d,P){var g=document.createElement("a");return g.className=d,g.href="javascript:void(0)",g.setAttribute("drawingType",P),g.setAttribute("onfocus","this.blur()"),g.addEventListener("mouseenter",function(E){var k=E.target.getAttribute("drawingType"),h=a[k];k==="hander"?(o.tip.children[0].innerText=h,o.tip.children[1].innerText="使用鼠标拖动地图"):(o.tip.className+=" "+k,o.tip.children[0].innerText=h,o.tip.children[1].innerText="使用"+h+"选出目标区域"),o.tip.style.display="block"}),g.addEventListener("mouseleave",function(E){for(var k=E.target.getAttribute("drawingType"),h=" "+o.tip.className.replace(/[\t\r\n]/g,"")+" ";h.indexOf(" "+k+" ")>=0;)h=h.replace(" "+k+" "," ");o.tip.className=h.replace(/^\s+|\s+$/g,""),o.tip.style.display="none"}),g},u=document.createDocumentFragment(),l=0,c=this.drawingItems.length;l<c;l++){var f="BMapDraw_Box BMapDraw_"+this.drawingItems[l];u.appendChild(s(f,this.drawingItems[l]))}return u}},{key:"setStyleByDrawingItems",value:function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"marker",o=this.panel.getElementsByTagName("a"),a=0,s=o.length;a<s;a++){var u=o[a];if(u.getAttribute("drawingType")===r){var l="BMapDraw_Box BMapDraw_"+r+"_hover";u.className=l}else u.className=u.className.replace(/_hover/,"")}}},{key:"bindEventByDrawingType",value:function(r){var o=this.scene;if(o.isOpen&&o.drawType===r)o.close(),o.map.enableDoubleClickZoom();else switch(r){case"marker":var a=new Vi(o);a.open();break;case"polyline":var s=new Ot(o);s.open();break;case"polygon":var u=new ir(o);u.open();break;case"circle":var l=new co(o);l.open();break;case"rectangle":var c=new lo(o);c.open();break}}},{key:"bindEvt",value:function(r){var o=this;L.on(this.panel,"click",function(a){var s=L.getTarget(a),u=s.getAttribute("drawingType");o.setStyleByDrawingItems(u),o.bindEventByDrawingType(u)})}}]),n}(BMapGL.Control);function _n(t){return _n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_n(t)}function ql(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Hl(t,e,n){return e&&Zr(t.prototype,e),n&&Zr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ql(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sn(t,e)}function Sn(t,e){return Sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Sn(t,e)}function Vl(t){var e=ec();return function(){var i=st(t),r;if(e){var o=st(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Kl(this,r)}}function Kl(t,e){if(e&&(_n(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zl(t)}function Zl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ec(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function st(t){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},st(t)}var cf=function(t){Ql(n,t);var e=Vl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ql(this,n),r=e.call(this),r.type=null,r.instance=null,r.graphicOpts=gi,r.labelOptions=Ge,r.isOnMap=!1,r.isSeries=!1,r.skipEditing=!1,r.mouseMove=!0,r.enableSnap=!1,r.scene=i,r.defineProperty(o),r}return Hl(n,[{key:"close",value:function(r){this.instance&&(this.instance.close(),this.instance=null),r&&r()}},{key:"open",value:function(r){this.close(),this.scene.close(),this.defineProperty(r),this.type&&this.doAction()}},{key:"doAction",value:function(){var r=this;this.data=[];var o={isSelectDraw:!0,isOpen:!0,enableSnap:this.enableSnap,isOnMap:this.isOnMap,isSeries:this.isSeries,skipEditing:this.skipEditing,labelOptions:this.labelOptions,baseOpts:this.graphicOpts,mouseMove:this.mouseMove};switch(this.type){case T.DRAWING_POLYLINE:this.instance=new Ot(this.scene,o);break;case T.DRAWING_POLYGON:this.instance=new ir(this.scene,o);break;case T.DRAWING_RECTANGLE:this.instance=new lo(this.scene,o);break;case T.DRAWING_CIRCLE:this.instance=new co(this.scene,o);break;case T.DRAWING_MARKER:this.instance=new Vi(this.scene,o);break;case T.DRAWING_POINT:this.instance=new Oi(this.scene.map);break;default:this.close()}this.instance&&(this.instance.addEventListener(B.CHANGE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(B.MOVE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(B.CLICK,function(a){r.dispatchEvent(a);var s=new I(B.COMPLETE,{from:V.SELECT_NO_MAP,mouseTarget:a.target,overlay:new BMapGL.Marker(new BMapGL.Point(a.target.latlng.lng,a.target.latlng.lat))});r.scene.dispatchEvent(s)}),this.instance.addEventListener(B.COMPLETE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(B.CANCEL,function(a){r.dispatchEvent(a)}))}},{key:"addData",value:function(r){this.scene&&this.scene.addSelectDrawData(r)}},{key:"clearData",value:function(){this.scene&&this.scene.clearSelectDrawData()}}]),n}(q);function tc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nc(t,e,n){return e&&ei(t.prototype,e),n&&ei(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var ff=function(){function t(e,n){tc(this,t),this.label=void 0,this.scene=e}return nc(t,[{key:"getLength",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};n instanceof BMapGL.Polyline&&(n=n.toGeoJSON());var r=j.getLength(n);if(i.showlabel){var o=n.geometry.coordinates,a=new BMapGL.Point(o[o.length-1][0],o[o.length-1][1]),s="";switch(i.unit){case"kilometers":s="总长度："+r.toFixed(2)+"km";break;case"meters":s="总长度："+r.toFixed(2)+"m";break}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(s,{position:a,offset:i.offset||new BMapGL.Size(0,0)}),this.label.setStyle(i.labelOptions),this.scene.map.addOverlay(this.label)}return r}},{key:"getPolygonArea",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};n instanceof BMapGL.Polygon&&(n=n.toGeoJSON());var r=j.getPolygonArea(n);if(i.showlabel){var o=j.getPolygonCenter(n),a="";switch(i.unit){case"kilometers":a=r.toFixed(2)+" km²";break;case"meters":a=r.toFixed(2)+" m²";break}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(a,{position:o.bdCenter,offset:i.offset||new BMapGL.Size(-20,-10)}),this.label.setStyle(i.labelOptions),this.scene.map.addOverlay(this.label)}return r}}]),t}();function kn(t){return kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(t)}function rc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ti(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ic(t,e,n){return e&&ti(t.prototype,e),n&&ti(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function oc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ln(t,e)}function Ln(t,e){return Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Ln(t,e)}function ac(t){var e=lc();return function(){var i=ut(t),r;if(e){var o=ut(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return sc(this,r)}}function sc(t,e){if(e&&(kn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uc(t)}function uc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ut(t)}var hf=function(t){oc(n,t);var e=ac(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return rc(this,n),r=e.call(this,i,o),r.tipLabel=null,r.lengthLabel=[],r.totalLabel=null,r.turnOverlays=[],r.totalLength=0,r.measureRes=0,r.subDistance=[],r.scene.setCurrentDrawType(r.type),r.setOtherOptions(o),r.isOpen&&r.open(),r}return ic(n,[{key:"setOtherOptions",value:function(r){this.options=r,this.skipEditing=!0,this.isOpen=!0;var o=Ro;this.options=Object.assign(o,r),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(r){var o=this.options,a=o.turnIcon?o.turnIcon:di,s=new BMapGL.Marker(r,{icon:a,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.turnOverlays=[],this.lengthLabel=[],this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay)):(this.overlay.setPath(this.drawPoint),this.scene.map.removeOverlay(this.measureLabel),this.scene.map.addOverlay(this.downLabel),this.subDistance.push(this.downLabel.content),this.lengthLabel.push(this.downLabel)),this.setTurnPoint(o),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"moveAction",value:function(r){var o=r.point;if(this.enableSnap){var a=[];if(this.overlay.points.length>2){var s=this.overlay.getPath().slice(0,this.overlay.points.length-1),u=new this.overlay.constructor(s);a.push(u)}if(this.match=this.getSnap(o,this.scene.instances,a),this.match){this.overlay.setPositionAt(this.drawPoint.length-1,this.match);return}}this.match=null;var l=this.drawPoint[this.drawPoint.length-2],c=r.point;this.measureRes=j.getDistance(l,c),this.distance=this.measureRes.toFixed(2)+"km";var f=j.getLineCenter(l,c);this.scene.map.removeOverlay(this.measureLabel),this.measureLabel=this.addLabel(this.distance,{position:f.bdCenter}),this.downLabel=this.addLabel(this.distance,{position:f.bdCenter}),this.scene.map.addOverlay(this.measureLabel),this.overlay.setPositionAt(this.drawPoint.length-1,r.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label(this.options.followLabel,{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"dblclickAction",value:function(r){var o=this;L.preventDefault(r),L.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick);var a=this.overlay.toGeoJSON(),s=a.geometry.coordinates,u=new BMapGL.Point(s[s.length-1][0],s[s.length-1][1]),l=[0,0],c=[0,0],f=this.scene.map.pointToPixel(this.points[this.points.length-2]),p=this.scene.map.pointToPixel(this.points[this.points.length-3]);f.x-p.x>=0?l=[14,0]:l=[-14,0],f.y-p.y>=0?c=[-5,11]:c=[-5,-38];var d=j.getLength(a,this.options.unit);this.totalLength=d;var P="";switch(this.options.unit){case"kilometers":P="总长："+d.toFixed(2)+"km";break;case"meters":P="总长："+d.toFixed(2)+"m";break}this.totalLabel=new BMapGL.Label(P,{position:u,offset:new BMapGL.Size(c[0],c[1])}),this.totalLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.totalLabel),this.lengthLabel.push(this.totalLabel),this.closeIcon=this.options.closeIcon?this.options.closeIcon:yi,this.closeBtn=new BMapGL.Marker(u,{icon:this.closeIcon,baseZIndex:36e5,offset:new BMapGL.Size(l[0],l[1]),enableMassClear:!0}),this.closeBtn.setTitle("清除本次测距"),this.scene.map.addOverlay(this.closeBtn);var g={overlay:this.overlay,closeBtn:this.closeBtn,totalLabel:this.totalLabel,lengthLabel:this.lengthLabel,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0)};this.closeBtn.addEventListener("click",function(E){o.scene.map.removeOverlay(g.closeBtn),o.scene.map.removeOverlay(g.overlay);for(var k=0,h=g.turnOverlays.length;k<h;k++)o.scene.map.removeOverlay(g.turnOverlays[k]),g.turnOverlays[k]=null;for(var v=0,y=g.lengthLabel.length;v<y;v++)o.scene.map.removeOverlay(g.lengthLabel[v]),g.lengthLabel[v]=null}),this.dispatchMeasureEvent(),this.overlay.setPath(this.points),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var r=new I(vi.LENGTH_END,{points:this.points?this.points.slice(0):[],distance:this.totalLength,subDistance:this.subDistance,unit:this.options.unit,overlay:this.overlay});this.dispatchEvent(r),this.scene.dispatchEvent(r)}}]),n}(Ot);function Mn(t){return Mn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mn(t)}function cc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ni(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function fc(t,e,n){return e&&ni(t.prototype,e),n&&ni(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function hc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rn(t,e)}function Rn(t,e){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Rn(t,e)}function vc(t){var e=dc();return function(){var i=lt(t),r;if(e){var o=lt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return pc(this,r)}}function pc(t,e){if(e&&(Mn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yc(t)}function yc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lt(t){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},lt(t)}var vf=function(t){hc(n,t);var e=vc(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cc(this,n),r=e.call(this,i,o),r.measureArea=0,r.turnOverlays=[],r.scene.setCurrentDrawType(r.type),r.setOtherOptions(o),r.isOpen&&r.open(),r}return fc(n,[{key:"setOtherOptions",value:function(r){this.options=r,this.skipEditing=!0,this.isOpen=!0,this.options=Object.assign(Mo,r),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(r){var o=this.options,a=o.turnIcon?o.turnIcon:di,s=new BMapGL.Marker(r,{icon:a,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;if(this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1)this.turnOverlays=[],this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay);else if(this.overlay.setPath(this.drawPoint),this.points.length>2){this.measureArea=j.getPolygonArea(this.overlay),this.area=this.measureArea.toFixed(2)+"km²";var a=j.getPolygonCenter(this.overlay.toGeoJSON());this.scene.map.removeOverlay(this.areaLabel),this.areaLabel=this.addLabel(this.area,{position:a.bdCenter,offset:new BMapGL.Size(5,-2)}),this.scene.map.addOverlay(this.areaLabel)}this.setTurnPoint(o),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"dblclickAction",value:function(r){var o=this;L.preventDefault(r),L.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points);var a=this.overlay.toGeoJSON(),s=a.geometry.coordinates[0],u=new BMapGL.Point(s[s.length-1][0],s[s.length-1][1]);this.closeIcon=this.options.closeIcon?this.options.closeIcon:yi,this.closeBtn=new BMapGL.Marker(u,{icon:this.closeIcon,baseZIndex:36e5,enableMassClear:!0,offset:new BMapGL.Size(10,10)});var l=j.getPolygonCenter(this.overlay.toGeoJSON());this.totalAreaLabel=this.addLabel(this.area,{position:l.bdCenter,offset:new BMapGL.Size(5,-2)});var c={overlay:this.overlay,closeBtn:this.closeBtn,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0),totalAreaLabel:this.totalAreaLabel};this.scene.map.addOverlay(c.closeBtn),this.scene.map.removeOverlay(this.areaLabel),this.scene.map.addOverlay(c.totalAreaLabel),c.closeBtn.addEventListener("click",function(f){o.scene.map.removeOverlay(c.closeBtn),o.scene.map.removeOverlay(c.overlay),o.scene.map.removeOverlay(c.totalAreaLabel);for(var p=0,d=c.turnOverlays.length;p<d;p++)o.scene.map.removeOverlay(c.turnOverlays[p]),c.turnOverlays[p]=null}),this.dispatchMeasureEvent(),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var r=new I(vi.AREA_END,{points:this.points?this.points.slice(0):[],unit:this.options.unit,area:this.measureArea,overlay:this.overlay});this.dispatchEvent(r),this.scene.dispatchEvent(r)}}]),n}(ir);function An(t){return An=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},An(t)}function gc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ri(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function mc(t,e,n){return e&&ri(t.prototype,e),n&&ri(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function bc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xn(t,e)}function xn(t,e){return xn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},xn(t,e)}function wc(t){var e=Ec();return function(){var i=ct(t),r;if(e){var o=ct(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Oc(this,r)}}function Oc(t,e){if(e&&(An(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pc(t)}function Pc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ec(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ct(t)}var pf=function(t){bc(n,t);var e=wc(n);function n(){var i;gc(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i=e.call.apply(e,[this].concat(o)),i.tolerance=.001,i.toleranceType="kilometers",i}return mc(n,[{key:"polygonCutByLine",value:function(r,o,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=r.geometry,l=o.geometry;l.coordinates.length=l.coordinates.length-1;var c=[],f=[],p=null,d;if(u.type!=="Polygon"&&u.type!=="MultiPolygon"||l.type!=="LineString")return p;typeof a>"u"&&(a="");var P=ke(u,l);if(P.features.length===0||er(l,u))return p;f[0]=wr(l,this.tolerance,{units:this.toleranceType}),f[1]=wr(l,-this.tolerance,{units:this.toleranceType});for(var g=0;g<=1;g++){var E=g;c=[];for(var k=0;k<l.coordinates.length;k++)c.push(l.coordinates[k]);for(var h=f[E].geometry.coordinates.length-1;h>=0;h--)c.push(f[E].geometry.coordinates[h]);c.push(l.coordinates[0]);var v=D(c),y=qa(v);d=Ws(u,y)}var b=new BMapGL.GeoJSONParse,S=b.readFeaturesFromObject(d,s),_=[],M=[];return S.forEach(function(R,x){R.properties=Object.assign({},r.properties||{}),R.properties.id+="-".concat(x),_.push(R),M.push(R.toGeoJSON())}),{geojsonRes:M,bdRes:_}}},{key:"lineCutByPoly",value:function(r,o,a){if(r.geometry===void 0||r.geometry.type.toLowerCase().indexOf("linestring")===-1)throw"传入的必须为linestring";var s=Xa(r,o).features,u=[],l=new BMapGL.GeoJSONParse;if(s.length>1)for(var c=0,f=s.length;c<f;c++){var p=l.readFeatureFromObject(s[c],a);u.push(p)}return{geojsonRes:s,bdRes:u}}}]),n}(q);function Bn(t){return Bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(t)}function _c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ii(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Sc(t,e,n){return e&&ii(t.prototype,e),n&&ii(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function kc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&In(t,e)}function In(t,e){return In=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},In(t,e)}function Lc(t){var e=Ac();return function(){var i=ft(t),r;if(e){var o=ft(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Mc(this,r)}}function Mc(t,e){if(e&&(Bn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rc(t)}function Rc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ac(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ft(t)}var yf=function(t){kc(n,t);var e=Lc(n);function n(){var i;_c(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i=e.call.apply(e,[this].concat(o)),i.tolerance=.001,i.toleranceType="kilometers",i}return Sc(n,[{key:"polygonUnion",value:function(r,o){if(r.length<2)throw"至少2个数据";var a=null,s=!1;r.forEach(function(f,p){if(p>=1){var d=er(a,f);d?s=!0:a=Hi(a,f)}else a=f});var u=s?null:a,l=new BMapGL.GeoJSONParse,c=l.readFeatureFromObject(u,o);return{geojsonRes:u,bdRes:c}}}]),n}(q);function Tn(t){return Tn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tn(t)}function xc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Bc(t,e,n){return e&&oi(t.prototype,e),n&&oi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ic(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nn(t,e)}function Nn(t,e){return Nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Nn(t,e)}function Tc(t){var e=Dc();return function(){var i=ht(t),r;if(e){var o=ht(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Nc(this,r)}}function Nc(t,e){if(e&&(Tn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gc(t)}function Gc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ht(t){return ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ht(t)}var $c=function(t){Ic(n,t);var e=Tc(n);function n(){return xc(this,n),e.apply(this,arguments)}return Bc(n,[{key:"geojsonMove",value:function(r,o,a){(o instanceof BMapGL.Point||o instanceof BMapGL.LatLng)&&(o=N([o.lng,o.lat])),(a instanceof BMapGL.Point||a instanceof BMapGL.LatLng)&&(a=N([a.lng,a.lat]));var s=Wi(o,a),u=Qa(o,a),l=Za(r,s,u);return l}}]),n}(q);function Gn(t){return Gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gn(t)}function Cc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ai(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jc(t,e,n){return e&&ai(t.prototype,e),n&&ai(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dn(t,e)}function Dn(t,e){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Dn(t,e)}function zc(t){var e=Yc();return function(){var i=vt(t),r;if(e){var o=vt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Wc(this,r)}}function Wc(t,e){if(e&&(Gn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $n(t)}function $n(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},vt(t)}var Re=function(t){Fc(n,t);var e=zc(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Cc(this,n),r=e.call(this),r.currentModel=n.MODEL.MOVE,r.labelOptions=Ge,r.baseOpts=gi,r.enableSnap=!0,r.snapDistance=10,r.match=null,r.matchOverlay=null,r.matchOverlayRadius=1,!(i instanceof rr))throw Error("MoveBase实例化必须输入scene参数");r.scene=i,r.scene.move=$n(r);var a={};return L.copyOptionsToNew(r.scene.options,o,a),L.copyNotExitOptions(a,r.scene.options),r.options=a,r.target=o.target||$n(r),r.setOptions(a),r.setSnapPointType(o),r.moveCalculate=new $c,r.parse=new BMapGL.GeoJSONParse,r}return jc(n,[{key:"setOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.defineProperty(r)}},{key:"setCurrentModel",value:function(r){this.currentModel=r}},{key:"open",value:function(r,o){var a=this;this.scene&&(this.currentModel===n.MODEL.MOVE?this.overlay=r:this.overlay=this.parse.readFeatureFromObject(r.toGeoJSON()),this.scene.open(),this.setRunningAction(!0,function(){a.setSceneStatus(G.STATUS_MOVE),a.moveOpe(r),o&&o()}))}},{key:"close",value:function(r){this.overlay&&(this.setRunningAction(!1),this.setSceneStatus(G.STATUS_FREE),this.closeOpe(this.overlay),this.emitOkEvent(this.overlay),r&&r())}},{key:"moveOpe",value:function(r){}},{key:"closeOpe",value:function(r){}},{key:"emitOkEvent",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=V.MOVE_ON_MAP,s=new I(B.COMPLETE,{overlay:r,from:a,model:this.currentModel});this.dispatchEvent(s),o&&this.scene.dispatchEvent(s)}},{key:"setRunningAction",value:function(r,o){r?(this.scene.closeRunningAction(),this.scene.runningAction=this,this.scene.mask.show(),o()):(this.scene.runningAction=null,this.scene.mask.hide())}},{key:"setRadius",value:function(){var r=this.scene.map.getZoomUnits(),o=this.matchOverlayRadius*r;this.matchOverlay.setRadius(o)}},{key:"addMatchOverlay",value:function(r){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(r),this.scene.map.addEventListener("zoomend",this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(r))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeEventListener("zoomend",this.setRadius.bind(this))}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=ve(r,o,s,u)),!l&&this.scene._attachSnapSource&&(l=ve(r,this.scene._attachSnapSource,s,u)),l||(l=ve(r,a,s,u)),l&&this.addMatchOverlay(l),l}}]),n}(q);Re.MODEL={COPY:Symbol(),MOVE:Symbol()};function Cn(t){return Cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(t)}function fo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function si(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ho(t,e,n){return e&&si(t.prototype,e),n&&si(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jn(t,e)}function jn(t,e){return jn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},jn(t,e)}function po(t){var e=Uc();return function(){var i=pt(t),r;if(e){var o=pt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Xc(this,r)}}function Xc(t,e){if(e&&(Cn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jc(t)}function Jc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Uc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function pt(t){return pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},pt(t)}var qc=function(t){vo(n,t);var e=po(n);function n(i,r){var o;return fo(this,n),o=e.call(this,i,r),o.type=T.DRAWING_POLYLINE,o.scene.setCurrentDrawType(o.type),o}return ho(n,[{key:"startAction",value:function(r){L.stopBubble(r),L.preventDefault(r),this.match?this.start=this.match:this.start=r.point,this.currentModel===Re.MODEL.COPY&&(this.overlay.setOptions(this.baseOpts),this.scene.map.addOverlay(this.overlay)),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("移动改变位置<br>松开结束操作",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel);var o=r.point;this.enableSnap&&(this.currentModel===Re.MODEL.COPY?this.match=this.getSnap(r.point,this.scene.instances):this.match=this.getSnap(r.point,this.scene.instances,[],this.snapDistance,this.scene.map,[this.overlay]),this.match&&(o=this.match),this.match=null);var a=this.start,s=this.moveCalculate.geojsonMove(this.source,a,o);this.overlay.updateByGeoJSON(s)}},{key:"endAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.finish()}},{key:"mousemoveAction",value:function(r){L.preventDefault(r),L.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行移动",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"finish",value:function(){this.currentModel===Re.MODEL.COPY&&this.scene.map.removeOverlay(this.overlay),this.emitOkEvent(this.overlay,!0);var r=new I(B.CHANGE,this.overlay);this.target.dispatchEvent(r),this.close()}},{key:"moveOpe",value:function(){this.source=this.overlay.toGeoJSON(),this.scene.mask.show(),this.scene.mask.addEventListener("mousemove",this.mousemove=this.mousemoveAction.bind(this)),this.scene.mask.addEventListener("mousedown",this.mousedown=this.startAction.bind(this))}},{key:"closeOpe",value:function(){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove)}}]),n}(Re),df=function(t){vo(n,t);var e=po(n);function n(i,r){var o;return fo(this,n),o=e.call(this,i,r),o.type=T.DRAWING_POLYGON,o.scene.setCurrentDrawType(o.type),o}return ho(n)}(qc);function Fn(t){return Fn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fn(t)}function ui(t,e){return Kc(t)||Vc(t,e)||Qc(t,e)||Hc()}function Hc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Qc(t,e){if(t){if(typeof t=="string")return li(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return li(t,e)}}function li(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Vc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],r=!0,o=!1,a,s;try{for(n=n.call(t);!(r=(a=n.next()).done)&&(i.push(a.value),!(e&&i.length===e));r=!0);}catch(u){o=!0,s=u}finally{try{!r&&n.return!=null&&n.return()}finally{if(o)throw s}}return i}}function Kc(t){if(Array.isArray(t))return t}function yo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ci(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function go(t,e,n){return e&&ci(t.prototype,e),n&&ci(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function mo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zn(t,e)}function zn(t,e){return zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},zn(t,e)}function bo(t){var e=tf();return function(){var i=yt(t),r;if(e){var o=yt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Zc(this,r)}}function Zc(t,e){if(e&&(Fn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ef(t)}function ef(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function yt(t){return yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},yt(t)}var gf=function(t){mo(n,t);var e=bo(n);function n(i,r){var o;return yo(this,n),o=e.call(this),o.otherOverlays=[],o.snapDistance=15,o.isOpen=!1,o.cursor="default",o.scene=i,o.isOpen=~~r,o._initEvent(),o}return go(n,[{key:"open",get:function(){return this.isOpen},set:function(r){this.isOpen=r}},{key:"distance",get:function(){return this.snapDistance},set:function(r){this.snapDistance=r}},{key:"setPickCursor",value:function(r){this.cursor=r}},{key:"_initEvent",value:function(){var r=this;this.scene&&(this.scene.addEventListener(B.CLICK,function(o){if(r.isOpen&&r.scene.currentStatus===G.STATUS_FREE){var a=r.getSnap(o.target.latlng);if(a){var s=ui(a,3),u=s[0],l=s[1];s[2];var c=new fi(u,l);r.dispatchEvent(new I(B.CLICK,c))}}}),this.scene.addEventListener(B.MOVE,function(o){if(r.isOpen&&r.scene.currentStatus===G.STATUS_FREE){var a=r.getSnap(o.target.latlng);if(a){r.scene.map.platform.style.cursor=r.cursor;var s=ui(a,3),u=s[0],l=s[1];s[2];var c=new fi(u,l);r.dispatchEvent(new I(B.MOVE,c))}else r.scene.map.platform.style.cursor=r.scene.map.config.defaultCursor,r.dispatchEvent(new I(B.MOVE,null))}}))}},{key:"attachOverlays",value:function(r){r instanceof Array&&(this.otherOverlays=r)}},{key:"getSnap",value:function(r){var o=null;return o||(o=this.getSnapByLL(r,this.scene.instances)),!o&&this.otherOverlays&&this.otherOverlays.length>0&&(o=this.getSnapByLL(r,this.otherOverlays)),o}},{key:"getSnapByLL",value:function(r,o){var a=this.scene.map,s=nf(a.getZoom()),u=this.snapDistance*s;if(!o||!(o instanceof Array))return null;for(var l in o){var c=o[l];if(c instanceof BMapGL.Marker){var f=c.getPosition(),p=j.getDistance(r,f,"kilometers")*1e3;if(p<u)return[c,0,f]}else{var d=c.getPath();for(var P in d){var g=d[P],E=j.getDistance(r,g,"kilometers")*1e3;if(E&&E<u)return[c,P,g]}}}return null}}]),n}(q),fi=function(t){mo(n,t);var e=bo(n);function n(i,r){var o;return yo(this,n),o=e.call(this),o._index=-1,o.overlay=i,i instanceof BMapGL.Marker?o.path=[i.getPosition()]:o.path=i.getPath(),r<=o.path.length-1&&(o.index=r),o}return go(n,[{key:"index",get:function(){return this._index},set:function(r){this._index=parseInt(r)||0;var o=new I(B.CHANGE,this.index);this.dispatchEvent(o)}},{key:"getCurrentNode",value:function(){return this.path[this.index]}},{key:"updateNode",value:function(r,o){if(this.overlay instanceof BMapGL.Marker){var a=BMapGL.Projection.convertLL2MC(r);this.overlay.setPoint(a)}else o!==void 0&&o>=0&&o<this.path.length?this.path[o]=r:this.path[this.index]=r,this.overlay.setPath(this.path)}},{key:"hasNext",value:function(){return this.index+1>=0&&this.index+1<this.path.length}},{key:"next",value:function(){return this.hasNext()?(this._index++,this.path[this.index]):null}},{key:"hasPrev",value:function(){return this.index-1>=0&&this.index-1<this.path.length}},{key:"prev",value:function(){return this.hasPrev()?(this._index--,this.path[this.index]):null}}]),n}(q);function nf(t){return Math.pow(2,18-t)}export{V as ActionStatus,vf as AreaMeasure,co as CircleDraw,Sl as CircleEdit,gf as CorrectPoint,pf as CutCalculate,hf as DistanceMeasure,lf as DrawControl,rr as DrawScene,G as DrawStatus,T as DrawingType,j as GeoCalculator,Oi as MapSelect,Vi as MarkerDraw,uf as MarkerEdit,ff as Measure,vi as MeasureEvent,$c as MoveCalculate,Fe as Operate,B as OperateEventType,ir as PolygonDraw,Yu as PolygonEdit,df as PolygonMove,Ot as PolylineDraw,ro as PolylineEdit,qc as PolylineMove,lo as RectDraw,ll as RectEdit,cf as Select,yf as UnionCalculate};

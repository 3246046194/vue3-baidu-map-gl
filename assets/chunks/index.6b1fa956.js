import"../app.69478d92.js";import{c as so,a as jn}from"./commonjsHelpers.042e6b4d.js";var G={STATUS_FREE:"free",STATUS_DRAWING:"drawing",STATUS_EDITER:"editer",STATUS_MOVE:"move"},x={INIT:"operate-init",COMPLETE:"operate-ok",CANCEL:"operate-cancel",CHANGE:"operate-change",CLICK:"mouse-click",RIGHTCLICK:"right-click",MOVE:"mouse-move"},ai={AREA_END:"measure-area-end",LENGTH_END:"measure-length-end"},U={DRAW_ON_MAP:"draw-on-map",EDIT_ON_MAP:"edit-on-map",SELECT_ON_MAP:"select-on-map",MOVE_ON_MAP:"move-on-map",DRAW_NO_MAP:"draw-no-map",SELECT_NO_MAP:"select-no-map",DRAW_ON_MAP_CANCEL:"draw-on-map-cancel",EDIT_ON_MAP_CANCEL:"edit-on-map-cancel",SELECT_ON_MAP_CANCEL:"select-on-map-cancel",MOVE_ON_MAP_CANCEL:"move-on-map-cancel"},I={DRAWING_POINT:"point",DRAWING_MARKER:"marker",DRAWING_POLYLINE:"polyline",DRAWING_POLYGON:"polygon",DRAWING_CIRCLE:"circle",DRAWING_RECTANGLE:"rectangle"},si=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6Q
    AAAd9JREFUOBGtVc8rRFEUPufOvELMguTHwkbKjxRlo9gqNpjyFyhTit3I8i1ldpQa5S9QmA1lS9koSn6UZmMxSCyGkPlx3O+9mTe8Zl4z
    w7eZ7rnn++aee893HlMRzEXFeLh6m2LJTpHwEJG022mcIJZTYbXX2lu/txnilJvO7sDkYnJaC0REqNO993PNTHEiDsfWAru/4vmFaYo6e3
    5dEZIwYh1tPhobNmig20/NjcpKe3rJ0vlNmg5PUnR3n7FiTBwZbGpYNk3OIuCccHIhuQoxv49lNljD4yMG6VMUhT49HRynaGvnU9IZ0Wkc
    ia0HlhxBlCkiOxAz5+u4v8tXVMgdvLjNkLnxbosyB1E+4wEeL5PXuLPQTC1NjBpunud6/yhF0e0PVBNv6Qv0KLwmxHBnKLNSgAMuNKClrN
    bQKniAUnfm9SfggAtAS9l9RtZrehG99tAJFnTP6n6wmzbfGl7EUnsFrrTbDVYqs4q4FtR20kDTVosClxMK3oQQHFAtHK7WUjA6hGAnOKBS
    gAMuAC2FqYGmhDdhp0oBDrjQgJayRxBbAwHehJ3KBXLBsfM5DC3H/v81HHIdSYQRpMcX6ekRhjcPjr/KGV+6Unt8xXJlOSfMl/lvAzYviN
    +/fAK+AW5jAVefzjWGAAAAAElFTkSuQmCC`,uo=`data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6Q
    AAAs1JREFUWAnNmb9v01AQx989SzVI8dIBJNZ27Mb/QRpExMiOKAW1Mw3MRVCB2BlRECF/CBtjuwbBwGJL1JXs474vtuU4Tkho4tyTGr9f
    fvfxvV93VzL/mfYPLndSumqT4buG6Y4MI3+MpyQayc/IEI/Y0DfLW8Ov725cuKYlf2iZ/p3j8FZylT4hQx1m3lvmXSL6zoYH3pZ9PzgNfi
    367kKA3R634t/REXF6zMa0Fh28rp8IjJjsqb/det3vUVTXp1z3T8DOs/B+kvIHw3y7/OK180Q/PUuPB2+DL/PGsrMaZQrp3tPwJEn488rh
    IFQ+GGNDBmTN4qht6D7nm3ESfpRBurNeXGk9Ud/3gkf9N/SnOu6UBvE1jcKBSBQBmXWanAJsH0YvGtNcWV0C6WSX6yQ/McVuQ2DNycFW6d
    dQkdjz6EF54xQg46MkPMfibYimXozsbn872M2PoGKKcc5tHA7IoiDHkuE7DeKGSOP04rqHcL1Klq8VqMj6dgc3jtMgx+mBFjh8DlhwpSI/
    BiTaR0FTwn0PHnJWiYnPNcHlLNb4uxYmU16h7Qk26+w5bWQZD9hsZmzqRBRDGJsks4JVMgIwN9M1ArIAykRrRHNMwoY1+EMtoLBhDcID05
    pGMsWsF1DYLPxWrepzPjWcaq2AYLPw+OFUa4MEE9jG1ox4/NoAEYUAkwNEOAJGohZIsICpAITlinCEFkCw5PEbp0GAIVZixGHZOKRzmoQl
    SwUgvCjESsSG3eDVJ26nMOQeHRgLQBScP0r0EvmNJJFd9onBIOtxMiH80D4MPzUeXZD4zPAseCjHy8QMTmgQqOiAQI5k+pPoayxlwaMqnO
    OZJXasSRenOVlfKES0JdM6PGu9qoObC5iDqw1g5oBYtIiVGLK9VRzmbgwZC2NWN0Qus/yc2iTlxmoeIRIXhRBHX5bAXrV9XlmmcH1B9DrB
    Tf0b4i99lUEMOuku/wAAAABJRU5ErkJggg==`,lo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAABcdJREFUeAHtm0FoHFUYx7+ZbDfJJiZUqcEgBU3BqtGKRdGLHsSTSGxL8agUT230YtGTDQl6EKt4CD1JqPQkastSPImIvVSUQINRK1jrQVNSRRGz3WST3fH/f5k3THY3mmzejLub74Mv8/bNzJv3fnwz773v+yKiogSUgBJQAkpACSgBJaAElIASUAJKQAkoASWgBJSAElACSkAJKIH2J+A1OsQgCIZw7wh0P3Qwpr0oN7MsoHNzMZ1GOe953pVGOr0pgIB2Kx4yCj0AHW7kgU18zyz6dg46CZjXN9rPDQEEOFrVy9DjUGNhhaIEX8+WvEuXy/LbnxX5468AWpHF0kYf/f9c190psrPPl5v7Pdm105cH9nbIQ8PZoKdbLAta6Eno2wDJ8r+KvWndiwDvIE6egg7wooszy/LJhZJ8e6UslQprWl98X+TeoQ556rGsPLpvhx3QPApHAfGsrah3XBcgwPHcCegY1Pv+pxU5nV+Sy1fL9dppm7q9d3TI8yOdcvedGY4pgI5DJwCS5RqpCxDwunHl+9DDlUCCqbOL3vkvmvzdrBna1iqefjwrRw52Bb5nXu0P0dpzgFisbrUGYGh5H+DCw4ViELw5dcOb+aG9ra4aiv29764OefVIDt9Hj5wI8dlqS8TbXyN8bQ28V94pbFt4pELDIQMaEplAyWaNrAEYThhjfG1peb/Mt8kssWbIm/tBBmRBJrhzLGQUNRIBxAkuTzjbevzmbdfXNiITK5AFmZAN9FTIylwRAcQvrvMGONtutwnDkPiPP2RCNmQEJSsjBiCIcofBRbJZqpgzjv88cn8GC1azNHDW8qEns7L7trgNOGu6bkNcxoVyPGQm9ukv4kQvF8lJrfN6cx5mtG6nEG/p9+X10VxqEMmGjMgKOsqCBfgMf3CHkZQsw/p3ZNxCLOPL3n9TuhBjjOgPEB+mSK/KMPe23J4lJdPfLcvfhcApxM++XJZyOV2IZERWZEZ2tEC6pOSrb0peknvbhRsir00WnEL8ea4ib50upgqRjMiKzCAjBEh/nlxKYbdx9deKc4gXZ1ZShxhb4u0nQDpD5Xe4pNKQdoBI910ogxFA+vPSklaHGGMVBxhRTYVjK0Ok4zgUA9CYnvE32OqUjoSIfaZ5ml3i3D7Al6Jx4TfRLni5xJk4lpPObOPt1bszxipgb6/xIrq50xa40eG87Ioem/+8JFt1YAzu8uXAE6vEuE6cOrcoS46XtzFW10iNESoTI4hGkkKB8CaO9cie3R3maR99uiRnzkdbpYZ6QHhvvJTDWHwhvHfPFOXCtNm/NtTeejcxnhLKXASQAZa0pJXhkVGMlQHIuKjQ+5qGtDo8MmIkL5Rpml2ePx6+LxswOpWktAM8MmIYNOSU9+HjZ0R+FoPzGNpLSjJo2vU3r6/XS+WbF2dCRmRFZmRnbY4ReRMXjV/ssvzgPRmnEwb7xshZ0hNGNQPGjkMxzCzASVQuMKjMuGgS0tezOnO5mG1t/xAtS3S2tc+xR7IJA+/MWCCzVX8gTJG5IExnMEFlHl0L41ou4bF/SS5V6o2fAfdQTobMonwQgW+LXtYfoQPvfbzoPC6SgTd/xfGSLIssjJJxENtxJXfk5+KFQ2bRP4+n7AFAWmHkkZaw4ijqAkbkXS9rXMNj59OCRxZkQjZQ5ssYeOyD/QayTIhMpBlnOgMj8lvdl5pGW/wPGZBFmOIxHjKKRhXtSWwNXmXWaWoHIGwktaMGIEECInaqmlzUUHIRAVJCSzyB4hhU09s2k95GgFYAUhMsLYw6x7qvcPV1gMglTk2KL6NTDEYxntIqKb5d2Ehw92JTfPmdox8g3J5x6JxhuSZ2k+LLFq0AJFNAmMXAQPywrW+T4yzGkUySeT1AgDmEesaUGRZlZM8qrbWZhRZGJ7LVLf2bQzMPVPumBJSAElACSkAJKAEloASUgBJQAkpACSgBJaAElIASUAJKQAkoAVcE/gG4Wba8Vno8+QAAAABJRU5ErkJggg==",ui=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.gif",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(82,174),imageOffset:new BMapGL.Size(0,14)}),li=new BMapGL.Icon("//mapopen.bj.bcebos.com/cms/images/mapctrls.png",new BMapGL.Size(12,12),{imageSize:new BMapGL.Size(37,442),imageOffset:new BMapGL.Size(25,312)}),co=new BMapGL.Icon("//maponline0.bdimg.com/sty/map_icons2x/MapRes/shenghui_1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),fo=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit1.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),Et=new BMapGL.Icon("//bj.bcebos.com/v1/mapopen-pub-jsapigl/bmap-draw/static/edit2.png",new BMapGL.Size(10,10),{offset:new BMapGL.Size(5,5)}),Ne={borderRadius:"2px",background:"#FFFBCC",border:"1px solid #E1E1E1",color:"#703A04",fontSize:"12px",letterSpacing:"0",padding:"5px"},ho={operate:null,isOpen:!1,isOnMap:!0,isSeries:!0,skipEditing:!1,isSelectDraw:!1,enableCalculate:!1,enableSnap:!0,snapDistance:10,drawCursor:"crosshair",baseOpts:{icon:co,node:fo,nodeT:Et,fillColor:"#1990FF",fillOpacity:.2,strokeColor:"#877efb",strokeWeight:3,strokeOpacity:1,enableDragging:!0},labelOptions:Ne,matchOverlay:{type:"Circle",radius:2,icon:Et,strokeColor:"#fff",strokeStyle:"solid",strokeWeight:2},centerIcon:new BMapGL.Icon(uo,new BMapGL.Size(20,20)),circleMoveIcon:new BMapGL.Icon(lo,new BMapGL.Size(40,20),{imageOffset:new BMapGL.Size(0,10)}),moveIcon:new BMapGL.Icon(si,new BMapGL.Size(10,10))},vo={tips:"测距",unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",skipEditing:!0,enableCalculate:!0,turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:.8,fillOpacity:.2},labelOptions:Ne},po={unit:"kilometers",startLabel:"单击确定起点",followLabel:"单击确定地点，双击结束测量",turnIcon:null,closeIcon:null,isSeries:!1,baseOpts:{strokeColor:"#f00",strokeWeight:2,strokeOpacity:1},labelOptions:Ne},ci={icon:Et,nodeT:null,node:null,fillColor:"#fff",fillOpacity:.1,strokeColor:"#00f",strokeWeight:2,strokeOpacity:.6,strokeStyle:"dashed"},yo={strokeColor:"#fff",strokeStyle:"solid",strokeWeight:"2"},go=["marker","polyline","polygon","circle","rectangle"];function Zn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function mo(t,e,n){return e&&Zn(t.prototype,e),n&&Zn(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function bo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_t(t,e)}function _t(t,e){return _t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},_t(t,e)}function wo(t){var e=Eo();return function(){var i=je(t),r;if(e){var o=je(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Po(this,r)}}function Po(t,e){if(e&&(he(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fi(t)}function fi(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Eo(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function je(t){return je=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},je(t)}function he(t){return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(t)}var E={grid:"$BAIDU$",guid:function(){return window[E.grid]||(window[E.grid]={}),window[E.grid]._counter=window[E.grid]._counter||1,window[E.grid]._instances=window[E.grid]._instances||{},"TANGRAM__"+(window[E.grid]._counter++).toString(36)},isString:function(e){return Object.prototype.toString.call(e)==="[object String]"},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},isArray:function(e){return Array.isArray?Array.isArray(e):Object.prototype.toString.call(e)==="[object Array]"},isObject:function(e){return Object.prototype.toString.call(e)==="[object Object]"},copyOptionsToNew:function(e,n,i){for(var r in n)if(e.hasOwnProperty(r)){if(!n[r]||n[r]instanceof Array||n[r]instanceof BMapGL.Icon||n[r]instanceof BMapGL.Symbol||n[r].ignore){i[r]=n[r];continue}if(n[r]!==null&&he(n[r])==="object"&&Object.keys(n[r]).length===0)continue;n[r]!==null&&he(n[r])==="object"&&Object.keys(n[r]).length>0?(i[r]={},this.copyOptionsToNew(e[r],n[r],i[r])):i[r]=n[r]}},copyNotExitOptions:function(e,n){var i=this,r=function(u){if(e.hasOwnProperty(u))["baseOpts","labelOptions","matchOverlay"].findIndex(function(l){return u===l})!==-1&&i.copyNotExitOptions(e[u],n[u]);else{if(!n[u]||n[u]instanceof Array||n[u]instanceof BMapGL.Icon||n[u]instanceof BMapGL.Symbol||n[u].ignore)return e[u]=n[u],"continue";n[u]!==null&&he(n[u])==="object"?(e[u]={},i.copyNotExitOptions(e[u],n[u])):e[u]=n[u]}};for(var o in n)var a=r(o)},copyOptions:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];for(var r in n)if(e&&e.hasOwnProperty(r)){if(n[r]instanceof Array||n[r]instanceof BMapGL.Icon||n[r]instanceof BMapGL.Symbol||this.shotObject(n[r],i)){e[r]=n[r];continue}n[r]!==null&&he(n[r])==="object"?this.copyOptions(e[r],n[r],i):e[r]=n[r]}},shotObject:function(e,n){var i=!1;return n.forEach(function(r){if(e instanceof r)return i=!0,!0}),i},deepCopy:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;i?r++:(i={},r=1);for(var a in e)e[a]instanceof Array||e[a]instanceof BMapGL.Icon||e[a]instanceof BMapGL.Symbol||this.shotObject(e[a],o)?i[a]=e[a]:r<=n&&E.isObject(e[a])&&Object.keys(e[a]).length>0?(i[a]={},this.deepCopy(e[a],n,i[a],r,o)):i[a]=e[a]},getTarget:function(e){var n=window.event||e;return n.target||n.srcElement},getEvent:function(e){return window.event||e},preventDefault:function(e){var n=E.getEvent(e);n.preventDefault?n.preventDefault():n.returnValue=!1},stopBubble:function(e){var n=E.getEvent(e);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0},on:function(e,n,i,r){n=n.replace(/^on/i,""),e=E.getdom(e);var o=i,a=n;return n=n.toLowerCase(),e.addEventListener?e.addEventListener(a,o,!1):e.attachEvent&&e.attachEvent("on"+a,o),e},un:function(e,n,i,r){e=E.getdom(e);for(var o=r.length,a=!i,s,u,l;o--;)s=r[o],s[1]===n&&s[0]===e&&(a||s[2]===i)&&(u=s[4],l=s[3],e.removeEventListener?e.removeEventListener(u,l,!1):e.detachEvent&&e.detachEvent("on"+u,l),r.splice(o,1));return e},getdom:function(e){return E.isString(e)?document.getElementById(e):e},addClass:function(e,n){e=E.getdom(e);for(var i=n.split(/\s+/),r=e.className,o=" "+r+" ",a=i.length,s=0;s<a;s++)o.indexOf(" "+i[s]+" ")<0&&(r+=(r?" ":"")+i[s]);return e.className=r,e},mc2ll:function(e,n){var i=n.mercatorToLnglat(e.lng,e.lat);return new BMapGL.Point(i[0],i[1])},ll2mc:function(e,n){var i=n.lnglatToMercator(e.lng,e.lat);return new BMapGL.Point(i[0],i[1])},getPointByDistance:function(e,n,i){var r=e.lng,o=e.lat,a=n/6378800,s=Math.PI/180*o,u=Math.PI/180*r,l,c,h;switch(i){case"North":case"north":case"N":case"n":l=0,c=e.lng;break;case"West":case"west":case"W":case"w":l=90,h=e.lat;break;case"South":case"south":case"S":case"s":l=180,c=e.lng;break;case"East":case"east":case"E":case"e":l=270,h=e.lat;break;default:l=~~i;break}var p=Math.PI/180*l,d=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(p)),O=Math.atan2(Math.sin(p)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(d)),g=(u-O+Math.PI)%(2*Math.PI)-Math.PI,b=new BMapGL.Point(c||g*(180/Math.PI),h||d*(180/Math.PI));return b.lng=parseFloat(b.lng.toFixed(6)),b.lat=parseFloat(b.lat.toFixed(6)),b},throttle:function(e,n,i){if(typeof e!="function")return new Function;var r=null,o=null;return function(a){var s=a,u=+new Date;!o&&(o=u),i&&u-o>i?(e(s),o=u):(clearTimeout(r),r=setTimeout(function(){e(s),o=null},n))}}},Fn=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=function(s){Oo(l,s);var u=wo(l);function l(){var c;bo(this,l);for(var h=arguments.length,p=new Array(h),d=0;d<h;d++)p[d]=arguments[d];return c=u.call.apply(u,[this].concat(p)),i.forEach(function(O){a(fi(c),new O)}),c}return mo(l)}(e),a=function(u,l){Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l)).forEach(function(c){c.match(/^(?:constructor|prototype|arguments|caller|name|bind|call|apply|toString|length)$/)||Object.defineProperty(u,c,Object.getOwnPropertyDescriptor(l,c))})};return i.forEach(function(s){a(o.prototype,s.prototype),a(o,s)}),o};function Fe(t){return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fe(t)}function er(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function hi(t,e,n){return e&&er(t.prototype,e),n&&er(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var A=hi(function t(e,n){vi(this,t),this.type=e,this.returnValue=!0,this.target=n||null,this.currentTarget=null}),Y=function(){function t(){vi(this,t),this._listeners={}}return hi(t,[{key:"addEventListener",value:function(n,i,r){if(E.isFunction(i)){!this._listeners&&(this._listeners={});var o=this._listeners,a;if(typeof r=="string"&&r){if(/[^\w\-]/.test(r))throw"nonstandard key:"+r;i.hashCode=r,a=r}n.indexOf("on")!==0&&(n="on"+n),Fe(o[n])!=="object"&&(o[n]={}),a=a||E.guid(),i.hashCode=a,o[n][a]=i}}},{key:"removeEventListener",value:function(n,i){if(E.isFunction(i))i=i.hashCode;else if(!E.isString(i))return;!this._listeners&&(this._listeners={}),n.indexOf("on")!==0&&(n="on"+n);var r=this._listeners;r[n]&&r[n][i]&&delete r[n][i]}},{key:"dispatchEvent",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};!this._listeners&&(this._listeners={}),E.isString(n)&&(n=new A(n));for(var r in i)n[r]=i[r];var o=this._listeners,a=n.type;if(a.indexOf("on")!==0&&(a="on"+a),E.isFunction(this[a])&&this[a].apply(this,arguments),Fe(o[a])==="object")for(var s in o[a])o[a][s].apply(this,arguments);return n.returnValue}},{key:"dispose",value:function(){for(var n in this._listeners)for(var i in this._listeners[n])delete this._listeners[n][i]}},{key:"defineProperty",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;r===void 0?(r=this,o=1):o++;for(var a in n)r&&r.hasOwnProperty(a)&&(n[a]instanceof Array||n[a]instanceof BMapGL.Icon||n[a]instanceof BMapGL.Symbol?r[a]=n[a]:o<i&&E.isObject(n[a])&&Object.keys(n[a]).length>0?this.defineProperty(n[a],i,r[a],o):r[a]=n[a])}},{key:"setSnapPointType",value:function(n){var i,r;((i=n.matchOverlay)===null||i===void 0?void 0:i.type)==="Marker"?this.matchOverlay=new BMapGL.Marker(new BMapGL.Point(116.395,39.935),n.matchOverlay):((r=n.matchOverlay)===null||r===void 0?void 0:r.type)==="Circle"?(n.matchOverlay.radius&&(this.matchOverlayRadius=n.matchOverlay.radius),this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,n.matchOverlay)):this.matchOverlay=new BMapGL.Circle(new BMapGL.Point(116.395,39.935),this.matchOverlayRadius,yo)}},{key:"setSceneStatus",value:function(n){this.scene.currentStatus=n}}]),t}();function St(t){return St=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(t)}function _o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function So(t,e,n){return e&&tr(t.prototype,e),n&&tr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ko(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kt(t,e)}function kt(t,e){return kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},kt(t,e)}function Lo(t){var e=Ro();return function(){var i=ze(t),r;if(e){var o=ze(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Mo(this,r)}}function Mo(t,e){if(e&&(St(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xo(t)}function xo(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ro(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ze(t){return ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ze(t)}var pi=function(t){ko(n,t);var e=Lo(n);function n(i){var r;return _o(this,n),r=e.call(this),r.delayLimit=100,r.minLimit=200,r.overlayData=[],r.click=void 0,r.mousemove=void 0,r.rightclick=void 0,r.map=i,r.open(),r}return So(n,[{key:"open",value:function(){this.openClick(),this.openMouse(),this.openRightClick()}},{key:"linkOverlayData",value:function(r){this.overlayData=r}},{key:"clickAction",value:function(r){this.dispatchEvent(new A(x.CLICK,r))}},{key:"rightclickAction",value:function(r){this.dispatchEvent(new A(x.RIGHTCLICK,r))}},{key:"mouseAction",value:function(r){r&&this.dispatchEvent(new A(x.MOVE,r))}},{key:"openClick",value:function(){this.click||this.map.addEventListener("click",this.click=this.clickAction.bind(this))}},{key:"openRightClick",value:function(){this.rightclick||this.map.addEventListener("rightclick",this.rightclick=this.rightclickAction.bind(this))}},{key:"openMouse",value:function(){this.mousemove||(this.mousemove=E.throttle(this.mouseAction.bind(this),this.delayLimit,this.minLimit).bind(this),this.map.addEventListener("mousemove",this.mousemove))}},{key:"close",value:function(){this.closeClick(),this.closeMouse()}},{key:"closeClick",value:function(){this.click&&(this.map.removeEventListener("click",this.click),this.click=null)}},{key:"closeMouse",value:function(){this.mousemove&&(this.map.removeEventListener("mousemove",this.mousemove),this.mousemove=null)}},{key:"intersectOverlays",value:function(r){for(var o=[],a=0;a<this.overlayData.length;a++){var s=this.overlayData[a],u=void 0;if(s.toString()==="Marker"){u=s._getInPnBox(r.pixel),u&&o.push(s);continue}s.toString()!=="Polyline"?u=s._getInPnpoly(r.point):u=s._getProximity(r.point);var l=u.dist;l>=0&&l<s._config.mouseOverTolerance&&o.push(s)}return o.length>0?o:null}}]),n}(Y),$=63710088e-1,zn={centimeters:$*100,centimetres:$*100,degrees:$/111325,feet:$*3.28084,inches:$*39.37,kilometers:$/1e3,kilometres:$/1e3,meters:$,metres:$,miles:$/1609.344,millimeters:$*1e3,millimetres:$*1e3,nauticalmiles:$/1852,radians:1,yards:$*1.0936},Ao={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/$,yards:1.0936133},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function W(t,e,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function Bo(t,e,n){switch(t){case"Point":return T(e).geometry;case"LineString":return D(e).geometry;case"Polygon":return ve(e).geometry;case"MultiPoint":return yi(e).geometry;case"MultiLineString":return pt(e).geometry;case"MultiPolygon":return Ge(e).geometry;default:throw new Error(t+" is invalid")}}function T(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!We(t[0])||!We(t[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:t};return W(i,e,n)}function Io(t,e,n){return n===void 0&&(n={}),X(t.map(function(i){return T(i,e)}),n)}function ve(t,e,n){n===void 0&&(n={});for(var i=0,r=t;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return W(s,e,n)}function To(t,e,n){return n===void 0&&(n={}),X(t.map(function(i){return ve(i,e)}),n)}function D(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:t};return W(i,e,n)}function No(t,e,n){return n===void 0&&(n={}),X(t.map(function(i){return D(i,e)}),n)}function X(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function pt(t,e,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:t};return W(i,e,n)}function yi(t,e,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:t};return W(i,e,n)}function Ge(t,e,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:t};return W(i,e,n)}function Go(t,e,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:t};return W(i,e,n)}function Do(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function Wn(t,e){e===void 0&&(e="kilometers");var n=zn[e];if(!n)throw new Error(e+" units is invalid");return t*n}function yt(t,e){e===void 0&&(e="kilometers");var n=zn[e];if(!n)throw new Error(e+" units is invalid");return t/n}function di(t,e){return we(yt(t,e))}function $o(t){var e=t%360;return e<0&&(e+=360),e}function we(t){var e=t%(2*Math.PI);return e*180/Math.PI}function j(t){var e=t%360;return e*Math.PI/180}function dt(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return Wn(yt(t,e),n)}function Co(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=Lt[e];if(!i)throw new Error("invalid original units");var r=Lt[n];if(!r)throw new Error("invalid final units");return t/i*r}function We(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function De(t){return!!t&&t.constructor===Object}function jo(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!We(e))throw new Error("bbox must only contain numbers")})}function Fo(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const zo=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Lt,bearingToAzimuth:$o,convertArea:Co,convertLength:dt,degreesToRadians:j,earthRadius:$,factors:zn,feature:W,featureCollection:X,geometry:Bo,geometryCollection:Go,isNumber:We,isObject:De,lengthToDegrees:di,lengthToRadians:yt,lineString:D,lineStrings:No,multiLineString:pt,multiPoint:yi,multiPolygon:Ge,point:T,points:Io,polygon:ve,polygons:To,radiansToDegrees:we,radiansToLength:Wn,round:Do,unitsFactors:Ao,validateBBox:jo,validateId:Fo},Symbol.toStringTag,{value:"Module"}));function ae(t,e,n){if(t!==null)for(var i,r,o,a,s,u,l,c=0,h=0,p,d=t.type,O=d==="FeatureCollection",g=d==="Feature",b=O?t.features.length:1,_=0;_<b;_++){l=O?t.features[_].geometry:g?t.geometry:t,p=l?l.type==="GeometryCollection":!1,s=p?l.geometries.length:1;for(var f=0;f<s;f++){var v=0,y=0;if(a=p?l.geometries[f]:l,a!==null){u=a.coordinates;var m=a.type;switch(c=n&&(m==="Polygon"||m==="MultiPolygon")?1:0,m){case null:break;case"Point":if(e(u,h,_,v,y)===!1)return!1;h++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<u.length;i++){if(e(u[i],h,_,v,y)===!1)return!1;h++,m==="MultiPoint"&&v++}m==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<u.length;i++){for(r=0;r<u[i].length-c;r++){if(e(u[i][r],h,_,v,y)===!1)return!1;h++}m==="MultiLineString"&&v++,m==="Polygon"&&y++}m==="Polygon"&&v++;break;case"MultiPolygon":for(i=0;i<u.length;i++){for(y=0,r=0;r<u[i].length;r++){for(o=0;o<u[i][r].length-c;o++){if(e(u[i][r][o],h,_,v,y)===!1)return!1;h++}y++}v++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(ae(a.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Wo(t,e,n,i){var r=n;return ae(t,function(o,a,s,u,l){a===0&&n===void 0?r=o:r=e(r,o,a,s,u,l)},i),r}function gi(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function Yo(t,e,n){var i=n;return gi(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function Pe(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function mi(t,e,n){var i=n;return Pe(t,function(r,o){o===0&&n===void 0?i=r:i=e(i,r,o)}),i}function Xo(t){var e=[];return ae(t,function(n){e.push(n)}),e}function Yn(t,e){var n,i,r,o,a,s,u,l,c,h,p=0,d=t.type==="FeatureCollection",O=t.type==="Feature",g=d?t.features.length:1;for(n=0;n<g;n++){for(s=d?t.features[n].geometry:O?t.geometry:t,l=d?t.features[n].properties:O?t.properties:{},c=d?t.features[n].bbox:O?t.bbox:void 0,h=d?t.features[n].id:O?t.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,r=0;r<a;r++){if(o=u?s.geometries[r]:s,o===null){if(e(null,p,l,c,h)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,p,l,c,h)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],p,l,c,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}p++}}function bi(t,e,n){var i=n;return Yn(t,function(r,o,a,s,u){o===0&&n===void 0?i=r:i=e(i,r,o,a,s,u)}),i}function te(t,e){Yn(t,function(n,i,r,o,a){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(W(n,r,{bbox:o,id:a}),i,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var l=0;l<n.coordinates.length;l++){var c=n.coordinates[l],h={type:u,coordinates:c};if(e(W(h,r),i,l)===!1)return!1}})}function Jo(t,e,n){var i=n;return te(t,function(r,o,a){o===0&&a===0&&n===void 0?i=r:i=e(i,r,o,a)}),i}function Xn(t,e){te(t,function(n,i,r){var o=0;if(n.geometry){var a=n.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var s,u=0,l=0,c=0;if(ae(n,function(h,p,d,O,g){if(s===void 0||i>u||O>l||g>c){s=h,u=i,l=O,c=g,o=0;return}var b=D([s,h],n.properties);if(e(b,i,r,g,o)===!1)return!1;o++,s=h})===!1)return!1}}})}function Oi(t,e,n){var i=n,r=!1;return Xn(t,function(o,a,s,u,l){r===!1&&n===void 0?i=o:i=e(i,o,a,s,u,l),r=!0}),i}function wi(t,e){if(!t)throw new Error("geojson is required");te(t,function(n,i,r){if(n.geometry!==null){var o=n.geometry.type,a=n.geometry.coordinates;switch(o){case"LineString":if(e(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(e(D(a[s],n.properties),i,r,s)===!1)return!1;break}}})}function Uo(t,e,n){var i=n;return wi(t,function(r,o,a,s){o===0&&n===void 0?i=r:i=e(i,r,o,a,s)}),i}function qo(t,e){if(e=e||{},!De(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.segmentIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=u.length+o-1),D([u[o],u[o+1]],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o-1),D([u[r][o],u[r][o+1]],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o-1),D([u[i][o],u[i][o+1]],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o-1),D([u[i][r][o],u[i][r][o+1]],a,e)}throw new Error("geojson is invalid")}function Ho(t,e){if(e=e||{},!De(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,o=e.coordIndex||0,a=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),a=a||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":a=a||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var u=s.coordinates;switch(s.type){case"Point":return T(u,a,e);case"MultiPoint":return i<0&&(i=u.length+i),T(u[i],a,e);case"LineString":return o<0&&(o=u.length+o),T(u[o],a,e);case"Polygon":return r<0&&(r=u.length+r),o<0&&(o=u[r].length+o),T(u[r][o],a,e);case"MultiLineString":return i<0&&(i=u.length+i),o<0&&(o=u[i].length+o),T(u[i][o],a,e);case"MultiPolygon":return i<0&&(i=u.length+i),r<0&&(r=u[i].length+r),o<0&&(o=u[i][r].length-o),T(u[i][r][o],a,e)}throw new Error("geojson is invalid")}const Qo=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Xo,coordEach:ae,coordReduce:Wo,featureEach:Pe,featureReduce:mi,findPoint:Ho,findSegment:qo,flattenEach:te,flattenReduce:Jo,geomEach:Yn,geomReduce:bi,lineEach:wi,lineReduce:Uo,propEach:gi,propReduce:Yo,segmentEach:Xn,segmentReduce:Oi},Symbol.toStringTag,{value:"Module"}));function oe(t){var e=[1/0,1/0,-1/0,-1/0];return ae(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}oe.default=oe;const Vo=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));function F(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function J(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function nr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}function H(t){return t.type==="Feature"?t.geometry:t}function Mt(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}var xt={},Ko={get exports(){return xt},set exports(t){xt=t}};(function(t,e){(function(n,i){t.exports=i()})(so,function(){function n(f,v,y,m,P){(function w(S,k,L,M,B){for(;M>L;){if(M-L>600){var R=M-L+1,N=k-L+1,re=Math.log(R),fe=.5*Math.exp(2*re/3),me=.5*Math.sqrt(re*fe*(R-fe)/R)*(N-R/2<0?-1:1),be=Math.max(L,Math.floor(k-N*fe/R+me)),ao=Math.min(M,Math.floor(k+(R-N)*fe/R+me));w(S,k,be,ao,B)}var $e=S[k],ke=L,V=M;for(i(S,L,k),B(S[M],$e)>0&&i(S,L,M);ke<V;){for(i(S,ke,V),ke++,V--;B(S[ke],$e)<0;)ke++;for(;B(S[V],$e)>0;)V--}B(S[L],$e)===0?i(S,L,V):i(S,++V,M),V<=k&&(L=V+1),k<=V&&(M=V-1)}})(f,v,y||0,m||f.length-1,P||r)}function i(f,v,y){var m=f[v];f[v]=f[y],f[y]=m}function r(f,v){return f<v?-1:f>v?1:0}var o=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(f,v,y){if(!y)return v.indexOf(f);for(var m=0;m<v.length;m++)if(y(f,v[m]))return m;return-1}function s(f,v){u(f,0,f.children.length,v,f)}function u(f,v,y,m,P){P||(P=b(null)),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(var w=v;w<y;w++){var S=f.children[w];l(P,f.leaf?m(S):S)}return P}function l(f,v){return f.minX=Math.min(f.minX,v.minX),f.minY=Math.min(f.minY,v.minY),f.maxX=Math.max(f.maxX,v.maxX),f.maxY=Math.max(f.maxY,v.maxY),f}function c(f,v){return f.minX-v.minX}function h(f,v){return f.minY-v.minY}function p(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function d(f){return f.maxX-f.minX+(f.maxY-f.minY)}function O(f,v){return f.minX<=v.minX&&f.minY<=v.minY&&v.maxX<=f.maxX&&v.maxY<=f.maxY}function g(f,v){return v.minX<=f.maxX&&v.minY<=f.maxY&&v.maxX>=f.minX&&v.maxY>=f.minY}function b(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(f,v,y,m,P){for(var w=[v,y];w.length;)if(!((y=w.pop())-(v=w.pop())<=m)){var S=v+Math.ceil((y-v)/m/2)*m;n(f,S,v,y,P),w.push(v,S,S,y)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(f){var v=this.data,y=[];if(!g(f,v))return y;for(var m=this.toBBox,P=[];v;){for(var w=0;w<v.children.length;w++){var S=v.children[w],k=v.leaf?m(S):S;g(f,k)&&(v.leaf?y.push(S):O(f,k)?this._all(S,y):P.push(S))}v=P.pop()}return y},o.prototype.collides=function(f){var v=this.data;if(!g(f,v))return!1;for(var y=[];v;){for(var m=0;m<v.children.length;m++){var P=v.children[m],w=v.leaf?this.toBBox(P):P;if(g(f,w)){if(v.leaf||O(f,w))return!0;y.push(P)}}v=y.pop()}return!1},o.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var v=0;v<f.length;v++)this.insert(f[v]);return this}var y=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===y.height)this._splitRoot(this.data,y);else{if(this.data.height<y.height){var m=this.data;this.data=y,y=m}this._insert(y,this.data.height-y.height-1,!0)}else this.data=y;return this},o.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},o.prototype.clear=function(){return this.data=b([]),this},o.prototype.remove=function(f,v){if(!f)return this;for(var y,m,P,w=this.data,S=this.toBBox(f),k=[],L=[];w||k.length;){if(w||(w=k.pop(),m=k[k.length-1],y=L.pop(),P=!0),w.leaf){var M=a(f,w.children,v);if(M!==-1)return w.children.splice(M,1),k.push(w),this._condense(k),this}P||w.leaf||!O(w,S)?m?(y++,w=m.children[y],P=!1):w=null:(k.push(w),L.push(y),y=0,m=w,w=w.children[0])}return this},o.prototype.toBBox=function(f){return f},o.prototype.compareMinX=function(f,v){return f.minX-v.minX},o.prototype.compareMinY=function(f,v){return f.minY-v.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(f){return this.data=f,this},o.prototype._all=function(f,v){for(var y=[];f;)f.leaf?v.push.apply(v,f.children):y.push.apply(y,f.children),f=y.pop();return v},o.prototype._build=function(f,v,y,m){var P,w=y-v+1,S=this._maxEntries;if(w<=S)return s(P=b(f.slice(v,y+1)),this.toBBox),P;m||(m=Math.ceil(Math.log(w)/Math.log(S)),S=Math.ceil(w/Math.pow(S,m-1))),(P=b([])).leaf=!1,P.height=m;var k=Math.ceil(w/S),L=k*Math.ceil(Math.sqrt(S));_(f,v,y,L,this.compareMinX);for(var M=v;M<=y;M+=L){var B=Math.min(M+L-1,y);_(f,M,B,k,this.compareMinY);for(var R=M;R<=B;R+=k){var N=Math.min(R+k-1,B);P.children.push(this._build(f,R,N,m-1))}}return s(P,this.toBBox),P},o.prototype._chooseSubtree=function(f,v,y,m){for(;m.push(v),!v.leaf&&m.length-1!==y;){for(var P=1/0,w=1/0,S=void 0,k=0;k<v.children.length;k++){var L=v.children[k],M=p(L),B=(R=f,N=L,(Math.max(N.maxX,R.maxX)-Math.min(N.minX,R.minX))*(Math.max(N.maxY,R.maxY)-Math.min(N.minY,R.minY))-M);B<w?(w=B,P=M<P?M:P,S=L):B===w&&M<P&&(P=M,S=L)}v=S||v.children[0]}var R,N;return v},o.prototype._insert=function(f,v,y){var m=y?f:this.toBBox(f),P=[],w=this._chooseSubtree(m,this.data,v,P);for(w.children.push(f),l(w,m);v>=0&&P[v].children.length>this._maxEntries;)this._split(P,v),v--;this._adjustParentBBoxes(m,P,v)},o.prototype._split=function(f,v){var y=f[v],m=y.children.length,P=this._minEntries;this._chooseSplitAxis(y,P,m);var w=this._chooseSplitIndex(y,P,m),S=b(y.children.splice(w,y.children.length-w));S.height=y.height,S.leaf=y.leaf,s(y,this.toBBox),s(S,this.toBBox),v?f[v-1].children.push(S):this._splitRoot(y,S)},o.prototype._splitRoot=function(f,v){this.data=b([f,v]),this.data.height=f.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(f,v,y){for(var m,P,w,S,k,L,M,B=1/0,R=1/0,N=v;N<=y-v;N++){var re=u(f,0,N,this.toBBox),fe=u(f,N,y,this.toBBox),me=(P=re,w=fe,S=void 0,k=void 0,L=void 0,M=void 0,S=Math.max(P.minX,w.minX),k=Math.max(P.minY,w.minY),L=Math.min(P.maxX,w.maxX),M=Math.min(P.maxY,w.maxY),Math.max(0,L-S)*Math.max(0,M-k)),be=p(re)+p(fe);me<B?(B=me,m=N,R=be<R?be:R):me===B&&be<R&&(R=be,m=N)}return m||y-v},o.prototype._chooseSplitAxis=function(f,v,y){var m=f.leaf?this.compareMinX:c,P=f.leaf?this.compareMinY:h;this._allDistMargin(f,v,y,m)<this._allDistMargin(f,v,y,P)&&f.children.sort(m)},o.prototype._allDistMargin=function(f,v,y,m){f.children.sort(m);for(var P=this.toBBox,w=u(f,0,v,P),S=u(f,y-v,y,P),k=d(w)+d(S),L=v;L<y-v;L++){var M=f.children[L];l(w,f.leaf?P(M):M),k+=d(w)}for(var B=y-v-1;B>=v;B--){var R=f.children[B];l(S,f.leaf?P(R):R),k+=d(S)}return k},o.prototype._adjustParentBBoxes=function(f,v,y){for(var m=y;m>=0;m--)l(v[m],f)},o.prototype._condense=function(f){for(var v=f.length-1,y=void 0;v>=0;v--)f[v].children.length===0?v>0?(y=f[v-1].children).splice(y.indexOf(f[v]),1):this.clear():s(f[v],this.toBBox)},o})})(Ko);function ne(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=F(t),r=H(e),o=r.type,a=e.bbox,s=r.coordinates;if(a&&Zo(i,a)===!1)return!1;o==="Polygon"&&(s=[s]);for(var u=!1,l=0;l<s.length&&!u;l++)if(rr(i,s[l][0],n.ignoreBoundary)){for(var c=!1,h=1;h<s[l].length&&!c;)rr(i,s[l][h],!n.ignoreBoundary)&&(c=!0),h++;c||(u=!0)}return u}function rr(t,e,n){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var r=0,o=e.length-1;r<e.length;o=r++){var a=e[r][0],s=e[r][1],u=e[o][0],l=e[o][1],c=t[1]*(a-u)+s*(u-t[0])+l*(t[0]-a)===0&&(a-t[0])*(u-t[0])<=0&&(s-t[1])*(l-t[1])<=0;if(c)return!n;var h=s>t[1]!=l>t[1]&&t[0]<(u-a)*(t[1]-s)/(l-s)+a;h&&(i=!i)}return i}function Zo(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function q(t,e,n){n===void 0&&(n={});var i=F(t),r=F(e),o=j(r[1]-i[1]),a=j(r[0]-i[0]),s=j(i[1]),u=j(r[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return Wn(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function Pi(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Ei(t);case"FeatureCollection":return ea(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Jn(t);default:throw new Error("unknown GeoJSON type")}}function Ei(t){var e={type:"Feature"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}}),e.properties=_i(t.properties),e.geometry=Jn(t.geometry),e}function _i(t){var e={};return t&&Object.keys(t).forEach(function(n){var i=t[n];typeof i=="object"?i===null?e[n]=null:Array.isArray(i)?e[n]=i.map(function(r){return r}):e[n]=_i(i):e[n]=i}),e}function ea(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}}),e.features=t.features.map(function(n){return Ei(n)}),e}function Jn(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(n){return Jn(n)}),e):(e.coordinates=Si(t.coordinates),e)}function Si(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(n){return Si(n)})}function ta(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=q(t.slice(0,2),[i,n]),a=q(t.slice(0,2),[e,r]);if(o>=a){var s=(n+r)/2;return[e,s-(i-e)/2,i,s+(i-e)/2]}else{var u=(e+i)/2;return[u-(r-n)/2,n,u+(r-n)/2,r]}}function Rt(t,e,n,i){i===void 0&&(i={});var r=F(t),o=j(r[0]),a=j(r[1]),s=j(n),u=yt(e,i.units),l=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s)),c=o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(l)),h=we(c),p=we(l);return T([h,p],i.properties)}function Un(t,e,n){if(n===void 0&&(n={}),n.final===!0)return na(t,e);var i=F(t),r=F(e),o=j(i[0]),a=j(r[0]),s=j(i[1]),u=j(r[1]),l=Math.sin(a-o)*Math.cos(u),c=Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o);return we(Math.atan2(l,c))}function na(t,e){var n=Un(e,t);return n=(n+180)%360,n}function ra(t,e){var n=q(t,e),i=Un(t,e),r=Rt(t,n/2,i);return r}function ia(t,e){e===void 0&&(e={});var n=0,i=0,r=0;return ae(t,function(o){n+=o[0],i+=o[1],r++},!0),T([n/r,i/r],e.properties)}function At(t){if(!t)throw new Error("geojson is required");var e=[];return te(t,function(n){oa(n,e)}),X(e)}function oa(t,e){var n=[],i=t.geometry;if(i!==null){switch(i.type){case"Polygon":n=J(i);break;case"LineString":n=[J(i)]}n.forEach(function(r){var o=aa(r,t.properties);o.forEach(function(a){a.id=e.length,e.push(a)})})}}function aa(t,e){var n=[];return t.reduce(function(i,r){var o=D([i,r],e);return o.bbox=sa(i,r),n.push(o),r}),n}function sa(t,e){var n=t[0],i=t[1],r=e[0],o=e[1],a=n<r?n:r,s=i<o?i:o,u=n>r?n:r,l=i>o?i:o;return[a,s,u,l]}var Ee={},ua={get exports(){return Ee},set exports(t){Ee=t}};const la=jn(zo),ca=jn(Qo),fa=jn(Vo);var Z=xt,ki=la,Li=ca,Oe=fa.default,ha=Li.featureEach;Li.coordEach;ki.polygon;var ir=ki.featureCollection;function Mi(t){var e=new Z(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Oe(n),Z.prototype.insert.call(this,n)},e.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Oe(r),i.push(r)}):ha(n,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Oe(r),i.push(r)}),Z.prototype.load.call(this,i)},e.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Oe(n),Z.prototype.remove.call(this,n,i)},e.clear=function(){return Z.prototype.clear.call(this)},e.search=function(n){var i=Z.prototype.search.call(this,this.toBBox(n));return ir(i)},e.collides=function(n){return Z.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=Z.prototype.all.call(this);return ir(n)},e.toJSON=function(){return Z.prototype.toJSON.call(this)},e.fromJSON=function(n){return Z.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Oe(n);else if(n.type==="FeatureCollection")i=Oe(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}ua.exports=Mi;Ee.default=Mi;function Se(t,e){var n={},i=[];if(t.type==="LineString"&&(t=W(t)),e.type==="LineString"&&(e=W(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var r=or(t,e);return r&&i.push(r),X(i)}var o=Ee();return o.load(At(e)),Pe(At(t),function(a){Pe(o.search(a),function(s){var u=or(a,s);if(u){var l=J(u).join(",");n[l]||(n[l]=!0,i.push(u))}})}),X(i)}function or(t,e){var n=J(t),i=J(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],u=i[0][0],l=i[0][1],c=i[1][0],h=i[1][1],p=(h-l)*(a-r)-(c-u)*(s-o),d=(c-u)*(o-l)-(h-l)*(r-u),O=(a-r)*(o-l)-(s-o)*(r-u);if(p===0)return d===0&&O===0,null;var g=d/p,b=O/p;if(g>=0&&g<=1&&b>=0&&b<=1){var _=r+g*(a-r),f=o+g*(s-o);return T([_,f])}return null}function xi(t,e,n){n===void 0&&(n={});var i=T([1/0,1/0],{dist:1/0}),r=0;return te(t,function(o){for(var a=J(o),s=0;s<a.length-1;s++){var u=T(a[s]);u.properties.dist=q(e,u,n);var l=T(a[s+1]);l.properties.dist=q(e,l,n);var c=q(u,l,n),h=Math.max(u.properties.dist,l.properties.dist),p=Un(u,l),d=Rt(e,h,p+90,n),O=Rt(e,h,p-90,n),g=Se(D([d.geometry.coordinates,O.geometry.coordinates]),D([u.geometry.coordinates,l.geometry.coordinates])),b=null;g.features.length>0&&(b=g.features[0],b.properties.dist=q(e,b,n),b.properties.location=r+q(u,b,n)),u.properties.dist<i.properties.dist&&(i=u,i.properties.index=s,i.properties.location=r),l.properties.dist<i.properties.dist&&(i=l,i.properties.index=s+1,i.properties.location=r+c),b&&b.properties.dist<i.properties.dist&&(i=b,i.properties.index=s),r+=c}}),i}function Ri(t,e,n){n===void 0&&(n={});var i=F(t),r=F(e);r[0]+=r[0]-i[0]>180?-360:i[0]-r[0]>180?360:0;var o=va(i,r),a=dt(o,"meters",n.units);return a}function va(t,e,n){n=n===void 0?$:Number(n);var i=n,r=t[1]*Math.PI/180,o=e[1]*Math.PI/180,a=o-r,s=Math.abs(e[0]-t[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var u=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),l=Math.abs(u)>1e-11?a/u:Math.cos(r),c=Math.sqrt(a*a+l*l*s*s),h=c*i;return h}function pa(t,e,n){if(n===void 0&&(n={}),n.method||(n.method="geodesic"),n.units||(n.units="kilometers"),!t)throw new Error("pt is required");if(Array.isArray(t)?t=T(t):t.type==="Point"?t=W(t):nr(t,"Point","point"),!e)throw new Error("line is required");Array.isArray(e)?e=D(e):e.type==="LineString"?e=W(e):nr(e,"LineString","line");var i=1/0,r=t.geometry.coordinates;return Xn(e,function(o){var a=o.geometry.coordinates[0],s=o.geometry.coordinates[1],u=ya(r,a,s,n);u<i&&(i=u)}),dt(i,"degrees",n.units)}function ya(t,e,n,i){var r=[n[0]-e[0],n[1]-e[1]],o=[t[0]-e[0],t[1]-e[1]],a=ar(o,r);if(a<=0)return bt(t,e,{method:i.method,units:"degrees"});var s=ar(r,r);if(s<=a)return bt(t,n,{method:i.method,units:"degrees"});var u=a/s,l=[e[0]+u*r[0],e[1]+u*r[1]];return bt(t,l,{method:i.method,units:"degrees"})}function ar(t,e){return t[0]*e[0]+t[1]*e[1]}function bt(t,e,n){return n.method==="planar"?Ri(t,e,n):q(t,e,n)}var sr=6378137;function da(t){return bi(t,function(e,n){return e+ga(n)},0)}function ga(t){var e=0,n;switch(t.type){case"Polygon":return ur(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)e+=ur(t.coordinates[n]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function ur(t){var e=0;if(t&&t.length>0){e+=Math.abs(lr(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(lr(t[n]))}return e}function lr(t){var e,n,i,r,o,a,s,u=0,l=t.length;if(l>2){for(s=0;s<l;s++)s===l-2?(r=l-2,o=l-1,a=0):s===l-1?(r=l-1,o=0,a=1):(r=s,o=s+1,a=s+2),e=t[r],n=t[o],i=t[a],u+=(Ot(i[0])-Ot(e[0]))*Math.sin(Ot(n[1]));u=u*sr*sr/2}return u}function Ot(t){return t*Math.PI/180}function ma(t,e){return e===void 0&&(e={}),Oi(t,function(n,i){var r=i.geometry.coordinates;return n+q(r[0],r[1],e)},0)}function _e(t,e,n){n===void 0&&(n={});for(var i=F(t),r=J(e),o=0;o<r.length-1;o++){var a=!1;if(n.ignoreEndVertices&&(o===0&&(a="start"),o===r.length-2&&(a="end"),o===0&&o+1===r.length-1&&(a="both")),ba(r[o],r[o+1],i,a,typeof n.epsilon>"u"?null:n.epsilon))return!0}return!1}function ba(t,e,n,i,r){var o=n[0],a=n[1],s=t[0],u=t[1],l=e[0],c=e[1],h=n[0]-s,p=n[1]-u,d=l-s,O=c-u,g=h*O-p*d;if(r!==null){if(Math.abs(g)>r)return!1}else if(g!==0)return!1;if(i){if(i==="start")return Math.abs(d)>=Math.abs(O)?d>0?s<o&&o<=l:l<=o&&o<s:O>0?u<a&&a<=c:c<=a&&a<u;if(i==="end")return Math.abs(d)>=Math.abs(O)?d>0?s<=o&&o<l:l<o&&o<=s:O>0?u<=a&&a<c:c<a&&a<=u;if(i==="both")return Math.abs(d)>=Math.abs(O)?d>0?s<o&&o<l:l<o&&o<s:O>0?u<a&&a<c:c<a&&a<u}else return Math.abs(d)>=Math.abs(O)?d>0?s<=o&&o<=l:l<=o&&o<=s:O>0?u<=a&&a<=c:c<=a&&a<=u;return!1}function Oa(t,e){e===void 0&&(e={});var n=e.precision,i=e.coordinates,r=e.mutate;if(n=n==null||isNaN(n)?6:n,i=i==null||isNaN(i)?3:i,!t)throw new Error("<geojson> is required");if(typeof n!="number")throw new Error("<precision> must be a number");if(typeof i!="number")throw new Error("<coordinates> must be a number");(r===!1||r===void 0)&&(t=JSON.parse(JSON.stringify(t)));var o=Math.pow(10,n);return ae(t,function(a){wa(a,o,i)}),t}function wa(t,e,n){t.length>n&&t.splice(n,t.length);for(var i=0;i<t.length;i++)t[i]=Math.round(t[i]*e)/e;return t}function Pa(t,e){if(!t)throw new Error("line is required");if(!e)throw new Error("splitter is required");var n=Mt(t),i=Mt(e);if(n!=="LineString")throw new Error("line must be LineString");if(i==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(i==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var r=Oa(e,{precision:7});switch(i){case"Point":return Bt(t,r);case"MultiPoint":return cr(t,r);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return cr(t,Se(t,r))}}function cr(t,e){var n=[],i=Ee();return te(e,function(r){if(n.forEach(function(s,u){s.id=u}),!n.length)n=Bt(t,r).features,n.forEach(function(s){s.bbox||(s.bbox=ta(oe(s)))}),i.load(X(n));else{var o=i.search(r);if(o.features.length){var a=Ai(r,o);n=n.filter(function(s){return s.id!==a.id}),i.remove(a),Pe(Bt(a,r),function(s){n.push(s),i.insert(s)})}}}),X(n)}function Bt(t,e){var n=[],i=J(t)[0],r=J(t)[t.geometry.coordinates.length-1];if(wt(i,F(e))||wt(r,F(e)))return X([t]);var o=Ee(),a=At(t);o.load(a);var s=o.search(e);if(!s.features.length)return X([t]);var u=Ai(e,s),l=[i],c=mi(a,function(h,p,d){var O=J(p)[1],g=F(e);return d===u.id?(h.push(g),n.push(D(h)),wt(g,O)?[g]:[g,O]):(h.push(O),h)},l);return c.length>1&&n.push(D(c)),X(n)}function Ai(t,e){if(!e.features.length)throw new Error("lines must contain features");if(e.features.length===1)return e.features[0];var n,i=1/0;return Pe(e,function(r){var o=xi(r,t),a=o.properties.dist;a<i&&(n=r,i=a)}),n}function wt(t,e){return t[0]===e[0]&&t[1]===e[1]}function It(t,e){e===void 0&&(e={});var n=H(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return Ea(n,e);case"MultiPolygon":return _a(n,e);default:throw new Error("invalid poly")}}function Ea(t,e){e===void 0&&(e={});var n=H(t),i=n.coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Bi(i,r)}function _a(t,e){e===void 0&&(e={});var n=H(t),i=n.coordinates,r=e.properties?e.properties:t.type==="Feature"?t.properties:{},o=[];return i.forEach(function(a){o.push(Bi(a,r))}),X(o)}function Bi(t,e){return t.length>1?pt(t,e):D(t[0],e)}function Sa(t,e){e===void 0&&(e={});var n,i,r,o=e.properties,a=(n=e.autoComplete)!==null&&n!==void 0?n:!0,s=(i=e.orderCoords)!==null&&i!==void 0?i:!0,u=(r=e.mutate)!==null&&r!==void 0?r:!1;switch(u||(t=Pi(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(c){l.push(J(fr(c,{},a,s)))}),Ge(l,o);default:return fr(t,o,a,s)}}function fr(t,e,n,i){e=e||(t.type==="Feature"?t.properties:{});var r=H(t),o=r.coordinates,a=r.type;if(!o.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return n&&(o=hr(o)),ve([o],e);case"MultiLineString":var s=[],u=0;return o.forEach(function(l){if(n&&(l=hr(l)),i){var c=ka(oe(D(l)));c>u?(s.unshift(l),u=c):s.push(l)}else s.push(l)}),ve(s,e);default:throw new Error("geometry type "+a+" is not supported")}}function hr(t){var e=t[0],n=e[0],i=e[1],r=t[t.length-1],o=r[0],a=r[1];return(n!==o||i!==a)&&t.push(e),t}function ka(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.abs(e-i)*Math.abs(n-r)}function La(t,e,n){n===void 0&&(n={});var i;n.final?i=vr(F(e),F(t)):i=vr(F(t),F(e));var r=i>180?-(360-i):i;return r}function vr(t,e){var n=j(t[1]),i=j(e[1]),r=j(e[0]-t[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),a=Math.atan2(r,o);return(we(a)+360)%360}function Ma(t,e,n,i){i===void 0&&(i={});var r=e<0,o=dt(Math.abs(e),i.units,"meters");r&&(o=-Math.abs(o));var a=F(t),s=xa(a,o,n);return s[0]+=s[0]-a[0]>180?-360:a[0]-s[0]>180?360:0,T(s,i.properties)}function xa(t,e,n,i){i=i===void 0?$:Number(i);var r=e/i,o=t[0]*Math.PI/180,a=j(t[1]),s=j(n),u=r*Math.cos(s),l=a+u;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var c=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),h=Math.abs(c)>1e-11?u/c:Math.cos(a),p=r*Math.sin(s)/h,d=o+p;return[(d*180/Math.PI+540)%360-180,l*180/Math.PI]}function Ra(t,e,n,i){if(i=i||{},!De(i))throw new Error("options is invalid");var r=i.units,o=i.zTranslation,a=i.mutate;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");if(o&&typeof o!="number"&&isNaN(o))throw new Error("zTranslation is not a number");if(o=o!==void 0?o:0,e===0&&o===0)return t;if(n==null||isNaN(n))throw new Error("direction is required");return e<0&&(e=-e,n=n+180),(a===!1||a===void 0)&&(t=Pi(t)),ae(t,function(s){var u=J(Ma(s,e,n,{units:r}));s[0]=u[0],s[1]=u[1],o&&s.length===3&&(s[2]+=o)}),t}function Ye(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function Tt(t,e){return t[0]*e[1]-e[0]*t[1]}function Aa(t,e){return[t[0]+e[0],t[1]+e[1]]}function Ba(t,e){return[t[0]-e[0],t[1]-e[1]]}function Ia(t,e){return[t*e[0],t*e[1]]}function Ta(t,e){var n=t[0],i=Ye(t),r=e[0],o=Ye(e),a=Tt(i,o),s=Ba(r,n),u=Tt(s,o),l=u/a,c=Aa(n,Ia(l,i));return c}function Na(t,e){var n=Ye(t),i=Ye(e);return Tt(n,i)===0}function Ga(t,e){return Na(t,e)?!1:Ta(t,e)}function pr(t,e,n){if(n=n||{},!De(n))throw new Error("options is invalid");var i=n.units;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var r=Mt(t),o=t.properties;switch(r){case"LineString":return yr(t,e,i);case"MultiLineString":var a=[];return te(t,function(s){a.push(yr(s,e,i).geometry.coordinates)}),pt(a,o);default:throw new Error("geometry "+r+" is not supported")}}function yr(t,e,n){var i=[],r=di(e,n),o=J(t),a=[];return o.forEach(function(s,u){if(u!==o.length-1){var l=Da(s,o[u+1],r);if(i.push(l),u>0){var c=i[u-1],h=Ga(l,c);h!==!1&&(c[1]=h,l[0]=h),a.push(c[0]),u===o.length-2&&(a.push(l[0]),a.push(l[1]))}o.length===2&&(a.push(l[0]),a.push(l[1]))}}),D(a,t.properties)}function Da(t,e,n){var i=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),r=t[0]+n*(e[1]-t[1])/i,o=e[0]+n*(e[1]-t[1])/i,a=t[1]+n*(t[0]-e[0])/i,s=e[1]+n*(t[0]-e[0])/i;return[[r,a],[o,s]]}function qn(t,e){var n=!0;return te(t,function(i){te(e,function(r){if(n===!1)return!1;n=$a(i.geometry,r.geometry)})}),n}function $a(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!za(t.coordinates,e.coordinates);case"LineString":return!dr(e,t);case"Polygon":return!ne(t,e)}break;case"LineString":switch(e.type){case"Point":return!dr(t,e);case"LineString":return!Ca(t,e);case"Polygon":return!gr(e,t)}break;case"Polygon":switch(e.type){case"Point":return!ne(e,t);case"LineString":return!gr(t,e);case"Polygon":return!ja(e,t)}}return!1}function dr(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(Fa(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function Ca(t,e){var n=Se(t,e);return n.features.length>0}function gr(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var r=i[n];if(ne(r,t))return!0}var o=Se(e,It(t));return o.features.length>0}function ja(t,e){for(var n=0,i=t.coordinates[0];n<i.length;n++){var r=i[n];if(ne(r,e))return!0}for(var o=0,a=e.coordinates[0];o<a.length;o++){var s=a[o];if(ne(s,t))return!0}var u=Se(It(t),It(e));return u.features.length>0}function Fa(t,e,n){var i=n[0]-t[0],r=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],s=i*a-r*o;return s!==0?!1:Math.abs(o)>=Math.abs(a)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function za(t,e){return t[0]===e[0]&&t[1]===e[1]}function Wa(t,e){var n=H(t),i=H(e),r=n.type,o=i.type,a=n.coordinates,s=i.coordinates;switch(r){case"Point":switch(o){case"Point":return Hn(a,s);default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"Point":return Ya(n,i);case"MultiPoint":return Xa(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return _e(i,n,{ignoreEndVertices:!0});case"LineString":return qa(n,i);case"MultiPoint":return Ja(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return ne(i,n,{ignoreBoundary:!0});case"LineString":return Ha(n,i);case"Polygon":return Qa(n,i);case"MultiPoint":return Ua(n,i);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+r+" geometry not supported")}}function Ya(t,e){var n,i=!1;for(n=0;n<t.coordinates.length;n++)if(Hn(t.coordinates[n],e.coordinates)){i=!0;break}return i}function Xa(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){for(var r=i[n],o=!1,a=0,s=t.coordinates;a<s.length;a++){var u=s[a];if(Hn(r,u)){o=!0;break}}if(!o)return!1}return!0}function Ja(t,e){for(var n=!1,i=0,r=e.coordinates;i<r.length;i++){var o=r[i];if(_e(o,t,{ignoreEndVertices:!0})&&(n=!0),!_e(o,t))return!1}return!!n}function Ua(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var r=i[n];if(!ne(r,t,{ignoreBoundary:!0}))return!1}return!0}function qa(t,e){for(var n=!1,i=0,r=e.coordinates;i<r.length;i++){var o=r[i];if(_e({type:"Point",coordinates:o},t,{ignoreEndVertices:!0})&&(n=!0),!_e({type:"Point",coordinates:o},t,{ignoreEndVertices:!1}))return!1}return n}function Ha(t,e){var n=!1,i=0,r=oe(t),o=oe(e);if(!Ii(r,o))return!1;for(i;i<e.coordinates.length-1;i++){var a=Va(e.coordinates[i],e.coordinates[i+1]);if(ne({type:"Point",coordinates:a},t,{ignoreBoundary:!0})){n=!0;break}}return n}function Qa(t,e){if(t.type==="Feature"&&t.geometry===null||e.type==="Feature"&&e.geometry===null)return!1;var n=oe(t),i=oe(e);if(!Ii(n,i))return!1;for(var r=H(e).coordinates,o=0,a=r;o<a.length;o++)for(var s=a[o],u=0,l=s;u<l.length;u++){var c=l[u];if(!ne(c,t))return!1}return!0}function Ii(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function Hn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Va(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Ka(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=l[0]&2?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],r=0}finally{i=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var ce=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function Za(t,e){return t>e?1:t<e?-1:0}function se(t,e,n){for(var i=new ce(null,null),r=i,o=i;;){var a=n(t,e.key);if(a<0){if(e.left===null)break;if(n(t,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(a>0){if(e.right===null)break;if(n(t,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}r.right=e,r=e,e=e.right}else break}return r.right=e.left,o.left=e.right,e.left=i.right,e.right=i.left,e}function Pt(t,e,n,i){var r=new ce(t,e);if(n===null)return r.left=r.right=null,r;n=se(t,n,i);var o=i(t,n.key);return o<0?(r.left=n.left,r.right=n,n.left=null):o>=0&&(r.right=n.right,r.left=n,n.right=null),r}function mr(t,e,n){var i=null,r=null;if(e){e=se(t,e,n);var o=n(e.key,t);o===0?(i=e.left,r=e.right):o<0?(r=e.right,e.right=null,i=e):(i=e.left,e.left=null,r=e)}return{left:i,right:r}}function es(t,e,n){return e===null?t:(t===null||(e=se(t.key,e,n),e.left=t),e)}function Nt(t,e,n,i,r){if(t){i(""+e+(n?"└── ":"├── ")+r(t)+`
`);var o=e+(n?"    ":"│   ");t.left&&Nt(t.left,o,!1,i,r),t.right&&Nt(t.right,o,!0,i,r)}}var Qn=function(){function t(e){e===void 0&&(e=Za),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=Pt(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var i=new ce(e,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,o=se(e,this._root,r),a=r(e,o.key);return a===0?this._root=o:(a<0?(i.left=o.left,i.right=o,o.left=null):a>0&&(i.right=o.right,i.left=o,o.right=null),this._size++,this._root=i),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,i){var r;if(n===null)return null;n=se(e,n,i);var o=i(e,n.key);return o===0?(n.left===null?r=n.right:(r=se(e,n.left,i),r.right=n.right),this._size--,r):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=se(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,i=this._comparator;n;){var r=i(e,n.key);if(r===0)return n;r<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=se(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,i=this._comparator;n;){var r=i(e,n.key);if(r===0)return!0;r<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var i=this._root,r=[],o=!1;!o;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),e.call(n,i),i=i.right):o=!0;return this},t.prototype.range=function(e,n,i,r){for(var o=[],a=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=a(s.key,n),u>0)break;if(a(s.key,e)>=0&&i.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var i=n.key;return e.push(i)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var i=n.data;return e.push(i)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,i=!1,r=0,o=[];!i;)if(n)o.push(n),n=n.left;else if(o.length>0){if(n=o.pop(),r===e)return n;r++,n=n.right}else i=!0;return null},t.prototype.next=function(e){var n=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var r=this._comparator;n;){var o=r(e.key,n.key);if(o===0)break;o<0?(i=n,n=n.left):n=n.right}return i},t.prototype.prev=function(e){var n=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var r=this._comparator;n;){var o=r(e.key,n.key);if(o===0)break;o<0?n=n.left:(i=n,n=n.right)}return i},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return ns(this._root)},t.prototype.load=function(e,n,i){n===void 0&&(n=[]),i===void 0&&(i=!1);var r=e.length,o=this._comparator;if(i&&$t(e,n,0,r-1,o),this._root===null)this._root=Gt(e,n,0,r),this._size=r;else{var a=rs(this.toList(),ts(e,n),o);r=this._size+r,this._root=Dt({head:a},0,r)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var n=[];return Nt(this._root,"",!0,function(i){return n.push(i)},e),n.join("")},t.prototype.update=function(e,n,i){var r=this._comparator,o=mr(e,this._root,r),a=o.left,s=o.right;r(e,n)<0?s=Pt(n,i,s,r):a=Pt(n,i,a,r),this._root=es(a,s,r)},t.prototype.split=function(e){return mr(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e;return Ka(this,function(n){switch(n.label){case 0:e=this.minNode(),n.label=1;case 1:return e?[4,e]:[3,3];case 2:return n.sent(),e=this.next(e),[3,1];case 3:return[2]}})},t}();function Gt(t,e,n,i){var r=i-n;if(r>0){var o=n+Math.floor(r/2),a=t[o],s=e[o],u=new ce(a,s);return u.left=Gt(t,e,n,o),u.right=Gt(t,e,o+1,i),u}return null}function ts(t,e){for(var n=new ce(null,null),i=n,r=0;r<t.length;r++)i=i.next=new ce(t[r],e[r]);return i.next=null,n.next}function ns(t){for(var e=t,n=[],i=!1,r=new ce(null,null),o=r;!i;)e?(n.push(e),e=e.left):n.length>0?(e=o=o.next=n.pop(),e=e.right):i=!0;return o.next=null,r.next}function Dt(t,e,n){var i=n-e;if(i>0){var r=e+Math.floor(i/2),o=Dt(t,e,r),a=t.head;return a.left=o,t.head=t.head.next,a.right=Dt(t,r+1,n),a}return null}function rs(t,e,n){for(var i=new ce(null,null),r=i,o=t,a=e;o!==null&&a!==null;)n(o.key,a.key)<0?(r.next=o,o=o.next):(r.next=a,a=a.next),r=r.next;return o!==null?r.next=o:a!==null&&(r.next=a),i.next}function $t(t,e,n,i,r){if(!(n>=i)){for(var o=t[n+i>>1],a=n-1,s=i+1;;){do a++;while(r(t[a],o)<0);do s--;while(r(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}$t(t,e,n,s,r),$t(t,e,s+1,i,r)}}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function br(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function z(t,e,n){return e&&br(t.prototype,e),n&&br(t,n),t}var Le=function(e,n){return e.ll.x<=n.x&&n.x<=e.ur.x&&e.ll.y<=n.y&&n.y<=e.ur.y},Ct=function(e,n){if(n.ur.x<e.ll.x||e.ur.x<n.ll.x||n.ur.y<e.ll.y||e.ur.y<n.ll.y)return null;var i=e.ll.x<n.ll.x?n.ll.x:e.ll.x,r=e.ur.x<n.ur.x?e.ur.x:n.ur.x,o=e.ll.y<n.ll.y?n.ll.y:e.ll.y,a=e.ur.y<n.ur.y?e.ur.y:n.ur.y;return{ll:{x:i,y:o},ur:{x:r,y:a}}},ue=Number.EPSILON;ue===void 0&&(ue=Math.pow(2,-52));var is=ue*ue,jt=function(e,n){if(-ue<e&&e<ue&&-ue<n&&n<ue)return 0;var i=e-n;return i*i<is*e*n?0:e<n?-1:1},os=function(){function t(){Q(this,t),this.reset()}return z(t,[{key:"reset",value:function(){this.xRounder=new Or,this.yRounder=new Or}},{key:"round",value:function(n,i){return{x:this.xRounder.round(n),y:this.yRounder.round(i)}}}]),t}(),Or=function(){function t(){Q(this,t),this.tree=new Qn,this.round(0)}return z(t,[{key:"round",value:function(n){var i=this.tree.add(n),r=this.tree.prev(i);if(r!==null&&jt(i.key,r.key)===0)return this.tree.remove(n),r.key;var o=this.tree.next(i);return o!==null&&jt(i.key,o.key)===0?(this.tree.remove(n),o.key):n}}]),t}(),Te=new os,xe=function(e,n){return e.x*n.y-e.y*n.x},Ti=function(e,n){return e.x*n.x+e.y*n.y},wr=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y},a=xe(r,o);return jt(a,0)},Xe=function(e){return Math.sqrt(Ti(e,e))},as=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y};return xe(o,r)/Xe(o)/Xe(r)},ss=function(e,n,i){var r={x:n.x-e.x,y:n.y-e.y},o={x:i.x-e.x,y:i.y-e.y};return Ti(o,r)/Xe(o)/Xe(r)},Pr=function(e,n,i){return n.y===0?null:{x:e.x+n.x/n.y*(i-e.y),y:i}},Er=function(e,n,i){return n.x===0?null:{x:i,y:e.y+n.y/n.x*(i-e.x)}},us=function(e,n,i,r){if(n.x===0)return Er(i,r,e.x);if(r.x===0)return Er(e,n,i.x);if(n.y===0)return Pr(i,r,e.y);if(r.y===0)return Pr(e,n,i.y);var o=xe(n,r);if(o==0)return null;var a={x:i.x-e.x,y:i.y-e.y},s=xe(a,n)/o,u=xe(a,r)/o,l=e.x+u*n.x,c=i.x+s*r.x,h=e.y+u*n.y,p=i.y+s*r.y,d=(l+c)/2,O=(h+p)/2;return{x:d,y:O}},ee=function(){z(t,null,[{key:"compare",value:function(n,i){var r=t.comparePoints(n.point,i.point);return r!==0?r:(n.point!==i.point&&n.link(i),n.isLeft!==i.isLeft?n.isLeft?1:-1:Je.compare(n.segment,i.segment))}},{key:"comparePoints",value:function(n,i){return n.x<i.x?-1:n.x>i.x?1:n.y<i.y?-1:n.y>i.y?1:0}}]);function t(e,n){Q(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return z(t,[{key:"link",value:function(n){if(n.point===this.point)throw new Error("Tried to link already linked events");for(var i=n.point.events,r=0,o=i.length;r<o;r++){var a=i[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var n=this.point.events.length,i=0;i<n;i++){var r=this.point.events[i];if(r.segment.consumedBy===void 0)for(var o=i+1;o<n;o++){var a=this.point.events[o];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var n=[],i=0,r=this.point.events.length;i<r;i++){var o=this.point.events[i];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&n.push(o)}return n}},{key:"getLeftmostComparator",value:function(n){var i=this,r=new Map,o=function(s){var u=s.otherSE;r.set(s,{sine:as(i.point,n.point,u.point),cosine:ss(i.point,n.point,u.point)})};return function(a,s){r.has(a)||o(a),r.has(s)||o(s);var u=r.get(a),l=u.sine,c=u.cosine,h=r.get(s),p=h.sine,d=h.cosine;return l>=0&&p>=0?c<d?1:c>d?-1:0:l<0&&p<0?c<d?-1:c>d?1:0:p<l?-1:p>l?1:0}}}]),t}(),ls=0,Je=function(){z(t,null,[{key:"compare",value:function(n,i){var r=n.leftSE.point.x,o=i.leftSE.point.x,a=n.rightSE.point.x,s=i.rightSE.point.x;if(s<r)return 1;if(a<o)return-1;var u=n.leftSE.point.y,l=i.leftSE.point.y,c=n.rightSE.point.y,h=i.rightSE.point.y;if(r<o){if(l<u&&l<c)return 1;if(l>u&&l>c)return-1;var p=n.comparePoint(i.leftSE.point);if(p<0)return 1;if(p>0)return-1;var d=i.comparePoint(n.rightSE.point);return d!==0?d:-1}if(r>o){if(u<l&&u<h)return-1;if(u>l&&u>h)return 1;var O=i.comparePoint(n.leftSE.point);if(O!==0)return O;var g=n.comparePoint(i.rightSE.point);return g<0?1:g>0?-1:1}if(u<l)return-1;if(u>l)return 1;if(a<s){var b=i.comparePoint(n.rightSE.point);if(b!==0)return b}if(a>s){var _=n.comparePoint(i.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(a!==s){var f=c-u,v=a-r,y=h-l,m=s-o;if(f>v&&y<m)return 1;if(f<v&&y>m)return-1}return a>s?1:a<s||c<h?-1:c>h?1:n.id<i.id?-1:n.id>i.id?1:0}}]);function t(e,n,i,r){Q(this,t),this.id=++ls,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=i,this.windings=r}return z(t,[{key:"replaceRightSE",value:function(n){this.rightSE=n,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var n=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:n<i?n:i},ur:{x:this.rightSE.point.x,y:n>i?n:i}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(n){return n.x===this.leftSE.point.x&&n.y===this.leftSE.point.y||n.x===this.rightSE.point.x&&n.y===this.rightSE.point.y}},{key:"comparePoint",value:function(n){if(this.isAnEndpoint(n))return 0;var i=this.leftSE.point,r=this.rightSE.point,o=this.vector();if(i.x===r.x)return n.x===i.x?0:n.x<i.x?1:-1;var a=(n.y-i.y)/o.y,s=i.x+a*o.x;if(n.x===s)return 0;var u=(n.x-i.x)/o.x,l=i.y+u*o.y;return n.y===l?0:n.y<l?-1:1}},{key:"getIntersection",value:function(n){var i=this.bbox(),r=n.bbox(),o=Ct(i,r);if(o===null)return null;var a=this.leftSE.point,s=this.rightSE.point,u=n.leftSE.point,l=n.rightSE.point,c=Le(i,u)&&this.comparePoint(u)===0,h=Le(r,a)&&n.comparePoint(a)===0,p=Le(i,l)&&this.comparePoint(l)===0,d=Le(r,s)&&n.comparePoint(s)===0;if(h&&c)return d&&!p?s:!d&&p?l:null;if(h)return p&&a.x===l.x&&a.y===l.y?null:a;if(c)return d&&s.x===u.x&&s.y===u.y?null:u;if(d&&p)return null;if(d)return s;if(p)return l;var O=us(a,this.vector(),u,n.vector());return O===null||!Le(o,O)?null:Te.round(O.x,O.y)}},{key:"split",value:function(n){var i=[],r=n.events!==void 0,o=new ee(n,!0),a=new ee(n,!1),s=this.rightSE;this.replaceRightSE(a),i.push(a),i.push(o);var u=new t(o,s,this.rings.slice(),this.windings.slice());return ee.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),ee.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(o.checkForConsuming(),a.checkForConsuming()),i}},{key:"swapEvents",value:function(){var n=this.rightSE;this.rightSE=this.leftSE,this.leftSE=n,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var i=0,r=this.windings.length;i<r;i++)this.windings[i]*=-1}},{key:"consume",value:function(n){for(var i=this,r=n;i.consumedBy;)i=i.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var o=t.compare(i,r);if(o!==0){if(o>0){var a=i;i=r,r=a}if(i.prev===r){var s=i;i=r,r=s}for(var u=0,l=r.rings.length;u<l;u++){var c=r.rings[u],h=r.windings[u],p=i.rings.indexOf(c);p===-1?(i.rings.push(c),i.windings.push(h)):i.windings[p]+=h}r.rings=null,r.windings=null,r.consumedBy=i,r.leftSE.consumedBy=i.leftSE,r.rightSE.consumedBy=i.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var n=this.prev.consumedBy||this.prev;this._beforeState=n.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var n=this.beforeState();this._afterState={rings:n.rings.slice(0),windings:n.windings.slice(0),multiPolys:[]};for(var i=this._afterState.rings,r=this._afterState.windings,o=this._afterState.multiPolys,a=0,s=this.rings.length;a<s;a++){var u=this.rings[a],l=this.windings[a],c=i.indexOf(u);c===-1?(i.push(u),r.push(l)):r[c]+=l}for(var h=[],p=[],d=0,O=i.length;d<O;d++)if(r[d]!==0){var g=i[d],b=g.poly;if(p.indexOf(b)===-1)if(g.isExterior)h.push(b);else{p.indexOf(b)===-1&&p.push(b);var _=h.indexOf(g.poly);_!==-1&&h.splice(_,1)}}for(var f=0,v=h.length;f<v;f++){var y=h[f].multiPoly;o.indexOf(y)===-1&&o.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var n=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(K.type){case"union":{var r=n.length===0,o=i.length===0;this._isInResult=r!==o;break}case"intersection":{var a,s;n.length<i.length?(a=n.length,s=i.length):(a=i.length,s=n.length),this._isInResult=s===K.numMultiPolys&&a<s;break}case"xor":{var u=Math.abs(n.length-i.length);this._isInResult=u%2===1;break}case"difference":{var l=function(h){return h.length===1&&h[0].isSubject};this._isInResult=l(n)!==l(i);break}default:throw new Error("Unrecognized operation type found ".concat(K.type))}return this._isInResult}}],[{key:"fromRing",value:function(n,i,r){var o,a,s,u=ee.comparePoints(n,i);if(u<0)o=n,a=i,s=1;else if(u>0)o=i,a=n,s=-1;else throw new Error("Tried to create degenerate segment at [".concat(n.x,", ").concat(n.y,"]"));var l=new ee(o,!0),c=new ee(a,!1);return new t(l,c,[r],[s])}}]),t}(),_r=function(){function t(e,n,i){if(Q(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=Te.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var o=r,a=1,s=e.length;a<s;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var u=Te.round(e[a][0],e[a][1]);u.x===o.x&&u.y===o.y||(this.segments.push(Je.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(r.x!==o.x||r.y!==o.y)&&this.segments.push(Je.fromRing(o,r,this))}return z(t,[{key:"getSweepEvents",value:function(){for(var n=[],i=0,r=this.segments.length;i<r;i++){var o=this.segments[i];n.push(o.leftSE),n.push(o.rightSE)}return n}}]),t}(),cs=function(){function t(e,n){if(Q(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new _r(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,r=e.length;i<r;i++){var o=new _r(e[i],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return z(t,[{key:"getSweepEvents",value:function(){for(var n=this.exteriorRing.getSweepEvents(),i=0,r=this.interiorRings.length;i<r;i++)for(var o=this.interiorRings[i].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),Sr=function(){function t(e,n){if(Q(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,r=e.length;i<r;i++){var o=new cs(e[i],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return z(t,[{key:"getSweepEvents",value:function(){for(var n=[],i=0,r=this.polys.length;i<r;i++)for(var o=this.polys[i].getSweepEvents(),a=0,s=o.length;a<s;a++)n.push(o[a]);return n}}]),t}(),fs=function(){z(t,null,[{key:"factory",value:function(n){for(var i=[],r=0,o=n.length;r<o;r++){var a=n[r];if(!(!a.isInResult()||a.ringOut)){for(var s=null,u=a.leftSE,l=a.rightSE,c=[u],h=u.point,p=[];s=u,u=l,c.push(u),u.point!==h;)for(;;){var d=u.getAvailableLinkedEvents();if(d.length===0){var O=c[0].point,g=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(O.x,",")+" ".concat(O.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(d.length===1){l=d[0].otherSE;break}for(var b=null,_=0,f=p.length;_<f;_++)if(p[_].point===u.point){b=_;break}if(b!==null){var v=p.splice(b)[0],y=c.splice(v.index);y.unshift(y[0].otherSE),i.push(new t(y.reverse()));continue}p.push({index:c.length,point:u.point});var m=u.getLeftmostComparator(s);l=d.sort(m)[0].otherSE;break}i.push(new t(c))}}return i}}]);function t(e){Q(this,t),this.events=e;for(var n=0,i=e.length;n<i;n++)e[n].segment.ringOut=this;this.poly=null}return z(t,[{key:"getGeom",value:function(){for(var n=this.events[0].point,i=[n],r=1,o=this.events.length-1;r<o;r++){var a=this.events[r].point,s=this.events[r+1].point;wr(a,n,s)!==0&&(i.push(a),n=a)}if(i.length===1)return null;var u=i[0],l=i[1];wr(u,n,l)===0&&i.shift(),i.push(i[0]);for(var c=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:i.length-1,p=this.isExteriorRing()?i.length:-1,d=[],O=h;O!=p;O+=c)d.push([i[O].x,i[O].y]);return d}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var n=this.enclosingRing();this._isExteriorRing=n?!n.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var n=this.events[0],i=1,r=this.events.length;i<r;i++){var o=this.events[i];ee.compare(n,o)>0&&(n=o)}for(var a=n.segment.prevInResult(),s=a?a.prevInResult():null;;){if(!a)return null;if(!s)return a.ringOut;if(s.ringOut!==a.ringOut)return s.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=s.prevInResult(),s=a?a.prevInResult():null}}}]),t}(),kr=function(){function t(e){Q(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return z(t,[{key:"addInterior",value:function(n){this.interiorRings.push(n),n.poly=this}},{key:"getGeom",value:function(){var n=[this.exteriorRing.getGeom()];if(n[0]===null)return null;for(var i=0,r=this.interiorRings.length;i<r;i++){var o=this.interiorRings[i].getGeom();o!==null&&n.push(o)}return n}}]),t}(),hs=function(){function t(e){Q(this,t),this.rings=e,this.polys=this._composePolys(e)}return z(t,[{key:"getGeom",value:function(){for(var n=[],i=0,r=this.polys.length;i<r;i++){var o=this.polys[i].getGeom();o!==null&&n.push(o)}return n}},{key:"_composePolys",value:function(n){for(var i=[],r=0,o=n.length;r<o;r++){var a=n[r];if(!a.poly)if(a.isExteriorRing())i.push(new kr(a));else{var s=a.enclosingRing();s.poly||i.push(new kr(s)),s.poly.addInterior(a)}}return i}}]),t}(),vs=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Je.compare;Q(this,t),this.queue=e,this.tree=new Qn(n),this.segments=[]}return z(t,[{key:"process",value:function(n){var i=n.segment,r=[];if(n.consumedBy)return n.isLeft?this.queue.remove(n.otherSE):this.tree.remove(i),r;var o=n.isLeft?this.tree.insert(i):this.tree.find(i);if(!o)throw new Error("Unable to find segment #".concat(i.id," ")+"[".concat(i.leftSE.point.x,", ").concat(i.leftSE.point.y,"] -> ")+"[".concat(i.rightSE.point.x,", ").concat(i.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,s=o,u=void 0,l=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;l===void 0;)s=this.tree.next(s),s===null?l=null:s.key.consumedBy===void 0&&(l=s.key);if(n.isLeft){var c=null;if(u){var h=u.getIntersection(i);if(h!==null&&(i.isAnEndpoint(h)||(c=h),!u.isAnEndpoint(h)))for(var p=this._splitSafely(u,h),d=0,O=p.length;d<O;d++)r.push(p[d])}var g=null;if(l){var b=l.getIntersection(i);if(b!==null&&(i.isAnEndpoint(b)||(g=b),!l.isAnEndpoint(b)))for(var _=this._splitSafely(l,b),f=0,v=_.length;f<v;f++)r.push(_[f])}if(c!==null||g!==null){var y=null;if(c===null)y=g;else if(g===null)y=c;else{var m=ee.comparePoints(c,g);y=m<=0?c:g}this.queue.remove(i.rightSE),r.push(i.rightSE);for(var P=i.split(y),w=0,S=P.length;w<S;w++)r.push(P[w])}r.length>0?(this.tree.remove(i),r.push(n)):(this.segments.push(i),i.prev=u)}else{if(u&&l){var k=u.getIntersection(l);if(k!==null){if(!u.isAnEndpoint(k))for(var L=this._splitSafely(u,k),M=0,B=L.length;M<B;M++)r.push(L[M]);if(!l.isAnEndpoint(k))for(var R=this._splitSafely(l,k),N=0,re=R.length;N<re;N++)r.push(R[N])}}this.tree.remove(i)}return r}},{key:"_splitSafely",value:function(n,i){this.tree.remove(n);var r=n.rightSE;this.queue.remove(r);var o=n.split(i);return o.push(r),n.consumedBy===void 0&&this.tree.insert(n),o}}]),t}(),Lr=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ps=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ys=function(){function t(){Q(this,t)}return z(t,[{key:"run",value:function(n,i,r){K.type=n,Te.reset();for(var o=[new Sr(i,!0)],a=0,s=r.length;a<s;a++)o.push(new Sr(r[a],!1));if(K.numMultiPolys=o.length,K.type==="difference")for(var u=o[0],l=1;l<o.length;)Ct(o[l].bbox,u.bbox)!==null?l++:o.splice(l,1);if(K.type==="intersection"){for(var c=0,h=o.length;c<h;c++)for(var p=o[c],d=c+1,O=o.length;d<O;d++)if(Ct(p.bbox,o[d].bbox)===null)return[]}for(var g=new Qn(ee.compare),b=0,_=o.length;b<_;b++)for(var f=o[b].getSweepEvents(),v=0,y=f.length;v<y;v++)if(g.insert(f[v]),g.size>Lr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var m=new vs(g),P=g.size,w=g.pop();w;){var S=w.key;if(g.size===P){var k=S.segment;throw new Error("Unable to pop() ".concat(S.isLeft?"left":"right"," SweepEvent ")+"[".concat(S.point.x,", ").concat(S.point.y,"] from segment #").concat(k.id," ")+"[".concat(k.leftSE.point.x,", ").concat(k.leftSE.point.y,"] -> ")+"[".concat(k.rightSE.point.x,", ").concat(k.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(g.size>Lr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(m.segments.length>ps)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var L=m.process(S),M=0,B=L.length;M<B;M++){var R=L[M];R.consumedBy===void 0&&g.insert(R)}P=g.size,w=g.pop()}Te.reset();var N=fs.factory(m.segments),re=new hs(N);return re.getGeom()}}]),t}(),K=new ys,ds=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return K.run("union",e,i)},gs=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return K.run("intersection",e,i)},ms=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return K.run("xor",e,i)},bs=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return K.run("difference",e,i)},Ni={union:ds,intersection:gs,xor:ms,difference:bs};function Os(t,e){var n=H(t),i=H(e),r=t.properties||{},o=Ni.difference(n.coordinates,i.coordinates);return o.length===0?null:o.length===1?ve(o[0],r):Ge(o,r)}function Gi(t,e,n){n===void 0&&(n={});var i=H(t),r=H(e),o=Ni.union(i.coordinates,r.coordinates);return o.length===0?null:o.length===1?ve(o[0],n.properties):Ge(o,n.properties)}var C={getLineCenter:function(e,n){e instanceof BMapGL.Point&&n instanceof BMapGL.Point&&(e=T([e.lng,e.lat]),n=T([n.lng,n.lat]));var i=ra(e,n),r=new BMapGL.Point(i.geometry.coordinates[0],i.geometry.coordinates[1]);return{geoCenter:i,bdCenter:r}},getDistance:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers";e instanceof BMapGL.Point&&n instanceof BMapGL.Point&&(e=T([e.lng,e.lat]),n=T([n.lng,n.lat]));var r={units:i};return q(e,n,r)},getLength:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"kilometers";return ma(e,{units:n})},getPolygonCenter:function(e){var n=ia(e),i=new BMapGL.Point(n.geometry.coordinates[0],n.geometry.coordinates[1]);return{geoCenter:n,bdCenter:i}},getPolygonArea:function(e){return e instanceof BMapGL.Polygon&&(e=e.toGeoJSON()),da(e)/1e6},unionPolygon:function(e){for(var n=e[0],i=0,r=e.length;i<r;i++)n=Gi(n,e[i]);return n},isDisjoint:function(e,n){return!qn(e,n)},intersect:function(e,n){var i=[];if(n.__proto__ instanceof BMapGL.Overlay)if(n.toGeoJSON)n=n.toGeoJSON();else return i;return e.forEach(function(r){var o=r;if(r.__proto__ instanceof BMapGL.Overlay)if(r.toGeoJSON)o=r.toGeoJSON();else return!0;var a=C.isDisjoint(o,n);a&&i.push(r)}),i},isContains:function(e,n){return Wa(e,n)},isPointOnLine:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreEndVertices:!1};return e instanceof BMapGL.Point&&(e=e.toGeoJSON()),n instanceof BMapGL.Polyline&&(n=n.toGeoJSON()),_e(e,n,i)},isPointInPolygon:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{ignoreBoundary:!0};return e instanceof BMapGL.Point&&(e=e.toGeoJSON()),n instanceof BMapGL.Polygon&&(n=n.toGeoJSON()),ne(e,n,i)},getDistance2Lines:function(e,n){var i=T([e.lng,e.lat]),r=D(n);return pa(i,r)},getNearestPointOnLine:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"kilometers",r=T([e.lng,e.lat]),o=[];n.geometry.type==="Polygon"?o=n.geometry.coordinates[0]:n.geometry.type==="LineString"&&(o=n.geometry.coordinates);var a=D(o),s=xi(a,r,i),u=new BMapGL.Point(s.geometry.coordinates[0],s.geometry.coordinates[1]),l=q(r,s);return{geoPoint:r,geoNearestPoint:s,toLineDistance:l,bdNearestPoint:u}}};function Ft(t){return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(t)}function ws(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ps(t,e,n){return e&&Mr(t.prototype,e),n&&Mr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Es(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zt(t,e)}function zt(t,e){return zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},zt(t,e)}function _s(t){var e=Ls();return function(){var i=Ue(t),r;if(e){var o=Ue(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Ss(this,r)}}function Ss(t,e){if(e&&(Ft(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ks(t)}function ks(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ls(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ue(t){return Ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ue(t)}var Ms=function(t){Es(n,t);var e=_s(n);function n(i){var r;return ws(this,n),r=e.call(this),r.point=void 0,r.overlay=void 0,r.map=i,r}return Ps(n,[{key:"confirmOperate",value:function(){var r=this.overlay.toString();r==="Polyline"||r==="Polygon"?this.overlay.disableEditing():r==="Marker"&&this.overlay.disableDragging(),this.dispatchEvent(new A("ok",this.overlay))}},{key:"cancelOperate",value:function(){this.dispatchEvent(new A("cancel",this.overlay))}},{key:"setPosition",value:function(r,o){this.point=r;var a=this.map,s=a.pointToOverlayPixel(this.point);o?(this.div.classList.remove("operateLeft"),this.div.style.left=s.x+15+"px"):(this.div.classList.add("operateLeft"),this.div.style.left=s.x-105+"px"),this.div.style.top=s.y-16+"px"}},{key:"draw",value:function(){var r=this.map,o=r.pointToOverlayPixel(this.point);this.div.style.left=o.x+15+"px",this.div.style.top=o.y-16+"px"}},{key:"calculateOverlay",value:function(){var r={data:0},o=this.overlay.toString();switch(o){case"Polyline":r.data=C.getLength(this.overlay.toGeoJSON())*1e3;break;case"Polygon":r.data=C.getPolygonArea(this.overlay)*1e6;break;case"Circle":var a=this.overlay.getRadius();r.data=Math.PI*a*a;break}return!r.data||r.data<0?r.data=0:r.data=r.data.toFixed(2),r}}]),n}(Fn(BMapGL.Overlay,Y));function Wt(t){return Wt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt(t)}function xs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Rs(t,e,n){return e&&xr(t.prototype,e),n&&xr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function As(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yt(t,e)}function Yt(t,e){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Yt(t,e)}function Bs(t){var e=Ns();return function(){var i=qe(t),r;if(e){var o=qe(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Is(this,r)}}function Is(t,e){if(e&&(Wt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ts(t)}function Ts(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ns(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function qe(t){return qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},qe(t)}var Ce=function(t){As(n,t);var e=Bs(n);function n(i,r){var o;return xs(this,n),o=e.call(this,i),o.limit=void 0,o.element=r,o}return Rs(n,[{key:"setData",value:function(r){for(var o in r)r.hasOwnProperty(o)&&(this[o]=r[o]);this.type=this.overlay.toString(),this.type==="Marker"?(this.overlayTypeText="可以拖动图标改变位置",this.unit=this.type==="Polyline"?"万米":"万平方米"):this.type==="Polyline"?this.overlayTypeText="长度不超过"+(this.limit||1e10)/1e4+"万米！":this.overlayTypeText="面积不超过"+(this.limit||1e10)/1e4+"万平方米！"}},{key:"initialize",value:function(r){var o;if(this.element)o=this.div=this.element,o.className="operateWindow";else{o=this.div=document.createElement("div"),o.className="operateWindow";var a=`<div class="containerbox">
                <span id="confirmOperate"></span>
                <span id="cancelOperate"></span>
                <span id="warnOperate">`.concat(this.overlayTypeText,`</span>
                </div>`);o.innerHTML=a}return r.getPanes().markerPane.appendChild(this.div),this.bind(),this.updateWindow(),o}},{key:"bind",value:function(){var r=this;if(!this.element)document.getElementById("confirmOperate").addEventListener("click",function(o){var a=r.calculateOverlay();r.overlay.geometryCalculate=a,r.confirmOperate()}),document.getElementById("cancelOperate").addEventListener("click",function(o){r.cancelOperate()});else throw console.log("自定义operate必须重写bind方法"),{errMsg:"自定义operate必须重写bind方法"}}},{key:"updateWindow",value:function(){if(this.element)throw console.log("自定义operate必须重写updateWindow方法"),{errMsg:"自定义operate必须重写updateWindow方法"};var r=this.limit||1e7,o=this.calculateOverlay();if(!document.getElementById("confirmOperate"))return;o.data>~~r?(document.getElementById("confirmOperate").style.display="none",document.getElementById("warnOperate").style.display="block"):(document.getElementById("confirmOperate").style.display="block",document.getElementById("warnOperate").style.display="none")}}]),n}(Ms);function Xt(t){return Xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xt(t)}function Gs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ds(t,e,n){return e&&Rr(t.prototype,e),n&&Rr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function $s(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Jt(t,e)}function Jt(t,e){return Jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Jt(t,e)}function Cs(t){var e=zs();return function(){var i=He(t),r;if(e){var o=He(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return js(this,r)}}function js(t,e){if(e&&(Xt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fs(t)}function Fs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function He(t){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},He(t)}var Ar=function(t){$s(n,t);var e=Cs(n);function n(i,r){var o;return Gs(this,n),o=e.call(this),o._enableEdgeMove=!1,o.cursor="crosshair",o.container=void 0,o.map=i,r&&(o.cursor=r),o}return Ds(n,[{key:"initialize",value:function(r){var o=this;this.dispose();var a=r.getSize(),s=this.container=document.createElement("div");return s.style.cssText=`position:absolute;background:transparent;
            cursor:`.concat(this.cursor,";width:").concat(a.width,"px;height:").concat(a.height,"px"),r.addEventListener("resize",function(u){o.adjustSize(u.size)}),r.getPanes().floatPane.appendChild(s),this.bindEvent(),s}},{key:"draw",value:function(){var r=this.map.pixelToPoint(new BMapGL.Pixel(0,0)),o=this.map.pointToOverlayPixel(r);this.container.style.left=o.x+"px",this.container.style.top=o.y+"px"}},{key:"setCursor",value:function(r){this.cursor=r,this.container&&(this.container.style.cursor=r)}},{key:"adjustSize",value:function(r){this.container.style.width=r.width+"px",this.container.style.height=r.height+"px"}},{key:"bindEvent",value:function(){for(var r=this,o=null,a=null,s=function(p){return{x:p.clientX,y:p.clientY}},u=function(p){var d=p.type,O=r.getDrawLatlngPoint(p),g=function(f){p.point=O,r.dispatchEvent(p)};d==="mousedown"&&(o=s(p));var b=s(p);d==="click"?Math.abs(b.x-o.x)<5&&Math.abs(b.y-o.y)<5&&(!a||!(Math.abs(b.x-a.x)<5&&Math.abs(b.y-a.y)<5)?(g(),a=s(p)):a=null):g()},l=["click","mousedown","mousemove","mouseup","dblclick","rightclick"],c=l.length;c--;)E.on(this.container,l[c],u,this._listeners);E.on(this.container,"mousemove",function(h){r._enableEdgeMove&&r.mousemoveAction(h)},this._listeners)}},{key:"mousemoveAction",value:function(r){var o=this;function a(h){var p=h.clientX,d=h.clientY;return h.changedTouches&&(p=h.changedTouches[0].clientX,d=h.changedTouches[0].clientY),new BMapGL.Pixel(p,d)}var s=this.map.pointToPixel(this.getDrawLatlngPoint(r)),u=a(r),l=u.x-s.x,c=u.y-s.y;s=new BMapGL.Pixel(u.x-l,u.y-c),this.draggingMovePixel=s,this.panByX=this.panByY=0,s.x<=20||s.x>=this.map.width-20||s.y<=50||s.y>=this.map.height-10?(s.x<=20?this.panByX=8:s.x>=this.map.width-20&&(this.panByX=-8),s.y<=50?this.panByY=8:s.y>=this.map.height-10&&(this.panByY=-8),this.edgeMoveTimer||(this.edgeMoveTimer=setInterval(function(){o.map.panBy(o.panByX,o.panByY,{noAnimation:!0})},30))):this.edgeMoveTimer&&(clearInterval(this.edgeMoveTimer),this.edgeMoveTimer=null)}},{key:"getDrawLatlngPoint",value:function(r){var o=E.getTarget(r),a=r.offsetX||r.layerX||0,s=r.offsetY||r.layerY||0;for(o.nodeType!==1&&(o=o.parentNode);o&&o!==this.map.getContainer();)o.clientWidth===0&&o.clientHeight===0&&o.offsetParent&&o.offsetParent.nodeName==="TD"||(a+=o.offsetLeft||0,s+=o.offsetTop||0),o=o.offsetParent;var u=new BMapGL.Pixel(a,s),l=this.map.pixelToPoint(u);return l}},{key:"enableEdgeMove",value:function(){this._enableEdgeMove=!0}},{key:"disableEdgeMove",value:function(){clearInterval(this.edgeMoveTimer),this._enableEdgeMove=!1}}]),n}(Fn(BMapGL.Overlay,Y));function Ut(t){return Ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ut(t)}function Ws(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ys(t,e,n){return e&&Br(t.prototype,e),n&&Br(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xs(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qt(t,e)}function qt(t,e){return qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},qt(t,e)}function Js(t){var e=Hs();return function(){var i=Qe(t),r;if(e){var o=Qe(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Us(this,r)}}function Us(t,e){if(e&&(Ut(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qs(t)}function qs(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hs(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Qe(t){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Qe(t)}var Vn=function(t){Xs(n,t);var e=Js(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ws(this,n),r=e.call(this),r.isOpen=void 0,r.drawType=void 0,r.instances=[],r.selectInstance=[],r.mask=void 0,r.map=void 0,r.operate=void 0,r._currentStatus=G.STATUS_FREE,r._runningAction=null,!(i instanceof BMapGL.Map))throw Error("Scene实例化必须输入map参数");return r.options={},E.deepCopy(ho,2,r.options,0,[Ce]),E.copyOptions(r.options,o,[Ce]),r.map=i,r.mask=new Ar(i,r.options.drawCursor),r.operate=r.options.operate||new Ce(i),r.options.operate&&(r.options.operate.ignore=!0),r.addMapListener(i),r}return Ys(n,[{key:"currentStatus",get:function(){return this._currentStatus},set:function(r){this._currentStatus=r,this.updateMapListenerControl(r)}},{key:"runningAction",get:function(){return this._runningAction},set:function(r){this._runningAction=r}},{key:"addMapListener",value:function(r){var o=this;this.mapSelect=new pi(r),this.mapSelect.addEventListener(x.CLICK,function(a){o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)}),this.mapSelect.addEventListener(x.RIGHTCLICK,function(a){o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)}),this.mapSelect.addEventListener(x.MOVE,function(a){o._currentStatus!==G.STATUS_DRAWING&&o._currentStatus!==G.STATUS_EDITER&&o._currentStatus!==G.STATUS_MOVE&&o.dispatchEvent(a)})}},{key:"updateMapListenerControl",value:function(r){if(this.mapSelect)switch(r){case G.STATUS_FREE:this.mapSelect.open();break;case G.STATUS_EDITER:this.mapSelect.openClick(),this.mapSelect.openMouse();break;case G.STATUS_DRAWING:this.mapSelect.closeClick(),this.mapSelect.openMouse();break;case G.STATUS_MOVE:this.mapSelect.closeClick(),this.mapSelect.openMouse();break;default:this.mapSelect.open();break}}},{key:"open",value:function(){return this.isOpen=!0,this.mask||(this.mask=new Ar(this.map,this.options.drawCursor)),this.map.addOverlay(this.mask),this.setCurrentDrawType(this.drawType),!0}},{key:"close",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isOpen=!1,this.closeRunningAction(),r&&(this.currentStatus=G.STATUS_FREE),this.mask&&this.map.removeOverlay(this.mask)}},{key:"closeRunningAction",value:function(){this.runningAction&&this.runningAction.close instanceof Function&&this.runningAction.close()}},{key:"addOverlay",value:function(r){var o=this.instances.find(function(a){return a===r});o||this.instances.push(r)}},{key:"removeOverlay",value:function(r){var o=this.instances.findIndex(function(a){return a===r});o!==-1&&(this.map.removeOverlay(this.instances[o]),this.instances.splice(o))}},{key:"clearData",value:function(){var r=this;this.instances.forEach(function(o){r.map.removeOverlay(o)}),this.instances.length=0}},{key:"addSelectDrawData",value:function(r){var o=this.selectInstance.find(function(a){return a===r});o||this.selectInstance.push(r)}},{key:"hasOverlay",value:function(r){var o=this.instances.findIndex(function(a){return a===r});return o>-1||(o=this.selectInstance.findIndex(function(a){return a===r}),o>-1)}},{key:"clearSelectDrawData",value:function(){var r=this;this.selectInstance.forEach(function(o){r.map.removeOverlay(o)}),this.selectInstance.length=0}},{key:"setCurrentDrawType",value:function(r){this.drawType=r}},{key:"attachSnapSource",value:function(r){this._attachSnapSource=r}},{key:"setDrawCursor",value:function(r){this.mask&&this.mask.setCursor(r)}}]),n}(Y);function Ht(t){return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ht(t)}function Ir(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Qs(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw s}}}}function Qs(t,e){if(t){if(typeof t=="string")return Tr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tr(t,e)}}function Tr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var le=function(e,n,i,r){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],a=Vs(r.getZoom());i=i*a;var s=Ir(n),u;try{var l=function(){var p=u.value;if(o.find(function(k){return p===k}))return"continue";if(p instanceof BMapGL.Marker){var d=p.getPosition(),O=C.getDistance(e,d,"kilometers")*1e3;return O<i?{v:d}:"continue"}if(p.toGeoJSON){for(var g=p.getPath(),b=[],_=p.toGeoJSON(),f=0;f<g.length-1;f++)b.push(C.getLineCenter(g[f],g[f+1]).bdCenter);var v=Ir(g.concat(b)),y;try{for(v.s();!(y=v.n()).done;){var m=y.value,P=C.getDistance(e,m,"kilometers")*1e3;if(P<i)return{v:m}}}catch(k){v.e(k)}finally{v.f()}var w=C.getNearestPointOnLine(e,_),S=w.toLineDistance*1e3;if(S<i)return{v:w.bdNearestPoint}}};for(s.s();!(u=s.n()).done;){var c=l();if(c!=="continue"&&Ht(c)==="object")return c.v}}catch(h){s.e(h)}finally{s.f()}return null};function Vs(t){return Math.pow(2,18-t)}function Qt(t){return Qt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(t)}function Ks(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zs(t,e,n){return e&&Nr(t.prototype,e),n&&Nr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function eu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vt(t,e)}function Vt(t,e){return Vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Vt(t,e)}function tu(t){var e=ru();return function(){var i=Ve(t),r;if(e){var o=Ve(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Di(this,r)}}function Di(t,e){if(e&&(Qt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nu(t)}function nu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ru(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ve(t){return Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ve(t)}var ie=function(t){eu(n,t);var e=tu(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ks(this,n),r=e.call(this),r.type=void 0,r.isOpen=void 0,r.isOnMap=!0,r.isSeries=!0,r.skipEditing=!1,r.isSelectDraw=!1,r.enableCalculate=!1,r.enableSnap=!0,r.snapDistance=10,r.enableDragging=!1,r.mouseLnglat=void 0,r.match=null,r.matchOverlay=null,r.matchOverlayRadius=5,!i)return Di(r);if(!(i instanceof Vn))throw Error("DrawBase实例化必须输入scene参数");r.scene=i;var a={};return E.copyOptionsToNew(r.scene.options,o,a),E.copyNotExitOptions(a,r.scene.options),r.defineProperty(a),r.options=a,r.setSnapPointType(r.options),r.setBaseOptions(r.options.baseOpts),r}return Zs(n,[{key:"bindEvent",value:function(){}},{key:"setBaseOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.baseOptions=r}},{key:"setCurrentStatus",value:function(r){this.scene.currentStatus=r}},{key:"skipEdit",value:function(r){r||this.skipEditing?this.scene.operate.confirmOperate():this.scene.mask.hide()}},{key:"emitEventIsonmap",value:function(r){var o=U.DRAW_ON_MAP;this.isSelectDraw&&(o=U.SELECT_ON_MAP);var a=new A(x.COMPLETE,{overlay:r,from:o});this.dispatchEvent(a),this.scene.dispatchEvent(a)}},{key:"emitEventIsnomap",value:function(r){this.scene.currentStatus=G.STATUS_FREE;var o=U.DRAW_NO_MAP;this.isSelectDraw&&(o=U.SELECT_NO_MAP);var a=new A(x.COMPLETE,{overlay:r,from:o});this.dispatchEvent(a),this.scene.dispatchEvent(a)}},{key:"registEvent",value:function(r){var o=this;r.addEventListener(x.INIT,function(a){o.skipEdit()}),r.addEventListener(x.COMPLETE,function(a){o.isSelectDraw?o.scene.addSelectDrawData(a.target.overlay):o.scene.addOverlay(a.target.overlay),a.continue!==!1&&o.isSeries&&(o.isOpen=!0,o.scene.mask.show(),o.bindEvent()),o.dispatchEvent(a),o.editOpe=null}),r.addEventListener(x.CANCEL,function(a){o.isSeries&&(o.isOpen=!0,o.scene.mask.show(),o.bindEvent()),o.dispatchEvent(a),o.editOpe=null})}},{key:"setRunningAction",value:function(r,o){if(r){if(this.isSeries&&this.scene.runningAction===this){o();return}this.scene.closeRunningAction(),this.scene.mask.show(),this.scene.runningAction=this,o(),this.callback&&this.callback()}else this.scene.runningAction=null,this.isOpen=!1,this.scene.mask.hide()}},{key:"closeEdit",value:function(){this.editOpe&&this.editOpe.close()}},{key:"closeAll",value:function(){this.close(),this.closeEdit()}},{key:"open",value:function(r){this.scene&&(this.callback=r,this.scene.drawType=this.type,this.scene.open(),this.isOpen=!0,this.bindEvent())}},{key:"close",value:function(r){r&&r()}},{key:"addLabel",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=new BMapGL.Label(r,{position:o.position,offset:o.offset||new BMapGL.Size(0,0)});return a.setStyle(o.labelOptions),a}},{key:"setRadius",value:function(){var r=this.scene.map.getZoomUnits(),o=this.matchOverlayRadius*r;this.matchOverlay.setRadius(o)}},{key:"addMatchOverlay",value:function(r){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(r),this.scene.map.addEventListener("zoomend",this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(r))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeEventListener("zoomend",this.setRadius.bind(this))}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=le(r,o,s,u)),!l&&this.scene._attachSnapSource&&(l=le(r,this.scene._attachSnapSource,s,u)),l||(l=le(r,a,s,u)),l&&this.addMatchOverlay(l),l}}]),n}(Y);function Kt(t){return Kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kt(t)}function iu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ou(t,e,n){return e&&Gr(t.prototype,e),n&&Gr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Re(){return typeof Reflect<"u"&&Reflect.get?Re=Reflect.get.bind():Re=function(e,n,i){var r=au(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Re.apply(this,arguments)}function au(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=pe(t),t!==null););return t}function su(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zt(t,e)}function Zt(t,e){return Zt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Zt(t,e)}function uu(t){var e=fu();return function(){var i=pe(t),r;if(e){var o=pe(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return lu(this,r)}}function lu(t,e){if(e&&(Kt(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cu(t)}function cu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function pe(t){return pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},pe(t)}var $i=function(t){su(n,t);var e=uu(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return iu(this,n),r=e.call(this,i,o),r.type=I.DRAWING_MARKER,r.scene.setCurrentDrawType(r.type),r.mouseMoveModel=o.mouseMove||!1,r.isOpen&&r.open(),r}return ou(n,[{key:"clickAction",value:function(r){var o=this;this.marker&&!this.isOnMap||(this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("click",this.click),this.marker=new BMapGL.Marker(r.point,this.baseOptions),this.scene.map.addOverlay(this.marker),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap?(this.isSeries?(this.scene.mask.show(),this.bindEvent()):this.setCurrentStatus(G.STATUS_FREE),this.scene.addOverlay(this.marker),this.emitEventIsonmap(this.marker),this.enableDragging&&(this.marker.enableDragging(),this.marker.addEventListener("dragstart",this.centerDragstart.bind(this)),this.marker.addEventListener("dragging",this.centerDragging.bind(this)),this.marker.addEventListener("dragend",this.centerDragend.bind(this)))):(setTimeout(function(){o.scene.map.removeOverlay(o.marker),o.marker=null},200),this.emitEventIsnomap(this.marker)))}},{key:"moveAction",value:function(r){var o=new A(x.MOVE,r);this.dispatchEvent(o)}},{key:"centerDragstart",value:function(r){if(this.enableSnap){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}}},{key:"centerDragging",value:function(r){if(this.enableSnap){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}}},{key:"centerDragend",value:function(r){this.emitEventIsonmap(this.marker)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Re(pe(n.prototype),"setRunningAction",this).call(this,!0,function(){r.setCurrentStatus(G.STATUS_DRAWING),r.mouseMoveModel&&r.scene.mask.addEventListener("mousemove",r.mousemove=r.moveAction.bind(r)),r.scene.mask.addEventListener("click",r.click=r.clickAction.bind(r))})}},{key:"close",value:function(r){Re(pe(n.prototype),"setRunningAction",this).call(this,!1),this.scene.mask.removeEventListener("click",this.click),this.mouseMoveModel&&this.scene.mask.addEventListener("mousemove",this.mousemove),r&&r()}}]),n}(ie);function en(t){return en=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},en(t)}function hu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Dr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vu(t,e,n){return e&&Dr(t.prototype,e),n&&Dr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function pu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tn(t,e)}function tn(t,e){return tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},tn(t,e)}function yu(t){var e=gu();return function(){var i=Ke(t),r;if(e){var o=Ke(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return du(this,r)}}function du(t,e){if(e&&(en(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ci(t)}function Ci(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ke(t){return Ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ke(t)}var gt=function(t){pu(n,t);var e=yu(n);function n(i,r){var o,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(hu(this,n),o=e.call(this),o.overlay=null,o.centerIcon=null,o.moveIcon=null,o.circleMoveIcon=null,!(i instanceof Vn))throw Error("EditBase实例化必须输入scene参数");o.scene=i;var s={};return E.copyOptionsToNew(o.scene.options,a,s),E.copyNotExitOptions(s,o.scene.options),o.target=r||Ci(o),o.setOptions(s),o}return vu(n,[{key:"setOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.defineProperty(r),this.target.__proto__ instanceof ie?this.baseOptions=this.target.baseOptions:this.baseOptions=r.baseOpts}},{key:"saveSouce",value:function(r){this.type===I.DRAWING_CIRCLE?this.source={center:r.getCenterIn().latLng,radius:r.getRadius()}:this.source=r.toGeoJSON()}},{key:"restoreSouce",value:function(r){this.source&&(this.type===I.DRAWING_CIRCLE?(r.setCenter(this.source.center),r.setRadius(this.source.radius)):r.updateByGeoJSON(this.source),this.restoreOpe(r))}},{key:"restoreOpe",value:function(){}},{key:"open",value:function(r,o,a){var s=this;this.scene&&(this.originStyle={icon:r._config.icon,fillColor:r._config.fillColor,fillOpacity:r._config.fillOpacity,strokeColor:r._config.strokeColor,strokeWeight:r._config.strokeWeight,strokeOpacity:r._config.strokeOpacity},this.overlay=r,this.overlay.setOptions(this.baseOptions),this.setRunningAction(!0,function(){s.setSceneStatus(G.STATUS_EDITER),s.edit(r,o),a&&a()}))}},{key:"emitOkEvent",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,s=U.DRAW_ON_MAP;this.target.__proto__ instanceof ie?this.target.isSelectDraw&&(s=U.SELECT_ON_MAP):s=U.EDIT_ON_MAP;var u=new A(x.COMPLETE,{overlay:r,from:s});u.continue=o,this.dispatchEvent(u),(a||this.type!==I.DRAWING_MARKER)&&this.scene.dispatchEvent(u)}},{key:"close",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,o=arguments.length>1?arguments[1]:void 0;this.overlay&&(this.overlay.setOptions(this.originStyle),this.setRunningAction(!1),this.setSceneStatus(G.STATUS_FREE),this.operateWindow&&(this.removeAttachOverlays(),this.scene.map.removeOverlay(this.operateWindow)),r||this.emitOkEvent(this.overlay,r),(this.type===I.DRAWING_POLYLINE||this.type===I.DRAWING_POLYGON)&&this.overlay.removeEventListener("lineupdate",this.lineUpdate),this.closeOpe(this.overlay),o&&o())}},{key:"setRunningAction",value:function(r,o){r?(this.scene.closeRunningAction(),this.scene.runningAction=this,o()):this.scene.runningAction=null}},{key:"closeOpe",value:function(r){}},{key:"addOperateWindow",value:function(r){var o=this,a=U.DRAW_ON_MAP;this.target.__proto__ instanceof ie?this.target.isSelectDraw&&(a=U.SELECT_ON_MAP):(this.saveSouce(r.overlay),a=U.EDIT_ON_MAP);var s=this.operateWindow=this.scene.operate||new Ce(this.scene.map);return s.setData(r),s.addEventListener("ok",function(u){o.removeAttachOverlays(),o.close(!0),o.emitOkEvent(u.target),s._listeners={}}),s.addEventListener("cancel",function(u){o.removeAttachOverlays(),o.close(!0),o.target.__proto__ instanceof ie?o.scene.map.removeOverlay(r.overlay):o.restoreSouce(r.overlay),a+="-cancel";var l=new A(x.CANCEL,{overlay:u.target,from:a});o.dispatchEvent(l),o.scene.dispatchEvent(l),s._listeners={}}),this.scene.map.addOverlay(s),s}},{key:"removeAttachOverlays",value:function(){for(var r=this.scene.map,o=this.overlays,a=0;a<o.length;a++)if(Array.isArray(o[a]))for(var s in o[a])r.removeOverlay(o[a][s]);else r.removeOverlay(o[a])}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.target.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return l||(l=le(r,o,s,u)),l||(l=le(r,a,s,u)),l}}]),n}(Y);function nn(t){return nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nn(t)}function ji(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Fi(t,e,n){return e&&$r(t.prototype,e),n&&$r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function zi(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rn(t,e)}function rn(t,e){return rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},rn(t,e)}function Wi(t){var e=Ou();return function(){var i=Ze(t),r;if(e){var o=Ze(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return mu(this,r)}}function mu(t,e){if(e&&(nn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bu(t)}function bu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ou(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ze(t){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ze(t)}var Yi=function(t){zi(n,t);var e=Wi(n);function n(i,r,o){var a;return ji(this,n),a=e.call(this,i,r,o),a.type=I.DRAWING_POLYLINE,a.scene.setCurrentDrawType(a.type),a}return Fi(n,[{key:"edit",value:function(r,o){var a=this;this.overlay=r;var s=!1;this instanceof n&&this.target.__proto__ instanceof ie&&(s=!0);var u={limit:o||null,point:this.getNorthEast(r.getPath()),overlay:r};this.overlays=[];var l=this.addOperateWindow(u);this.lineUpdate=function(c){var h=a.getNorthEast(c.currentTarget.getPath());l.setPosition(h,!0),l.updateWindow();var p=new A(x.CHANGE,c.currentTarget);a.target.dispatchEvent(p)},this.onlinevertexdragging=function(c){var h=c.overlay,p=BMapGL.Projection.convertMC2LL(h.getPoint()),d=null;s?d=a.getSnap(p,a.scene.instances,[a.overlay]):d=a.getSnap(p,a.scene.instances),d&&(c.from.point=BMapGL.Projection.convertLL2MC(d),h.setPoint(c.from.point))},r.enableEditing(),r.addEventListener("lineupdate",this.lineUpdate),r.addEventListener("onlinevertexdragging",this.onlinevertexdragging),this.dispatchEvent(new A(x.INIT))}},{key:"restoreOpe",value:function(r){r.disableEditing()}},{key:"closeOpe",value:function(r){r.disableEditing()}},{key:"getNorthEast",value:function(r){for(var o=0,a=0,s=0;s<r.length;s++)o<r[s].lng&&(o=r[s].lng,a=s);return r[a]}}]),n}(gt),wu=function(t){zi(n,t);var e=Wi(n);function n(i,r,o){var a;return ji(this,n),a=e.call(this,i,r,o),a.type=I.DRAWING_POLYGON,a.scene.setCurrentDrawType(a.type),a}return Fi(n)}(Yi);function on(t){return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(t)}function Xi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ji(t,e,n){return e&&Cr(t.prototype,e),n&&Cr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ae(){return typeof Reflect<"u"&&Reflect.get?Ae=Reflect.get.bind():Ae=function(e,n,i){var r=Pu(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Ae.apply(this,arguments)}function Pu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=ye(t),t!==null););return t}function Ui(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&an(t,e)}function an(t,e){return an=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},an(t,e)}function qi(t){var e=Su();return function(){var i=ye(t),r;if(e){var o=ye(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Eu(this,r)}}function Eu(t,e){if(e&&(on(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _u(t)}function _u(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Su(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ye(t){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ye(t)}var mt=function(t){Ui(n,t);var e=qi(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Xi(this,n),r=e.call(this,i,o),r.type=I.DRAWING_POLYLINE,r.points=[],r.drawPoint=[],r.overlay=null,r.isBinded=!1,r.tipLabel=null,r.measureRes=0,r.scene.setCurrentDrawType(r.type),r.options=o,r.isOpen&&r.open(),r}return Ji(n,[{key:"getNorthEast",value:function(r){for(var o=0,a=0,s=0;s<r.length;s++)o<r[s].lng&&(o=r[s].lng,a=s);return r[a]}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.scene.drawType===I.DRAWING_POLYLINE?this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions):this.scene.drawType===I.DRAWING_POLYGON&&(this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions)),this.scene.map.addOverlay(this.overlay)):this.overlay.setPath(this.drawPoint),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"moveAction",value:function(r){var o=r.point;if(this.enableSnap){var a=[];if(this.overlay.points.length>2){var s=this.overlay.getPath().slice(0,this.overlay.points.length-1),u=new this.overlay.constructor(s);a.push(u)}if(this.match=this.getSnap(o,this.scene.instances,a),this.match){this.overlay.setPositionAt(this.drawPoint.length-1,this.match);return}}this.match=null,this.overlay.setPositionAt(this.drawPoint.length-1,r.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击绘制下一个点，双击完成绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"mousemoveAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("单击确认起点",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"dblclickAction",value:function(r){if(E.preventDefault(r),E.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.limit&&(o=this.scene.drawingType==="polygon"?this.limit.area:this.limit.distance),this.type===I.DRAWING_POLYLINE?this.editOpe=new Yi(this.scene,this):this.editOpe=new wu(this.scene,this);var a=this.editOpe;this.registEvent(a),a.open(this.overlay,o)}else this.scene.map.removeOverlay(this.overlay),this.emitEventIsnomap(this.overlay)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Ae(ye(n.prototype),"setRunningAction",this).call(this,!0,function(){r.points.length=0,r.drawPoint.length=0,r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.startAction.bind(r))})}},{key:"close",value:function(r){this.isBinded=!1,this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),Ae(ye(n.prototype),"setRunningAction",this).call(this,!1),r&&r()}}]),n}(ie),Kn=function(t){Ui(n,t);var e=qi(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Xi(this,n),r=e.call(this,i,o),r.type=I.DRAWING_POLYGON,r.scene.setCurrentDrawType(r.type),r}return Ji(n)}(mt);function sn(t){return sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sn(t)}function ku(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Lu(t,e,n){return e&&jr(t.prototype,e),n&&jr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Mu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&un(t,e)}function un(t,e){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},un(t,e)}function xu(t){var e=Bu();return function(){var i=et(t),r;if(e){var o=et(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Ru(this,r)}}function Ru(t,e){if(e&&(sn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Au(t)}function Au(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},et(t)}var Hi=function(t){Mu(n,t);var e=xu(n);function n(i,r,o,a,s){var u;return ku(this,n),u=e.call(this),u.scene=s,u.type=i,u.point=r,u.number=o,u.overlay=a,u}return Lu(n,[{key:"initialize",value:function(r){this.map=r;var o=this.div=document.createElement("div");o.className="screenshot";var a;return this.type==="circle"?a=`
                <div class="circlShot">
                <span id="screenshotNum">`.concat(this.number,`</span>
                <input id="circleInput" type="text" />
                <span class="unit">米</span>
                </div>
            `):this.type==="rectangle"&&(a=`
                <div class="rectWH">
                <div class="wh">
                    <span id="rectWidth">`.concat(this.number.width,`</span>
                    <input id="rectWidthInput" type="text" />
                </div>
                <span class="multiple">x</span>
                <div class="wh">
                    <span id="rectHeight">`).concat(this.number.height,`</span>
                    <input id="rectHeightInput" type="text" />
                </div>
                <span class="unit">米</span>
                </div>
            `)),o.innerHTML=a,o.addEventListener("mousemove",function(s){E.preventDefault(s),E.stopBubble(s)}),o.addEventListener("dblclick",function(s){E.preventDefault(s),E.stopBubble(s)}),this.map.getPanes().markerPane.appendChild(o),this.bind(),o}},{key:"bind",value:function(){this.setNumber(this.number),this.type==="circle"?this.bindCircleEvent():this.bindRectEvent()}},{key:"bindCircleEvent",value:function(){var r=this,o=document.getElementById("screenshotNum"),a=document.getElementById("circleInput");o.addEventListener("click",function(s){var u=o.innerText;o.style.display="none",a.value=u,a.style.display="inline-block",a.focus()}),a.addEventListener("click",function(s){a.focus()}),a.addEventListener("keydown",function(s){if(s.keyCode===13){var u=a.value;a.style.display="none",o.innerText=u;var l={radius:u,overlay:r.overlay};r.dispatchRadiusChange(l)}}),a.addEventListener("blur",function(s){var u=a.value;a.style.display="none",o.style.display="inline-block",o.innerText=u;var l={radius:u,overlay:r.overlay};r.dispatchRadiusChange(l)})}},{key:"bindRectEvent",value:function(){var r=this,o=document.getElementById("rectWidth"),a=document.getElementById("rectWidthInput"),s=document.getElementById("rectHeight"),u=document.getElementById("rectHeightInput");a.value=o.innerText,u.value=s.innerText,o.addEventListener("click",function(l){var c=o.innerText;o.style.display="none",a.value=c,a.style.display="inline-block",a.focus()}),s.addEventListener("click",function(l){var c=s.innerText;s.style.display="none",u.value=c,u.style.display="inline-block",u.focus()}),a.addEventListener("click",function(l){a.focus()}),u.addEventListener("click",function(l){u.focus()}),a.addEventListener("keydown",function(l){if(l.keyCode===13){var c=a.value,h=u.value;u.style.display="none",u.style.display="none",o.style.display="inline-block",u.style.display="inline-block",o.innerText=c,s.innerText=h;var p={width:c,height:h,overlay:r.overlay};r.dispatchRectWHChange(p)}}),u.addEventListener("keydown",function(l){if(l.keyCode===13){var c=a.value,h=u.value;a.style.display="none",u.style.display="none",o.style.display="inline-block",s.style.display="inline-block",o.innerText=c,s.innerText=h;var p={width:c,height:h,overlay:r.overlay};r.dispatchRectWHChange(p)}})}},{key:"setInfo",value:function(r,o){this.setNumber(o),this.setPosition(r)}},{key:"setNumber",value:function(r){this.type==="circle"?document.getElementById("screenshotNum").textContent=r:(document.getElementById("rectWidth").textContent=r.width,document.getElementById("rectHeight").textContent=r.height)}},{key:"setPosition",value:function(r){this.point=r;var o=this.type,a=this.map.pointToOverlayPixel(this.point);o==="circle"?(this.div.style.left=a.x-30+"px",this.div.style.top=a.y-40+"px"):o==="rectangle"&&(this.div.style.left=a.x+"px",this.div.style.top=a.y-45+"px")}},{key:"draw",value:function(){var r=this.map.pointToOverlayPixel(this.point);this.type==="circle"?(this.div.style.left=r.x-30+"px",this.div.style.top=r.y-40+"px"):this.type==="rectangle"&&(this.div.style.left=r.x+"px",this.div.style.top=r.y-45+"px")}},{key:"dispatchRadiusChange",value:function(r){var o=new A("radiuschange",r);this.dispatchEvent(o)}},{key:"dispatchRectWHChange",value:function(r){var o=new A("rectwhchange",r);this.dispatchEvent(o)}}]),n}(Fn(BMapGL.Overlay,Y));function ln(t){return ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ln(t)}function Iu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Tu(t,e,n){return e&&Fr(t.prototype,e),n&&Fr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cn(t,e)}function cn(t,e){return cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},cn(t,e)}function Gu(t){var e=Cu();return function(){var i=tt(t),r;if(e){var o=tt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Du(this,r)}}function Du(t,e){if(e&&(ln(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $u(t)}function $u(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Cu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tt(t){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},tt(t)}var ju=function(t){Nu(n,t);var e=Gu(n);function n(i,r,o){var a;return Iu(this,n),a=e.call(this,i,r,o),a.type=I.DRAWING_RECTANGLE,a.scene.setCurrentDrawType(a.type),a}return Tu(n,[{key:"setIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r,o){var a=this;this.overlay=r;for(var s=this.getBox(r.getPath()),u=s.startPoint,l=s.endPoint,c=[],h=this.getRectAllPoints(u,l),p=[],d=this.scene.map.getDistance(u,h[2]).toFixed(0),O=this.scene.map.getDistance(u,h[6]).toFixed(0),g=new Hi("rectangle",h[0],{width:d,height:O},r,this.scene),b=0;b<h.length;b++){var _=new BMapGL.Marker(h[b]);this.target&&this.target.moveIcon?_.setIcon(this.target.moveIcon):_.setIcon(this.moveIcon),_.enableDragging(),c.push(_),this.scene.map.addOverlay(_),p[b]=E.mc2ll(_.point,this.scene.map),_.addEventListener("mousedown",function(y){l=E.mc2ll(y.target.point,a.scene.map)}),_.addEventListener("dragging",function(y){for(var m=y.latLng,P=0;P<p.length;P++)l.lng==p[P].lng&&(h[P].lng=m.lng),l.lat==p[P].lat&&(h[P].lat=m.lat);h=a.getRectAllPoints(h[0],h[4]);for(var w=0;w<c.length;w++)c[w].setPosition(h[w]);d=a.scene.map.getDistance(h[0],h[2]).toFixed(0),O=a.scene.map.getDistance(h[0],h[6]).toFixed(0),g.setInfo(h[0],{width:d,height:O}),v.setPosition(h[3],!0),r.setPath(h)}),_.addEventListener("dragend",function(y){for(var m=0;m<c.length;m++){var P=c[m];p[m]=E.mc2ll(P.point,a.scene.map)}v.updateWindow();var w=new A(x.CHANGE,r);a.target.dispatchEvent(w)})}g.addEventListener("rectwhchange",function(y){var m=y.target.width,P=y.target.height,w=E.getPointByDistance(h[0],m,"east"),S=E.getPointByDistance(h[0],P,"south");h[4].lng=w.lng,h[4].lat=S.lat,h=a.getRectAllPoints(h[0],h[4]);for(var k=0;k<c.length;k++)c[k].setPosition(h[k]);g.setInfo(h[0],{width:m,height:P}),v.setPosition(h[3],!0),r.setPath(h);for(var L=0;L<c.length;L++){var M=c[L];p[L]=E.mc2ll(M.point,a.scene.map)}v.updateWindow();var B=new A(x.CHANGE,r);a.target.dispatchEvent(B)}),this.overlays=[c,g];var f={limit:o,point:h[3],overlay:r},v=this.addOperateWindow(f);this.scene.map.addOverlay(g),this.dispatchEvent(new A(x.INIT)),this.onlinevertexdragging=function(y){console.log(y);var m=y.overlay,P=BMapGL.Projection.convertMC2LL(m.getPoint()),w=null;w=a.getSnap(P,a.scene.instances),w&&(y.from.point=BMapGL.Projection.convertLL2MC(w),m.setPoint(y.from.point))},r.addEventListener("onlinevertexdragging",this.onlinevertexdragging)}},{key:"getBox",value:function(r){var o=1/0,a=-1/0,s=-1/0,u=1/0;return r.forEach(function(l){l.lng<o&&(o=l.lng),l.lat>a&&(a=l.lat),l.lng>s&&(s=l.lng),l.lat<u&&(u=l.lat)}),{startPoint:new BMapGL.Point(o,a),endPoint:new BMapGL.Point(s,u)}}},{key:"getRectAllPoints",value:function(r,o){var a=new BMapGL.Point(r.lng,r.lat),s=new BMapGL.Point(o.lng,r.lat),u=new BMapGL.Point(o.lng,o.lat),l=new BMapGL.Point(r.lng,o.lat),c=new BMapGL.Point((r.lng+o.lng)/2,r.lat),h=new BMapGL.Point(o.lng,(r.lat+o.lat)/2),p=new BMapGL.Point((r.lng+o.lng)/2,o.lat),d=new BMapGL.Point(r.lng,(r.lat+o.lat)/2);return[a,c,s,h,u,p,l,d]}},{key:"getRectanglePoint",value:function(r,o){return[new BMapGL.Point(r.lng,r.lat),new BMapGL.Point(o.lng,r.lat),new BMapGL.Point(o.lng,o.lat),new BMapGL.Point(r.lng,o.lat)]}}]),n}(gt);function fn(t){return fn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fn(t)}function Fu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zu(t,e,n){return e&&zr(t.prototype,e),n&&zr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Be(){return typeof Reflect<"u"&&Reflect.get?Be=Reflect.get.bind():Be=function(e,n,i){var r=Wu(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Be.apply(this,arguments)}function Wu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=de(t),t!==null););return t}function Yu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hn(t,e)}function hn(t,e){return hn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},hn(t,e)}function Xu(t){var e=qu();return function(){var i=de(t),r;if(e){var o=de(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Ju(this,r)}}function Ju(t,e){if(e&&(fn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Uu(t)}function Uu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function de(t){return de=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},de(t)}var Qi=function(t){Yu(n,t);var e=Xu(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Fu(this,n),r=e.call(this,i,o),r.type=I.DRAWING_RECTANGLE,r.polygon=null,r.startPoint=null,r.scene.setCurrentDrawType(r.type),r.moveIcon=new BMapGL.Icon(si,new BMapGL.Size(10,10)),r.moveIcon.setImageSize(new BMapGL.Size(10,10)),r.isOpen&&r.open(),r}return zu(n,[{key:"getRectAllPoints",value:function(r,o){var a=new BMapGL.Point(r.lng,r.lat),s=new BMapGL.Point(o.lng,r.lat),u=new BMapGL.Point(o.lng,o.lat),l=new BMapGL.Point(r.lng,o.lat),c=new BMapGL.Point((r.lng+o.lng)/2,r.lat),h=new BMapGL.Point(o.lng,(r.lat+o.lat)/2),p=new BMapGL.Point((r.lng+o.lng)/2,o.lat),d=new BMapGL.Point(r.lng,(r.lat+o.lat)/2);return[a,c,s,h,u,p,l,d]}},{key:"getRectanglePoint",value:function(r,o){return[new BMapGL.Point(r.lng,r.lat),new BMapGL.Point(o.lng,r.lat),new BMapGL.Point(o.lng,o.lat),new BMapGL.Point(r.lng,o.lat)]}},{key:"startAction",value:function(r){E.stopBubble(r),E.preventDefault(r);var o=this.startPoint=r.point;this.enableSnap&&this.match&&(o=this.startPoint=this.match);var a=this.endPoint=o;this.polygon=new BMapGL.Polygon(this.getRectanglePoint(o,a),this.baseOptions),this.scene.map.addOverlay(this.polygon),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){this.scene.map.removeOverlay(this.tipLabel);var o=r.point;if(this.enableSnap&&(this.match=this.getSnap(o,this.scene.instances),this.match)){this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match));return}this.match=null,this.polygon.setPath(this.getRectanglePoint(this.startPoint,r.point));var a=this.getRectAllPoints(this.startPoint,r.point),s=this.scene.map.getDistance(this.startPoint,a[2]).toFixed(0),u=this.scene.map.getDistance(this.startPoint,a[6]).toFixed(0);this.tipLabel=new BMapGL.Label("尺寸："+s+"米 x "+u+"米<br>松开结束绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"endAction",value:function(r){if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.enableSnap?(this.match=this.getSnap(r.point,this.scene.instances),this.match&&this.polygon.setPath(this.getRectanglePoint(this.startPoint,this.match))):this.polygon.setPath(this.getRectanglePoint(this.startPoint,r.point)),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.options.limit&&(o=this.options.limit.area);var a=this.editOpe=new ju(this.scene,this);this.registEvent(a),a.open(this.polygon,o)}else this.scene.map.removeOverlay(this.polygon),this.emitEventIsnomap(this.polygon)}},{key:"mousemoveAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Be(de(n.prototype),"setRunningAction",this).call(this,!0,function(){r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.startAction.bind(r))})}},{key:"close",value:function(r){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),Be(de(n.prototype),"setRunningAction",this).call(this,!1),r&&r()}}]),n}(ie);function vn(t){return vn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(t)}function Hu(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qu(t,e,n){return e&&Wr(t.prototype,e),n&&Wr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pn(t,e)}function pn(t,e){return pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},pn(t,e)}function Ku(t){var e=tl();return function(){var i=nt(t),r;if(e){var o=nt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Zu(this,r)}}function Zu(t,e){if(e&&(vn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return el(t)}function el(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nt(t){return nt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},nt(t)}var nl=function(t){Vu(n,t);var e=Ku(n);function n(i,r,o){var a;return Hu(this,n),a=e.call(this,i,r,o),a.type=I.DRAWING_CIRCLE,a.scene.setCurrentDrawType(a.type),a}return Qu(n,[{key:"setCenterIcon",value:function(r){this.centerIcon=r}},{key:"setMoveIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r,o){var a=this;this.overlay=r,this.centerPoint=r.getCenterIn().latLng;var s=new BMapGL.Point(r.getBounds().getNorthEast().lng,this.centerPoint.lat),u=this.centerMarker=new BMapGL.Marker(this.centerPoint);u.setIcon(this.centerIcon),u.enableDragging(),u.addEventListener("dragstart",this.centerDragstart.bind(this)),u.addEventListener("dragging",this.centerDragging.bind(this)),u.addEventListener("dragend",this.centerDragend.bind(this)),this.scene.map.addOverlay(u);var l=this.moveMarker=new BMapGL.Marker(s);l.setIcon(this.circleMoveIcon),l.enableDragging();var c=this.polyline=new BMapGL.Polyline([this.centerPoint,s],this.baseOptions||{}),h=new BMapGL.Point((r.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,this.centerPoint.lat),p=this.radiusWindow=new Hi("circle",h,Math.ceil(r.getRadius()),r,this.scene);this.overlays=[u,l,c,p];var d={limit:o,point:s,overlay:r},O=this.operateWindow=this.addOperateWindow(d);this.scene.map.addOverlay(l),this.scene.map.addOverlay(c),this.scene.map.addOverlay(p);var g=1;p.addEventListener("radiuschange",function(b){if(!(!b.target.radius||isNaN(b.target.radius))){g=b.target.radius,r.setRadius(g);var _=E.getPointByDistance(a.centerPoint,g,"east"),f=new BMapGL.Point(_.lng,a.centerPoint.lat),v=_.lng>a.centerPoint.lng?(r.getBounds().getNorthEast().lng+a.centerPoint.lng)/2:(r.getBounds().getSouthWest().lng+a.centerPoint.lng)/2,y=new BMapGL.Point(v,a.centerPoint.lat);l.setPosition(f),p.setInfo(y,g),O.setPosition(f,!0),O.updateWindow(),c.setPath([a.centerPoint,f]);var m=new A(x.CHANGE,r);a.target.dispatchEvent(m)}}),l.addEventListener("dragging",function(b){var _=new BMapGL.Point(b.latLng.lng,a.centerPoint.lat),f=b.latLng.lng>a.centerPoint.lng?(r.getBounds().getNorthEast().lng+a.centerPoint.lng)/2:(r.getBounds().getSouthWest().lng+a.centerPoint.lng)/2,v=b.latLng.lng>a.centerPoint.lng,y=new BMapGL.Point(f,a.centerPoint.lat);b.target.setPosition(_),p.setInfo(y,a.scene.map.getDistance(a.centerPoint,b.latLng).toFixed(0)),O.setPosition(_,v),c.setPath([a.centerPoint,_]),g=a.scene.map.getDistance(a.centerPoint,b.latLng).toFixed(0),r.setRadius(a.scene.map.getDistance(a.centerPoint,b.latLng))}),l.addEventListener("dragend",function(b){O.updateWindow();var _=new A(x.CHANGE,r);a.target.dispatchEvent(_)}),this.dispatchEvent(new A(x.INIT))}},{key:"centerDragstart",value:function(r){this.moveMarker.hide(),this.polyline.hide(),this.radiusWindow.hide(),this.operateWindow.hide()}},{key:"centerDragging",value:function(r){this.centerPoint=r.latLng,this.overlay.setCenter(r.latLng)}},{key:"centerDragend",value:function(r){this.centerPoint=r.latLng;var o=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.moveMarker.setPosition(o),this.moveMarker.show();var a=new BMapGL.Point(this.overlay.getBounds().getNorthEast().lng,this.centerPoint.lat);this.polyline.setPath([this.centerPoint,a]),this.polyline.show();var s=(this.overlay.getBounds().getNorthEast().lng+this.centerPoint.lng)/2,u=new BMapGL.Point(s,this.centerPoint.lat);this.radiusWindow.setPosition(u),this.operateWindow.setPosition(a,!0),this.radiusWindow.show(),this.operateWindow.show();var l=new A(x.CHANGE,this.circle);this.target.dispatchEvent(l)}}]),n}(gt);function yn(t){return yn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(t)}function rl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function il(t,e,n){return e&&Yr(t.prototype,e),n&&Yr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ie(){return typeof Reflect<"u"&&Reflect.get?Ie=Reflect.get.bind():Ie=function(e,n,i){var r=ol(e,n);if(r){var o=Object.getOwnPropertyDescriptor(r,n);return o.get?o.get.call(arguments.length<3?e:i):o.value}},Ie.apply(this,arguments)}function ol(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=ge(t),t!==null););return t}function al(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dn(t,e)}function dn(t,e){return dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},dn(t,e)}function sl(t){var e=cl();return function(){var i=ge(t),r;if(e){var o=ge(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return ul(this,r)}}function ul(t,e){if(e&&(yn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ll(t)}function ll(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ge(t){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ge(t)}var Vi=function(t){al(n,t);var e=sl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return rl(this,n),r=e.call(this,i,o),r.type=I.DRAWING_CIRCLE,r.circle=null,r.overlays=[],r.centerPoint=null,r.radius=1,r.moveMarker=null,r.polyline=null,r.radiusWindow=null,r.operateWindow=null,r.scene.setCurrentDrawType(r.type),r.isOpen&&r.open(),r}return il(n,[{key:"startAction",value:function(r){this.centerPoint=r.point,this.circle=new BMapGL.Circle(this.centerPoint,this.radius,this.baseOptions),this.scene.map.addOverlay(this.circle),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){this.radius=this.scene.map.getDistance(this.centerPoint,r.point).toFixed(0),this.circle.setRadius(this.radius),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("半径："+this.radius+"米<br>松开完成绘制",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"endAction",value:function(r){if(this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.isSeries?this.isOnMap||this.bindEvent():this.scene.mask.hide(),this.isOnMap){var o=null;this.limit&&(o=this.limit.area);var a=this.editOpe=new nl(this.scene,this);this.registEvent(a),a.open(this.circle,o)}else this.scene.map.removeOverlay(this.centerMarker),this.scene.map.removeOverlay(this.circle),this.emitEventIsnomap(this.circle)}},{key:"mousedownAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.centerPoint==null&&this.startAction(r)}},{key:"mousemoveAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按下确认中心点，拖拽确认半径",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"bindEvent",value:function(){var r=this;this.isOpen&&Ie(ge(n.prototype),"setRunningAction",this).call(this,!0,function(){r.centerPoint=null,r.radius=1,r.setCurrentStatus(G.STATUS_DRAWING),r.scene.mask.addEventListener("mousemove",r.mousemove=r.mousemoveAction.bind(r)),r.scene.mask.addEventListener("mousedown",r.mousedown=r.mousedownAction.bind(r))})}},{key:"close",value:function(r){Ie(ge(n.prototype),"setRunningAction",this).call(this,!1),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),r&&r()}}]),n}(ie);function gn(t){return gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gn(t)}function fl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function hl(t,e,n){return e&&Xr(t.prototype,e),n&&Xr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mn(t,e)}function mn(t,e){return mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},mn(t,e)}function pl(t){var e=gl();return function(){var i=rt(t),r;if(e){var o=rt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return yl(this,r)}}function yl(t,e){if(e&&(gn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dl(t)}function dl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rt(t){return rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},rt(t)}var Gc=function(t){vl(n,t);var e=pl(n);function n(i,r,o){var a;return fl(this,n),a=e.call(this,i,r,o),a.type=I.DRAWING_MARKER,a.scene.setCurrentDrawType(a.type),a}return hl(n,[{key:"setIcon",value:function(r){this.moveIcon=r}},{key:"edit",value:function(r){r.enableDragging(),r.addEventListener("dragstart",this.centerDragstart.bind(this)),r.addEventListener("dragging",this.centerDragging.bind(this)),r.addEventListener("dragend",this.centerDragend.bind(this))}},{key:"centerDragstart",value:function(r){}},{key:"centerDragging",value:function(r){var o=r.target,a=BMapGL.Projection.convertMC2LL(o.point),s=null;s=this.getSnap(a,this.scene.instances),s&&(r.point=BMapGL.Projection.convertLL2MC(s),o.setPoint(r.point))}},{key:"centerDragend",value:function(r){this.emitOkEvent(this.overlay,!0,!0);var o=new A(x.CHANGE,this.overlay);this.target.dispatchEvent(o)}},{key:"closeOpe",value:function(r){r.disableDragging(),r.removeEventListener("dragstart",this.centerDragstart),r.removeEventListener("dragging",this.centerDragging),r.removeEventListener("dragend",this.centerDragend)}}]),n}(gt);function bn(t){return bn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bn(t)}function ml(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bl(t,e,n){return e&&Jr(t.prototype,e),n&&Jr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ol(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&On(t,e)}function On(t,e){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},On(t,e)}function wl(t){var e=_l();return function(){var i=it(t),r;if(e){var o=it(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Pl(this,r)}}function Pl(t,e){if(e&&(bn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return El(t)}function El(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},it(t)}var Dc=function(t){Ol(n,t);var e=wl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ml(this,n),r=e.call(this),r.scene=i,r.opts=o,r.drawingItems=o.drawingItems||go,r.defaultAnchor=o.anchor||BMAP_ANCHOR_TOP_LEFT,r.defaultOffset=o.offset||new BMapGL.Size(20,20),r.initialize(r.scene.map),r}return bl(n,[{key:"initialize",value:function(r){this._map=r;var o=this.container=document.createElement("div");o.className="BMap_Drawing";var a=this.panel=document.createElement("div");a.className="BMap_Draw_Panel",o.appendChild(a);var s=this.generalHtml(r);a.appendChild(s);var u=this.tip=document.createElement("div");return u.className="BMapDraw_tip",u.innerHTML='<p class="BMapDraw_tip_title"></p><p class="BMapDraw_tip_text"></p>',this.opts.enableTips&&a.appendChild(u),r.getContainer().appendChild(o),this.bindEvt(),o}},{key:"generalHtml",value:function(r){for(var o=this,a={hander:"拖动地图",marker:"标记点",polyline:"折线",polygon:"多边形",circle:"圆形",rectangle:"矩形"},s=function(d,O){var g=document.createElement("a");return g.className=d,g.href="javascript:void(0)",g.setAttribute("drawingType",O),g.setAttribute("onfocus","this.blur()"),g.addEventListener("mouseenter",function(b){var _=b.target.getAttribute("drawingType"),f=a[_];_==="hander"?(o.tip.children[0].innerText=f,o.tip.children[1].innerText="使用鼠标拖动地图"):(o.tip.className+=" "+_,o.tip.children[0].innerText=f,o.tip.children[1].innerText="使用"+f+"选出目标区域"),o.tip.style.display="block"}),g.addEventListener("mouseleave",function(b){for(var _=b.target.getAttribute("drawingType"),f=" "+o.tip.className.replace(/[\t\r\n]/g,"")+" ";f.indexOf(" "+_+" ")>=0;)f=f.replace(" "+_+" "," ");o.tip.className=f.replace(/^\s+|\s+$/g,""),o.tip.style.display="none"}),g},u=document.createDocumentFragment(),l=0,c=this.drawingItems.length;l<c;l++){var h="BMapDraw_Box BMapDraw_"+this.drawingItems[l];u.appendChild(s(h,this.drawingItems[l]))}return u}},{key:"setStyleByDrawingItems",value:function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"marker",o=this.panel.getElementsByTagName("a"),a=0,s=o.length;a<s;a++){var u=o[a];if(u.getAttribute("drawingType")===r){var l="BMapDraw_Box BMapDraw_"+r+"_hover";u.className=l}else u.className=u.className.replace(/_hover/,"")}}},{key:"bindEventByDrawingType",value:function(r){var o=this.scene;if(o.isOpen&&o.drawType===r)o.close(),o.map.enableDoubleClickZoom();else switch(r){case"marker":var a=new $i(o);a.open();break;case"polyline":var s=new mt(o);s.open();break;case"polygon":var u=new Kn(o);u.open();break;case"circle":var l=new Vi(o);l.open();break;case"rectangle":var c=new Qi(o);c.open();break}}},{key:"bindEvt",value:function(r){var o=this;E.on(this.panel,"click",function(a){var s=E.getTarget(a),u=s.getAttribute("drawingType");o.setStyleByDrawingItems(u),o.bindEventByDrawingType(u)})}}]),n}(BMapGL.Control);function wn(t){return wn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wn(t)}function Sl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ur(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function kl(t,e,n){return e&&Ur(t.prototype,e),n&&Ur(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ll(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pn(t,e)}function Pn(t,e){return Pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Pn(t,e)}function Ml(t){var e=Al();return function(){var i=ot(t),r;if(e){var o=ot(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return xl(this,r)}}function xl(t,e){if(e&&(wn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rl(t)}function Rl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Al(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ot(t){return ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ot(t)}var $c=function(t){Ll(n,t);var e=Ml(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Sl(this,n),r=e.call(this),r.type=null,r.instance=null,r.graphicOpts=ci,r.labelOptions=Ne,r.isOnMap=!1,r.isSeries=!1,r.skipEditing=!1,r.mouseMove=!0,r.enableSnap=!1,r.scene=i,r.defineProperty(o),r}return kl(n,[{key:"close",value:function(r){this.instance&&(this.instance.close(),this.instance=null),r&&r()}},{key:"open",value:function(r){this.close(),this.scene.close(),this.defineProperty(r),this.type&&this.doAction()}},{key:"doAction",value:function(){var r=this;this.data=[];var o={isSelectDraw:!0,isOpen:!0,enableSnap:this.enableSnap,isOnMap:this.isOnMap,isSeries:this.isSeries,skipEditing:this.skipEditing,labelOptions:this.labelOptions,baseOpts:this.graphicOpts,mouseMove:this.mouseMove};switch(this.type){case I.DRAWING_POLYLINE:this.instance=new mt(this.scene,o);break;case I.DRAWING_POLYGON:this.instance=new Kn(this.scene,o);break;case I.DRAWING_RECTANGLE:this.instance=new Qi(this.scene,o);break;case I.DRAWING_CIRCLE:this.instance=new Vi(this.scene,o);break;case I.DRAWING_MARKER:this.instance=new $i(this.scene,o);break;case I.DRAWING_POINT:this.instance=new pi(this.scene.map);break;default:this.close()}this.instance&&(this.instance.addEventListener(x.CHANGE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(x.MOVE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(x.CLICK,function(a){r.dispatchEvent(a);var s=new A(x.COMPLETE,{from:U.SELECT_NO_MAP,mouseTarget:a.target,overlay:new BMapGL.Marker(new BMapGL.Point(a.target.latlng.lng,a.target.latlng.lat))});r.scene.dispatchEvent(s)}),this.instance.addEventListener(x.COMPLETE,function(a){r.dispatchEvent(a)}),this.instance.addEventListener(x.CANCEL,function(a){r.dispatchEvent(a)}))}},{key:"addData",value:function(r){this.scene&&this.scene.addSelectDrawData(r)}},{key:"clearData",value:function(){this.scene&&this.scene.clearSelectDrawData()}}]),n}(Y);function Bl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Il(t,e,n){return e&&qr(t.prototype,e),n&&qr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var Cc=function(){function t(e,n){Bl(this,t),this.label=void 0,this.scene=e}return Il(t,[{key:"getLength",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};n instanceof BMapGL.Polyline&&(n=n.toGeoJSON());var r=C.getLength(n);if(i.showlabel){var o=n.geometry.coordinates,a=new BMapGL.Point(o[o.length-1][0],o[o.length-1][1]),s="";switch(i.unit){case"kilometers":s="总长度："+r.toFixed(2)+"km";break;case"meters":s="总长度："+r.toFixed(2)+"m";break}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(s,{position:a,offset:i.offset||new BMapGL.Size(0,0)}),this.label.setStyle(i.labelOptions),this.scene.map.addOverlay(this.label)}return r}},{key:"getPolygonArea",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{showlabel:!0,unit:"kilometers"};n instanceof BMapGL.Polygon&&(n=n.toGeoJSON());var r=C.getPolygonArea(n);if(i.showlabel){var o=C.getPolygonCenter(n),a="";switch(i.unit){case"kilometers":a=r.toFixed(2)+" km²";break;case"meters":a=r.toFixed(2)+" m²";break}this.scene.map.removeOverlay(this.label),this.label=new BMapGL.Label(a,{position:o.bdCenter,offset:i.offset||new BMapGL.Size(-20,-10)}),this.label.setStyle(i.labelOptions),this.scene.map.addOverlay(this.label)}return r}}]),t}();function En(t){return En=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(t)}function Tl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Nl(t,e,n){return e&&Hr(t.prototype,e),n&&Hr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_n(t,e)}function _n(t,e){return _n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},_n(t,e)}function Dl(t){var e=jl();return function(){var i=at(t),r;if(e){var o=at(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return $l(this,r)}}function $l(t,e){if(e&&(En(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cl(t)}function Cl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jl(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},at(t)}var jc=function(t){Gl(n,t);var e=Dl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Tl(this,n),r=e.call(this,i,o),r.tipLabel=null,r.lengthLabel=[],r.totalLabel=null,r.turnOverlays=[],r.totalLength=0,r.measureRes=0,r.subDistance=[],r.scene.setCurrentDrawType(r.type),r.setOtherOptions(o),r.isOpen&&r.open(),r}return Nl(n,[{key:"setOtherOptions",value:function(r){this.options=r,this.skipEditing=!0,this.isOpen=!0;var o=po;this.options=Object.assign(o,r),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(r){var o=this.options,a=o.turnIcon?o.turnIcon:li,s=new BMapGL.Marker(r,{icon:a,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1?(this.turnOverlays=[],this.lengthLabel=[],this.overlay=new BMapGL.Polyline(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay)):(this.overlay.setPath(this.drawPoint),this.scene.map.removeOverlay(this.measureLabel),this.scene.map.addOverlay(this.downLabel),this.subDistance.push(this.downLabel.content),this.lengthLabel.push(this.downLabel)),this.setTurnPoint(o),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"moveAction",value:function(r){var o=r.point;if(this.enableSnap){var a=[];if(this.overlay.points.length>2){var s=this.overlay.getPath().slice(0,this.overlay.points.length-1),u=new this.overlay.constructor(s);a.push(u)}if(this.match=this.getSnap(o,this.scene.instances,a),this.match){this.overlay.setPositionAt(this.drawPoint.length-1,this.match);return}}this.match=null;var l=this.drawPoint[this.drawPoint.length-2],c=r.point;this.measureRes=C.getDistance(l,c),this.distance=this.measureRes.toFixed(2)+"km";var h=C.getLineCenter(l,c);this.scene.map.removeOverlay(this.measureLabel),this.measureLabel=this.addLabel(this.distance,{position:h.bdCenter}),this.downLabel=this.addLabel(this.distance,{position:h.bdCenter}),this.scene.map.addOverlay(this.measureLabel),this.overlay.setPositionAt(this.drawPoint.length-1,r.point),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label(this.options.followLabel,{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"dblclickAction",value:function(r){var o=this;E.preventDefault(r),E.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick);var a=this.overlay.toGeoJSON(),s=a.geometry.coordinates,u=new BMapGL.Point(s[s.length-1][0],s[s.length-1][1]),l=[0,0],c=[0,0],h=this.scene.map.pointToPixel(this.points[this.points.length-2]),p=this.scene.map.pointToPixel(this.points[this.points.length-3]);h.x-p.x>=0?l=[14,0]:l=[-14,0],h.y-p.y>=0?c=[-5,11]:c=[-5,-38];var d=C.getLength(a,this.options.unit);this.totalLength=d;var O="";switch(this.options.unit){case"kilometers":O="总长："+d.toFixed(2)+"km";break;case"meters":O="总长："+d.toFixed(2)+"m";break}this.totalLabel=new BMapGL.Label(O,{position:u,offset:new BMapGL.Size(c[0],c[1])}),this.totalLabel.setStyle(this.options.labelOptions),this.scene.map.addOverlay(this.totalLabel),this.lengthLabel.push(this.totalLabel),this.closeIcon=this.options.closeIcon?this.options.closeIcon:ui,this.closeBtn=new BMapGL.Marker(u,{icon:this.closeIcon,baseZIndex:36e5,offset:new BMapGL.Size(l[0],l[1]),enableMassClear:!0}),this.closeBtn.setTitle("清除本次测距"),this.scene.map.addOverlay(this.closeBtn);var g={overlay:this.overlay,closeBtn:this.closeBtn,totalLabel:this.totalLabel,lengthLabel:this.lengthLabel,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0)};this.closeBtn.addEventListener("click",function(b){o.scene.map.removeOverlay(g.closeBtn),o.scene.map.removeOverlay(g.overlay);for(var _=0,f=g.turnOverlays.length;_<f;_++)o.scene.map.removeOverlay(g.turnOverlays[_]),g.turnOverlays[_]=null;for(var v=0,y=g.lengthLabel.length;v<y;v++)o.scene.map.removeOverlay(g.lengthLabel[v]),g.lengthLabel[v]=null}),this.dispatchMeasureEvent(),this.overlay.setPath(this.points),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var r=new A(ai.LENGTH_END,{points:this.points?this.points.slice(0):[],distance:this.totalLength,subDistance:this.subDistance,unit:this.options.unit,overlay:this.overlay});this.dispatchEvent(r),this.scene.dispatchEvent(r)}}]),n}(mt);function Sn(t){return Sn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sn(t)}function Fl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zl(t,e,n){return e&&Qr(t.prototype,e),n&&Qr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kn(t,e)}function kn(t,e){return kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},kn(t,e)}function Yl(t){var e=Ul();return function(){var i=st(t),r;if(e){var o=st(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Xl(this,r)}}function Xl(t,e){if(e&&(Sn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jl(t)}function Jl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function st(t){return st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},st(t)}var Fc=function(t){Wl(n,t);var e=Yl(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Fl(this,n),r=e.call(this,i,o),r.measureArea=0,r.turnOverlays=[],r.scene.setCurrentDrawType(r.type),r.setOtherOptions(o),r.isOpen&&r.open(),r}return zl(n,[{key:"setOtherOptions",value:function(r){this.options=r,this.skipEditing=!0,this.isOpen=!0,this.options=Object.assign(vo,r),this.isSeries=this.options.isSeries,this.setBaseOptions(this.options.baseOpts)}},{key:"setTurnPoint",value:function(r){var o=this.options,a=o.turnIcon?o.turnIcon:li,s=new BMapGL.Marker(r,{icon:a,clickable:!1,baseZIndex:35e5,zIndexFixed:!0});this.scene.map.addOverlay(s),this.turnOverlays.push(s)}},{key:"startAction",value:function(r){var o=this.match?this.match:r.point;if(this.points.push(o),this.drawPoint=this.points.concat(this.points[this.points.length-1]),this.points.length===1)this.turnOverlays=[],this.overlay=new BMapGL.Polygon(this.drawPoint,this.baseOptions),this.scene.map.addOverlay(this.overlay);else if(this.overlay.setPath(this.drawPoint),this.points.length>2){this.measureArea=C.getPolygonArea(this.overlay),this.area=this.measureArea.toFixed(2)+"km²";var a=C.getPolygonCenter(this.overlay.toGeoJSON());this.scene.map.removeOverlay(this.areaLabel),this.areaLabel=this.addLabel(this.area,{position:a.bdCenter,offset:new BMapGL.Size(5,-2)}),this.scene.map.addOverlay(this.areaLabel)}this.setTurnPoint(o),this.isBinded||(this.isBinded=!0,this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("dblclick",this.dblclick=this.dblclickAction.bind(this)))}},{key:"dblclickAction",value:function(r){var o=this;E.preventDefault(r),E.stopBubble(r),this.isBinded=!1,this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeOverlay(this.tipLabel),this.scene.mask.disableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("dblclick",this.dblclick),this.overlay.setPath(this.points);var a=this.overlay.toGeoJSON(),s=a.geometry.coordinates[0],u=new BMapGL.Point(s[s.length-1][0],s[s.length-1][1]);this.closeIcon=this.options.closeIcon?this.options.closeIcon:ui,this.closeBtn=new BMapGL.Marker(u,{icon:this.closeIcon,baseZIndex:36e5,enableMassClear:!0,offset:new BMapGL.Size(10,10)});var l=C.getPolygonCenter(this.overlay.toGeoJSON());this.totalAreaLabel=this.addLabel(this.area,{position:l.bdCenter,offset:new BMapGL.Size(5,-2)});var c={overlay:this.overlay,closeBtn:this.closeBtn,points:this.points.slice(0),turnOverlays:this.turnOverlays.slice(0),totalAreaLabel:this.totalAreaLabel};this.scene.map.addOverlay(c.closeBtn),this.scene.map.removeOverlay(this.areaLabel),this.scene.map.addOverlay(c.totalAreaLabel),c.closeBtn.addEventListener("click",function(h){o.scene.map.removeOverlay(c.closeBtn),o.scene.map.removeOverlay(c.overlay),o.scene.map.removeOverlay(c.totalAreaLabel);for(var p=0,d=c.turnOverlays.length;p<d;p++)o.scene.map.removeOverlay(c.turnOverlays[p]),c.turnOverlays[p]=null}),this.dispatchMeasureEvent(),this.isSeries?this.bindEvent():this.scene.mask.hide()}},{key:"dispatchMeasureEvent",value:function(){var r=new A(ai.AREA_END,{points:this.points?this.points.slice(0):[],unit:this.options.unit,area:this.measureArea,overlay:this.overlay});this.dispatchEvent(r),this.scene.dispatchEvent(r)}}]),n}(Kn);function Ln(t){return Ln=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(t)}function ql(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Hl(t,e,n){return e&&Vr(t.prototype,e),n&&Vr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ql(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mn(t,e)}function Mn(t,e){return Mn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Mn(t,e)}function Vl(t){var e=ec();return function(){var i=ut(t),r;if(e){var o=ut(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Kl(this,r)}}function Kl(t,e){if(e&&(Ln(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zl(t)}function Zl(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ec(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ut(t)}var zc=function(t){Ql(n,t);var e=Vl(n);function n(){var i;ql(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i=e.call.apply(e,[this].concat(o)),i.tolerance=.001,i.toleranceType="kilometers",i}return Hl(n,[{key:"polygonCutByLine",value:function(r,o,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=r.geometry,l=o.geometry;l.coordinates.length=l.coordinates.length-1;var c=[],h=[],p=null,d;if(u.type!=="Polygon"&&u.type!=="MultiPolygon"||l.type!=="LineString")return p;typeof a>"u"&&(a="");var O=Se(u,l);if(O.features.length===0||qn(l,u))return p;h[0]=pr(l,this.tolerance,{units:this.toleranceType}),h[1]=pr(l,-this.tolerance,{units:this.toleranceType});for(var g=0;g<=1;g++){var b=g;c=[];for(var _=0;_<l.coordinates.length;_++)c.push(l.coordinates[_]);for(var f=h[b].geometry.coordinates.length-1;f>=0;f--)c.push(h[b].geometry.coordinates[f]);c.push(l.coordinates[0]);var v=D(c),y=Sa(v);d=Os(u,y)}var m=new BMapGL.GeoJSONParse,P=m.readFeaturesFromObject(d,s),w=[],S=[];return P.forEach(function(k,L){k.properties=Object.assign({},r.properties||{}),k.properties.id+="-".concat(L),w.push(k),S.push(k.toGeoJSON())}),{geojsonRes:S,bdRes:w}}},{key:"lineCutByPoly",value:function(r,o,a){if(r.geometry===void 0||r.geometry.type.toLowerCase().indexOf("linestring")===-1)throw"传入的必须为linestring";var s=Pa(r,o).features,u=[],l=new BMapGL.GeoJSONParse;if(s.length>1)for(var c=0,h=s.length;c<h;c++){var p=l.readFeatureFromObject(s[c],a);u.push(p)}return{geojsonRes:s,bdRes:u}}}]),n}(Y);function xn(t){return xn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xn(t)}function tc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Kr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nc(t,e,n){return e&&Kr(t.prototype,e),n&&Kr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function rc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rn(t,e)}function Rn(t,e){return Rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Rn(t,e)}function ic(t){var e=sc();return function(){var i=lt(t),r;if(e){var o=lt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return oc(this,r)}}function oc(t,e){if(e&&(xn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ac(t)}function ac(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lt(t){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},lt(t)}var Wc=function(t){rc(n,t);var e=ic(n);function n(){var i;tc(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i=e.call.apply(e,[this].concat(o)),i.tolerance=.001,i.toleranceType="kilometers",i}return nc(n,[{key:"polygonUnion",value:function(r,o){if(r.length<2)throw"至少2个数据";var a=null,s=!1;r.forEach(function(h,p){if(p>=1){var d=qn(a,h);d?s=!0:a=Gi(a,h)}else a=h});var u=s?null:a,l=new BMapGL.GeoJSONParse,c=l.readFeatureFromObject(u,o);return{geojsonRes:u,bdRes:c}}}]),n}(Y);function An(t){return An=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},An(t)}function uc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zr(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function lc(t,e,n){return e&&Zr(t.prototype,e),n&&Zr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function cc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bn(t,e)}function Bn(t,e){return Bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Bn(t,e)}function fc(t){var e=pc();return function(){var i=ct(t),r;if(e){var o=ct(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return hc(this,r)}}function hc(t,e){if(e&&(An(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vc(t)}function vc(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ct(t)}var yc=function(t){cc(n,t);var e=fc(n);function n(){return uc(this,n),e.apply(this,arguments)}return lc(n,[{key:"geojsonMove",value:function(r,o,a){(o instanceof BMapGL.Point||o instanceof BMapGL.LatLng)&&(o=T([o.lng,o.lat])),(a instanceof BMapGL.Point||a instanceof BMapGL.LatLng)&&(a=T([a.lng,a.lat]));var s=Ri(o,a),u=La(o,a),l=Ra(r,s,u);return l}}]),n}(Y);function In(t){return In=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(t)}function dc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function gc(t,e,n){return e&&ei(t.prototype,e),n&&ei(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function mc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tn(t,e)}function Tn(t,e){return Tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Tn(t,e)}function bc(t){var e=wc();return function(){var i=ft(t),r;if(e){var o=ft(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Oc(this,r)}}function Oc(t,e){if(e&&(In(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nn(t)}function Nn(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ft(t){return ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ft(t)}var Me=function(t){mc(n,t);var e=bc(n);function n(i){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(dc(this,n),r=e.call(this),r.currentModel=n.MODEL.MOVE,r.labelOptions=Ne,r.baseOpts=ci,r.enableSnap=!0,r.snapDistance=10,r.match=null,r.matchOverlay=null,r.matchOverlayRadius=1,!(i instanceof Vn))throw Error("MoveBase实例化必须输入scene参数");r.scene=i,r.scene.move=Nn(r);var a={};return E.copyOptionsToNew(r.scene.options,o,a),E.copyNotExitOptions(a,r.scene.options),r.options=a,r.target=o.target||Nn(r),r.setOptions(a),r.setSnapPointType(o),r.moveCalculate=new yc,r.parse=new BMapGL.GeoJSONParse,r}return gc(n,[{key:"setOptions",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.defineProperty(r)}},{key:"setCurrentModel",value:function(r){this.currentModel=r}},{key:"open",value:function(r,o){var a=this;this.scene&&(this.currentModel===n.MODEL.MOVE?this.overlay=r:this.overlay=this.parse.readFeatureFromObject(r.toGeoJSON()),this.scene.open(),this.setRunningAction(!0,function(){a.setSceneStatus(G.STATUS_MOVE),a.moveOpe(r),o&&o()}))}},{key:"close",value:function(r){this.overlay&&(this.setRunningAction(!1),this.setSceneStatus(G.STATUS_FREE),this.closeOpe(this.overlay),this.emitOkEvent(this.overlay),r&&r())}},{key:"moveOpe",value:function(r){}},{key:"closeOpe",value:function(r){}},{key:"emitOkEvent",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=U.MOVE_ON_MAP,s=new A(x.COMPLETE,{overlay:r,from:a,model:this.currentModel});this.dispatchEvent(s),o&&this.scene.dispatchEvent(s)}},{key:"setRunningAction",value:function(r,o){r?(this.scene.closeRunningAction(),this.scene.runningAction=this,this.scene.mask.show(),o()):(this.scene.runningAction=null,this.scene.mask.hide())}},{key:"setRadius",value:function(){var r=this.scene.map.getZoomUnits(),o=this.matchOverlayRadius*r;this.matchOverlay.setRadius(o)}},{key:"addMatchOverlay",value:function(r){this.matchOverlay instanceof BMapGL.Circle?(this.setRadius(),this.matchOverlay.setCenter(r),this.scene.map.addEventListener("zoomend",this.setRadius.bind(this)),this.scene.map.addOverlay(this.matchOverlay)):(this.scene.map.addOverlay(this.matchOverlay),this.matchOverlay.setPosition(r))}},{key:"removeMatchOverlay",value:function(){this.scene.map.removeOverlay(this.matchOverlay),this.scene.map.removeEventListener("zoomend",this.setRadius.bind(this))}},{key:"getSnap",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scene.instances,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:this.snapDistance,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.scene.map,l=null;return this.removeMatchOverlay(),l||(l=le(r,o,s,u)),!l&&this.scene._attachSnapSource&&(l=le(r,this.scene._attachSnapSource,s,u)),l||(l=le(r,a,s,u)),l&&this.addMatchOverlay(l),l}}]),n}(Y);Me.MODEL={COPY:Symbol(),MOVE:Symbol()};function Gn(t){return Gn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gn(t)}function Ki(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ti(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zi(t,e,n){return e&&ti(t.prototype,e),n&&ti(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function eo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dn(t,e)}function Dn(t,e){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Dn(t,e)}function to(t){var e=_c();return function(){var i=ht(t),r;if(e){var o=ht(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Pc(this,r)}}function Pc(t,e){if(e&&(Gn(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ec(t)}function Ec(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _c(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ht(t){return ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ht(t)}var Sc=function(t){eo(n,t);var e=to(n);function n(i,r){var o;return Ki(this,n),o=e.call(this,i,r),o.type=I.DRAWING_POLYLINE,o.scene.setCurrentDrawType(o.type),o}return Zi(n,[{key:"startAction",value:function(r){E.stopBubble(r),E.preventDefault(r),this.match?this.start=this.match:this.start=r.point,this.currentModel===Me.MODEL.COPY&&(this.overlay.setOptions(this.baseOpts),this.scene.map.addOverlay(this.overlay)),this.scene.mask.enableEdgeMove(),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.addEventListener("mousemove",this.mousemove=this.moveAction.bind(this)),this.scene.mask.addEventListener("mouseup",this.mouseup=this.endAction.bind(this))}},{key:"moveAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("移动改变位置<br>松开结束操作",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel);var o=r.point;this.enableSnap&&(this.currentModel===Me.MODEL.COPY?this.match=this.getSnap(r.point,this.scene.instances):this.match=this.getSnap(r.point,this.scene.instances,[],this.snapDistance,this.scene.map,[this.overlay]),this.match&&(o=this.match),this.match=null);var a=this.start,s=this.moveCalculate.geojsonMove(this.source,a,o);this.overlay.updateByGeoJSON(s)}},{key:"endAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mousemove",this.mousemove),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.disableEdgeMove(),this.finish()}},{key:"mousemoveAction",value:function(r){E.preventDefault(r),E.stopBubble(r),this.enableSnap&&(this.match=this.getSnap(r.point,this.scene.instances)),this.scene.map.removeOverlay(this.tipLabel),this.tipLabel=new BMapGL.Label("按住确认起点，拖拽进行移动",{position:r.point,offset:new BMapGL.Size(10,10)}),this.tipLabel.setStyle(this.labelOptions),this.scene.map.addOverlay(this.tipLabel)}},{key:"finish",value:function(){this.currentModel===Me.MODEL.COPY&&this.scene.map.removeOverlay(this.overlay),this.emitOkEvent(this.overlay,!0);var r=new A(x.CHANGE,this.overlay);this.target.dispatchEvent(r),this.close()}},{key:"moveOpe",value:function(){this.source=this.overlay.toGeoJSON(),this.scene.mask.show(),this.scene.mask.addEventListener("mousemove",this.mousemove=this.mousemoveAction.bind(this)),this.scene.mask.addEventListener("mousedown",this.mousedown=this.startAction.bind(this))}},{key:"closeOpe",value:function(){this.scene.map.removeOverlay(this.tipLabel),this.scene.map.removeOverlay(this.matchOverlay),this.scene.mask.removeEventListener("mouseup",this.mouseup),this.scene.mask.removeEventListener("mousedown",this.mousedown),this.scene.mask.removeEventListener("mousemove",this.mousemove)}}]),n}(Me),Yc=function(t){eo(n,t);var e=to(n);function n(i,r){var o;return Ki(this,n),o=e.call(this,i,r),o.type=I.DRAWING_POLYGON,o.scene.setCurrentDrawType(o.type),o}return Zi(n)}(Sc);function $n(t){return $n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$n(t)}function ni(t,e){return xc(t)||Mc(t,e)||Lc(t,e)||kc()}function kc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lc(t,e){if(t){if(typeof t=="string")return ri(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ri(t,e)}}function ri(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Mc(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],r=!0,o=!1,a,s;try{for(n=n.call(t);!(r=(a=n.next()).done)&&(i.push(a.value),!(e&&i.length===e));r=!0);}catch(u){o=!0,s=u}finally{try{!r&&n.return!=null&&n.return()}finally{if(o)throw s}}return i}}function xc(t){if(Array.isArray(t))return t}function no(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ii(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ro(t,e,n){return e&&ii(t.prototype,e),n&&ii(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function io(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cn(t,e)}function Cn(t,e){return Cn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,r){return i.__proto__=r,i},Cn(t,e)}function oo(t){var e=Bc();return function(){var i=vt(t),r;if(e){var o=vt(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Rc(this,r)}}function Rc(t,e){if(e&&($n(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ac(t)}function Ac(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},vt(t)}var Xc=function(t){io(n,t);var e=oo(n);function n(i,r){var o;return no(this,n),o=e.call(this),o.otherOverlays=[],o.snapDistance=15,o.isOpen=!1,o.cursor="default",o.scene=i,o.isOpen=~~r,o._initEvent(),o}return ro(n,[{key:"open",get:function(){return this.isOpen},set:function(r){this.isOpen=r}},{key:"distance",get:function(){return this.snapDistance},set:function(r){this.snapDistance=r}},{key:"setPickCursor",value:function(r){this.cursor=r}},{key:"_initEvent",value:function(){var r=this;this.scene&&(this.scene.addEventListener(x.CLICK,function(o){if(r.isOpen&&r.scene.currentStatus===G.STATUS_FREE){var a=r.getSnap(o.target.latlng);if(a){var s=ni(a,3),u=s[0],l=s[1];s[2];var c=new oi(u,l);r.dispatchEvent(new A(x.CLICK,c))}}}),this.scene.addEventListener(x.MOVE,function(o){if(r.isOpen&&r.scene.currentStatus===G.STATUS_FREE){var a=r.getSnap(o.target.latlng);if(a){r.scene.map.platform.style.cursor=r.cursor;var s=ni(a,3),u=s[0],l=s[1];s[2];var c=new oi(u,l);r.dispatchEvent(new A(x.MOVE,c))}else r.scene.map.platform.style.cursor=r.scene.map.config.defaultCursor,r.dispatchEvent(new A(x.MOVE,null))}}))}},{key:"attachOverlays",value:function(r){r instanceof Array&&(this.otherOverlays=r)}},{key:"getSnap",value:function(r){var o=null;return o||(o=this.getSnapByLL(r,this.scene.instances)),!o&&this.otherOverlays&&this.otherOverlays.length>0&&(o=this.getSnapByLL(r,this.otherOverlays)),o}},{key:"getSnapByLL",value:function(r,o){var a=this.scene.map,s=Ic(a.getZoom()),u=this.snapDistance*s;if(!o||!(o instanceof Array))return null;for(var l in o){var c=o[l];if(c instanceof BMapGL.Marker){var h=c.getPosition(),p=C.getDistance(r,h,"kilometers")*1e3;if(p<u)return[c,0,h]}else{var d=c.getPath();for(var O in d){var g=d[O],b=C.getDistance(r,g,"kilometers")*1e3;if(b&&b<u)return[c,O,g]}}}return null}}]),n}(Y),oi=function(t){io(n,t);var e=oo(n);function n(i,r){var o;return no(this,n),o=e.call(this),o._index=-1,o.overlay=i,i instanceof BMapGL.Marker?o.path=[i.getPosition()]:o.path=i.getPath(),r<=o.path.length-1&&(o.index=r),o}return ro(n,[{key:"index",get:function(){return this._index},set:function(r){this._index=parseInt(r)||0;var o=new A(x.CHANGE,this.index);this.dispatchEvent(o)}},{key:"getCurrentNode",value:function(){return this.path[this.index]}},{key:"updateNode",value:function(r,o){if(this.overlay instanceof BMapGL.Marker){var a=BMapGL.Projection.convertLL2MC(r);this.overlay.setPoint(a)}else o!==void 0&&o>=0&&o<this.path.length?this.path[o]=r:this.path[this.index]=r,this.overlay.setPath(this.path)}},{key:"hasNext",value:function(){return this.index+1>=0&&this.index+1<this.path.length}},{key:"next",value:function(){return this.hasNext()?(this._index++,this.path[this.index]):null}},{key:"hasPrev",value:function(){return this.index-1>=0&&this.index-1<this.path.length}},{key:"prev",value:function(){return this.hasPrev()?(this._index--,this.path[this.index]):null}}]),n}(Y);function Ic(t){return Math.pow(2,18-t)}export{U as ActionStatus,Fc as AreaMeasure,Vi as CircleDraw,nl as CircleEdit,Xc as CorrectPoint,zc as CutCalculate,jc as DistanceMeasure,Dc as DrawControl,Vn as DrawScene,G as DrawStatus,I as DrawingType,C as GeoCalculator,pi as MapSelect,$i as MarkerDraw,Gc as MarkerEdit,Cc as Measure,ai as MeasureEvent,yc as MoveCalculate,Ce as Operate,x as OperateEventType,Kn as PolygonDraw,wu as PolygonEdit,Yc as PolygonMove,mt as PolylineDraw,Yi as PolylineEdit,Sc as PolylineMove,Qi as RectDraw,ju as RectEdit,$c as Select,Wc as UnionCalculate};
